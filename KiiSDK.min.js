if("undefined"==typeof jQuery&&"object"==typeof process&&"object"==typeof process.versions)var XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest;!function(){var t=function(){Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=i.length;return function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var s=[];for(var o in r)t.call(r,o)&&s.push(o);if(e)for(var u=0;n>u;u++)t.call(r,i[u])&&s.push(i[u]);return s}}()),"undefined"==typeof Promise&&!function(t,e){function i(t,e){return(typeof e)[0]==t}function n(s,o){return o=function u(a,l,c,h,p,f){function g(t){return function(e){p&&(p=0,u(i,t,e))}}if(h=u.q,a!=i)return n(function(t,e){h.push({p:this,r:t,j:e,1:a,0:l})});if(c&&i(t,c)|i(e,c))try{p=c.then}catch(_){l=0,c=_}if(i(t,p))try{p.call(c,g(1),l=g(0))}catch(_){l(_)}else for(o=function(e,o){return i(t,e=l?e:o)?n(function(t,i){r(this,t,i,c,e)}):s},f=0;f<h.length;)p=h[f++],i(t,a=p[l])?r(p.p,p.r,p.j,c,a):(l?p.r:p.j)(c)},o.q=[],s.call(s={then:function(t,e){return o(t,e)},"catch":function(t){return o(0,t)}},function(t){o(i,1,t)},function(t){o(i,0,t)}),s}function r(n,r,s,o,u){setTimeout(function(){try{o=u(o),u=o&&i(e,o)|i(t,o)&&o.then,i(t,u)?o==n?s(TypeError()):u.call(o,r,s):r(o)}catch(a){s(a)}})}function s(t){return n(function(e){e(t)})}Promise=n,n.resolve=s,n.reject=function(t){return n(function(e,i){i(t)})},n.all=function(t){return n(function(e,i,n,r){r=[],n=t.length||e(r),t.map(function(t,o){s(t).then(function(t){r[o]=t,--n||e(r)},i)})})}}("f","o");var t,e,i,n,r,s,o,u,a,l,c,h,p,f,g,_,d,y=function(t,e){return function(){return t.apply(e,arguments)}},m={}.hasOwnProperty,k=function(t,e){function i(){this.constructor=t}for(var n in e)m.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};return f="undefined"!=typeof exports&&null!==exports?new Object:this,f.KiiSocialNetworkName={FACEBOOK:1,TWITTER:2,QQ:3,GOOGLEPLUS:4,RENREN:5},f.KiiSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api",SG:"https://api-sg.kii.com/api",CN3:"https://api-cn3.kii.com/api",EU:"https://api-eu.kii.com/api"},f.KiiServerCodeEnvironmentVersion={V0:"0",V6:"6"},f.Kii=function(){function t(){}var e,i;return i=null,e=null,t.getBuildNumber=function(){return"1"},t.getSDKVersion=function(){return"2.4.13"},t.getBaseURL=function(){return i._baseURL},t.getAppID=function(){return i._appID},t.getAdditionalHeaders=function(){return e},t.setAdditionalHeaders=function(t){return e=t},t.getAppKey=function(){return i._appKey},t.isLogging=function(){return i._logging},t.setLogging=function(t){return i._logging=t,f.Kii.logger("Setting logging: "+t),f.Kii.logger("Base URL: "+i._baseURL)},t.setAccessTokenExpiration=function(t){if(!i)throw new f.IllegalStateException("Kii is not initialized");if(isNaN(parseInt(t,10)))throw new f.InvalidArgumentException("expiresIn should be a number");if(0>t)throw new f.InvalidArgumentException("expiresIn should not negative number");return i?i._expiresIn=t:void 0},t.getAccessTokenExpiration=function(){if(!i)throw new f.IllegalStateException("Kii is not initialized");return i._expiresIn},t.initializeWithSite=function(t,e,n,r){return i=new g(t,e,n),f.Kii.logger("Initialized "+t+", "+e+", "+n),"object"===l._type(r)?f.KiiAnalytics._initializeWithSite(t,e,n,r.deviceId):void 0},t.initialize=function(t,e,i){return f.Kii.initializeWithSite(t,e,f.KiiSite.US,i)},t.logger=function(t){return i._logging?console.log(t):void 0},t.bucketWithName=function(t){var e;return e=new f.KiiBucket(t,null)},t.encryptedBucketWithName=function(t){var e;return e=new f.KiiEncryptedBucket(t,null)},t.groupWithName=function(t){return new f.Kii.groupWithNameAndMembers(t,null)},t.groupWithNameAndMembers=function(t,e){return new f.KiiGroup.groupWithNameAndMembers(t,e)},t.logOut=function(){return i._currentUser=null,f.KiiSocialConnect.logOutAll()},t.loggedIn=function(){return null!=i._currentUser},t.getCurrentUser=function(){var t;return null!=i._currentUser?(t=l._clone(i._currentUser),f.Kii.logger("my instance:"),f.Kii.logger(t),t):null},t.setCurrentUser=function(t){return i._currentUser=l._clone(t),f.Kii.logger("my instance:"),f.Kii.logger(i._currentUser)},t.authenticateAsAppAdmin=function(t,e,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(l._Error(arguments[0]))}},n._authenticateAsAppAdminUsingCallbacks(t,e,o)}}(this))},t._authenticateAsAppAdminUsingCallbacks=function(t,e,i){var n,r;return r=new o("/oauth2/token",!1),r.setAnonymous(!0),r.setMethod("POST"),r.setData({client_id:t,client_secret:e}),n={success:function(t){return function(t){var e,n,r;return r=t.access_token,n=t.id,f.Kii.logger("token: "+r),f.Kii.logger("id: "+n),e=new f.KiiAppAdminContext({token:r,id:n}),null!=i?i.success(e):void 0}}(this),failure:function(t){return function(t,e){return f.Kii.logger("error: "+t),f.Kii.logger("statusCode: "+e),null!=i?i.failure(t,e):void 0}}(this)},r.execute(n,!1)},t.authenticateAsAdminWithToken=function(t){return new f.KiiAppAdminContext({token:t})},t.serverCodeEntry=function(t,e,i){if(!l._validateServerCodeEntryName(t))throw new f.InvalidArgumentException("entryName is invalid");if(e&&!l._validateServerCodeEnryVersion(e))throw new f.InvalidArgumentException("version is invalid");return new f.KiiServerCodeEntry(t,e,i)},t.serverCodeEntryWithVersion=function(t,e){if(!l._validateServerCodeEntryName(t))throw new f.InvalidArgumentException("entryName is invalid");if(!l._validateServerCodeEnryVersion(e))throw new f.InvalidArgumentException("version is invalid");return new f.KiiServerCodeEntry(t,e)},t._setHttpRequestType=function(t){return f.Kii.logger("Set http request as "+t),i._httpRequestType=t},t._getHttpRequestType=function(){return i._httpRequestType},t._getKiiUtilities=function(){return l},t.topicWithName=function(t){var e;if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");return e=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID(),new f.KiiTopic(e,t)},t.listTopics=function(e,i){return t._listTopics(e,i)},t._listTopics=function(e,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=e&&e.success.apply(e,arguments),r(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),s(arguments[0])}},t._listTopicsUsingCallbacks(o,i,n)})},t._listTopicsUsingCallbacks=function(e,i,n){var r,s,o;return s=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/topics","string"==typeof i&&""!==i&&(s=s+"?paginationKey="+encodeURIComponent(i)),o=h.createXHRWrapper("GET",s),o.setKiiHeaders(),null!=n?o.setAuthToken(n._getToken()):o.setCurrentUserToken(),r={success:function(){var i,n,r,s,u,a;for(i=JSON.parse(o.xhr.responseText),r=[],a=i.topics,s=0,u=a.length;u>s;s++)n=a[s],r.push(t.topicWithName(n.topicID));return null!=e?e.success(r,void 0===i.paginationKey?null:i.paginationKey):void 0},failure:function(){var i,n;return n=o.getErrorString("list topics"),i=l._Error(n,t),null!=e?e.failure(i):void 0}},o.send(r)},t.authenticateAsThing=function(t,e,i){return new Promise(function(n){return function(n,r){var s,o,u;return l._isNonEmptyString(t)&&l._isNonEmptyString(e)?(u=h.createXHRWrapper("POST",""+f.Kii.getBaseURL()+"/oauth2/token"),u.setKiiHeaders(),u.setContentType("application/vnd.kii.OauthTokenRequest+json"),o={success:function(){var e,o,a,c,h;return a=JSON.parse(decodeURIComponent(u.xhr.responseText)),h=a.id,e=a.access_token,null!=h&&null!=e?(c=new f.KiiThingContext({thingId:h,token:e,vendorThingID:t}),null!=i&&i.success(c),n(c)):(o=u.getErrorString("invalid format response when authenticate thing "),s=l._Error(o),null!=i&&i.failure(s),r(s))},failure:function(){var t;return t=u.getErrorString("authenticate as thing"),s=l._Error(t),null!=i&&i.failure(s),r(s)}},u.sendData(JSON.stringify({username:"VENDOR_THING_ID:"+t,password:e}),o)):(s=l._Error("vendorThingID or password is invalid"),null!=i&&i.failure(s),void r(s))}}(this))},t.authenticateAsThingWithToken=function(t,e,i){return new Promise(function(n){return function(n,r){var s,o;return l._isNonEmptyString(t)&&l._isNonEmptyString(e)?(o=new f.KiiThingContext({thingId:t,token:e}),null!=i&&i.success(o),n(o)):(s=l._Error("thingID or token is invalid"),null!=i&&i.failure(s),r(s))}}(this))},t}(),f._KiiHttpRequestType={jQuery:"jQuery",XMLHttpRequest:"XMLHttpRequest",Titanium:"Titanium"},g=function(){function t(t,e,i){this._appKey=e,this._appID=t,this._baseURL=i,this._expiresIn=0}return t.prototype._logging=!1,t.prototype._baseURL=null,t.prototype._currentUser=null,t.prototype._httpRequestType=null,t}(),f.KiiACL=function(){function t(){this._thingWithID=y(this._thingWithID,this),this._userWithID=y(this._userWithID,this),this._groupWithID=y(this._groupWithID,this),this._getRequest=y(this._getRequest,this),this._saveItr=y(this._saveItr,this),this._saveUsingCallbacks=y(this._saveUsingCallbacks,this),this.save=y(this.save,this),this._getKeyOfEntry=y(this._getKeyOfEntry,this),this.removeACLEntry=y(this.removeACLEntry,this),this.putACLEntry=y(this.putACLEntry,this),this._listACLEntriesUsingCallbacks=y(this._listACLEntriesUsingCallbacks,this),this.listACLEntries=y(this.listACLEntries,this),this.aclPath=y(this.aclPath,this),this._setParent=y(this._setParent,this),this._entriesMap={}}return t.prototype._setParent=function(t){this._parent=t},t.prototype.aclPath=function(){var t,e,i,n,r,s,o,u,a,l;return this._parent instanceof f.KiiObject?(n=this._parent,null!=n.getBucket().getUser()?l=n.getBucket().getUser():null!=n.getBucket().getGroup()?i=n.getBucket().getGroup():null!=n.getBucket().getThing()&&(u=n.getBucket().getThing()),e=n.getBucket()._getQualifiedBucketName(),r=n.getUUID()):this._parent instanceof f.KiiBucket?(t=this._parent,null!=t.getUser()?l=t.getUser():null!=t.getGroup()?i=t.getGroup():null!=t.getThing()&&(u=t.getThing()),e=t._getQualifiedBucketName()):this._parent instanceof f.KiiTopic?a=this._parent:f.Kii.logger("Invalid ACL parent. Must belong to a KiiObject"),s="/",null!=i?s+="groups/"+i.getUUID()+"/":null!=l?s+="users/"+l.getUUID()+"/":null!=u&&(s+="things/"+u.getThingID()+"/"),a?(o=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/",0!==a._uri.indexOf(o)?s=null:s+=a._uri.substr(o.length)+"/acl"):s+=null!=r?"buckets/"+e+"/objects/"+r+"/acl":"buckets/"+e+"/acl",s},t.prototype.listACLEntries=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._listACLEntriesUsingCallbacks(r)}}(this))},t.prototype._listACLEntriesUsingCallbacks=function(t){var e,i;return f.Kii.logger("Listing ACL entries"),i=this._getRequest({path:this.aclPath(),withApp:!0}),e={success:function(e){return function(i,n){var r,s,o,u,a,l,c,h;if(300>n&&n>=200){u=[];for(o in i){if(l=i[o],"WRITE_EXISTING_OBJECT"===o)r=f.KiiACLAction.KiiACLObjectActionWrite;else if("READ_EXISTING_OBJECT"===o)r=f.KiiACLAction.KiiACLObjectActionRead;else if("QUERY_OBJECTS_IN_BUCKET"===o)r=f.KiiACLAction.KiiACLBucketActionQueryObjects;else if("CREATE_OBJECTS_IN_BUCKET"===o)r=f.KiiACLAction.KiiACLBucketActionCreateObjects;else if("DROP_BUCKET_WITH_ALL_CONTENT"===o)r=f.KiiACLAction.KiiACLBucketActionDropBucket;else if("READ_OBJECTS_IN_BUCKET"===o)r=f.KiiACLAction.KiiACLBucketActionReadObjects;else if("SUBSCRIBE_TO_TOPIC"===o)r=f.KiiACLAction.KiiACLSubscribeToTopic;else{if("SEND_MESSAGE_TO_TOPIC"!==o)continue;r=f.KiiACLAction.KiiACLSendMessageToTopic}for(c=0,h=l.length;h>c;c++){if(s=l[c],null!=s.groupID)a=e._groupWithID(s.groupID);else if(null!=s.userID)a=e._userWithID(s.userID);else{if(null==s.thingID)continue;a=e._thingWithID(s.thingID)}u.push(f.KiiACLEntry.entryWithSubject(a,r))}}return t.success(e,u)}return t.failure(e,"Unable to retrieve ACL list")}}(this),failure:function(e){return function(i,n){return t.failure(e,i)}}(this)},i.execute(e,!1)},t.prototype.putACLEntry=function(t){var e;if(!(t instanceof f.KiiACLEntry))throw new f.InvalidArgumentException("invalid entry");return e=this._getKeyOfEntry(t),this._entriesMap[e]=t},t.prototype.removeACLEntry=function(t){var e;if(!(t instanceof f.KiiACLEntry))throw new f.InvalidArgumentException("invalid entry");return e=this._getKeyOfEntry(t),delete this._entriesMap[e]},t.prototype._getKeyOfEntry=function(t){var e,i,n;return e=t.getActionString(),i=t.getEntityString(),n=t.getGrant(),""+e+"/"+i+":"+n},t.prototype.save=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._saveUsingCallbacks(r)}}(this))},t.prototype._saveUsingCallbacks=function(t){var e;return f.Kii.logger("SAving acl"),this._entriesMap?(e=Object.keys(this._entriesMap),f.Kii.logger("Saving total entries : "+e.length),e.length<1?void t.failure(this,"There is no entry to save."):this._saveItr(e,0,t)):void t.failure(this,"There is no entry to save.")},t.prototype._saveItr=function(t,e,i){var n,r,s,o;return n=this._entriesMap[t[e]],r=""+this.aclPath()+"/"+n.getActionString()+"/"+n.getEntityString(),f.Kii.logger("Saving single @path: "+r),f.Kii.logger("Saving  entries index : "+e),s=this._getRequest({path:r,withApp:!0}),s.setMethod(n.getGrant()===!0?"PUT":"DELETE"),o=null,s.execute({success:function(r){return function(s,o,u){return r.removeACLEntry(n),e<t.length-1?r._saveItr(t,e+1,i):i.success(r)}}(this),failure:function(t){return function(e,n,r){return i.failure(t,e)}}(this)},!1)},t.aclWithParent=function(t){var e;return e=new f.KiiACL,e._setParent(t),e},t.prototype._getRequest=function(t){var e,i,n;return e=t.path,n=t.withApp,i=new o(e,n)},t.prototype._groupWithID=function(t){var e;return e=f.KiiGroup.groupWithID(t)},t.prototype._userWithID=function(t){return"ANONYMOUS_USER"===t?new f.KiiAnonymousUser:"ANY_AUTHENTICATED_USER"===t?new f.KiiAnyAuthenticatedUser:f.KiiUser.userWithID(t)},t.prototype._thingWithID=function(t){return f.KiiThing.thingWithID(t)},t}(),f.KiiACLAction={KiiACLActionStart:-1,KiiACLBucketActionCreateObjects:0,KiiACLBucketActionQueryObjects:1,KiiACLBucketActionDropBucket:2,KiiACLBucketActionReadObjects:3,KiiACLObjectActionRead:4,KiiACLObjectActionWrite:5,KiiACLSubscribeToTopic:6,KiiACLSendMessageToTopic:7,KiiACLActionEnd:8},f.KiiACLEntry=function(){function t(){this.getEntityString=y(this.getEntityString,this),this.getActionString=y(this.getActionString,this),this.getGrant=y(this.getGrant,this),this.setGrant=y(this.setGrant,this),this.getSubject=y(this.getSubject,this),this.setSubject=y(this.setSubject,this),this.getAction=y(this.getAction,this),this.setAction=y(this.setAction,this),this._action=-1,this._grant=!0}return t.prototype.setAction=function(t){if(t>f.KiiACLAction.KiiACLActionStart&&t<f.KiiACLAction.KiiACLActionEnd)return this._action=t;throw new f.InvalidACLAction},t.prototype.getAction=function(){return this._action},t.prototype.setSubject=function(t){if(t instanceof f.KiiGroup&&null!=t.getID()||t instanceof f.KiiUser&&null!=t.getID()||t instanceof f.KiiAnyAuthenticatedUser||t instanceof f.KiiAnonymousUser||t instanceof f.KiiThing&&null!=t.getThingID())return this._subject=t;throw new f.InvalidACLSubject},t.prototype.getSubject=function(){return this._subject},t.prototype.setGrant=function(t){if(t===!0||t===!1)return this._grant=t;throw new f.InvalidACLGrant},t.prototype.getGrant=function(){return this._grant},t.entryWithSubject=function(t,e){var i;return f.Kii.logger("EWS: "+t+", "+e),i=new f.KiiACLEntry,i.setSubject(t),i.setAction(e),i},t.prototype.getActionString=function(){var t;switch(f.Kii.logger("Action: "+this.action),this._action){case f.KiiACLAction.KiiACLBucketActionCreateObjects:t="CREATE_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLBucketActionQueryObjects:t="QUERY_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLBucketActionDropBucket:t="DROP_BUCKET_WITH_ALL_CONTENT";break;case f.KiiACLAction.KiiACLBucketActionReadObjects:t="READ_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLObjectActionRead:t="READ_EXISTING_OBJECT";break;case f.KiiACLAction.KiiACLObjectActionWrite:t="WRITE_EXISTING_OBJECT";break;case f.KiiACLAction.KiiACLSubscribeToTopic:t="SUBSCRIBE_TO_TOPIC";break;case f.KiiACLAction.KiiACLSendMessageToTopic:t="SEND_MESSAGE_TO_TOPIC";break;default:return t}return t},t.prototype.getEntityString=function(){var t,e;return this._subject instanceof f.KiiGroup?(t=this._subject.getUUID(),e="GroupID"):this._subject instanceof f.KiiUser?(t=this._subject.getUUID(),e="UserID"):this._subject instanceof f.KiiAnyAuthenticatedUser?(e="UserID",t="ANY_AUTHENTICATED_USER"):this._subject instanceof f.KiiAnonymousUser?(e="UserID",t="ANONYMOUS_USER"):this._subject instanceof f.KiiThing&&(e="ThingID",t=this._subject.getThingID()),""+e+":"+t},t}(),f.KiiBucket=function(){function t(t,e){if(this.objectWithJSON=y(this.objectWithJSON,this),this._getHttpUri=y(this._getHttpUri,this),this._generatePath=y(this._generatePath,this),this._getRequest=y(this._getRequest,this),this._deleteUsingCallbacks=y(this._deleteUsingCallbacks,this),this["delete"]=y(this["delete"],this),this.count=y(this.count,this),this._countWithQueryUsingCallbacks=y(this._countWithQueryUsingCallbacks,this),this.countWithQuery=y(this.countWithQuery,this),this._executeQueryUsingCallbacks=y(this._executeQueryUsingCallbacks,this),this.executeQuery=y(this.executeQuery,this),this.acl=y(this.acl,this),this.createObjectWithID=y(this.createObjectWithID,this),this.createObjectWithType=y(this.createObjectWithType,this),this.createObject=y(this.createObject,this),this._getQualifiedBucketName=y(this._getQualifiedBucketName,this),this._setBucketName=y(this._setBucketName,this),this.getBucketName=y(this.getBucketName,this),this.getThing=y(this.getThing,this),this.getGroup=y(this.getGroup,this),this.getUser=y(this.getUser,this),!l._isNonEmptyString(t))throw f.InvalidArgumentException("Specified bucket name is null or empty.");this._bucketName=t,null!=e&&(e instanceof f.KiiGroup?this._group=e:e instanceof f.KiiUser?this._user=e:e instanceof f.KiiThing&&(this._thing=e))}return t.prototype._className="KiiBucket",t.prototype.getUser=function(){return this._user},t.prototype.getGroup=function(){return this._group},t.prototype.getThing=function(){return this._thing},t.prototype.getBucketName=function(){return this._bucketName},t.prototype._setBucketName=function(t){this._bucketName=t},t.prototype._getQualifiedBucketName=function(){return this._bucketName},t.prototype.createObject=function(){return f.KiiObject.objectWithBucket(this,null)},t.prototype.createObjectWithType=function(t){return f.KiiObject.objectWithBucket(this,t)},t.prototype.createObjectWithID=function(t){if(!f.KiiObject.isValidObjectID(t))throw f.InvalidArgumentException("Specified obejctID is invalid.");return f.KiiObject.objectWithID(this,t)},t.prototype.acl=function(){return f.KiiACL.aclWithParent(this)},t.prototype.executeQuery=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._executeQueryUsingCallbacks(t,s)}}(this))},t.prototype._executeQueryUsingCallbacks=function(t,e){var i,n,r,s,o;try{return s=this._generatePath()+"/query",i={},null!=t?i=t._dictValue():i.bucketQuery={clause:f.KiiQuery._emptyDictValue()},o=this._getRequest({path:s,withApp:!0}),o.setMethod("POST"),o.setContentType("application/vnd.kii.QueryRequest+json"),o.setData(i),r={success:function(i){return function(n,r){var s,o,u,a,l,c;if(300>r&&r>=200){for(u=[],c=n.results,a=0,l=c.length;l>a;a++)o=c[a],u.push(i.objectWithJSON(o));if(null!=n.nextPaginationKey?(s=new f.KiiQuery(t),s.setPaginationKey(n.nextPaginationKey)):s=null,null!=e)return e.success(t,u,s)}else if(null!=e)return e.failure(i,"Unable to parse response")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},o.execute(r,!1)}catch(u){return n=u,e.failure(this,n)}},t.prototype.countWithQuery=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._countWithQueryUsingCallbacks(t,s)}}(this))},t.prototype._countWithQueryUsingCallbacks=function(t,e){var i,n,r,s;return r=this._generatePath()+"/query",i={},null!=t?i=t._dictValue():(i.bucketQuery={clause:f.KiiQuery._emptyDictValue()},t=f.KiiQuery.queryWithClause()),i.bucketQuery.aggregations=[{type:"COUNT",putAggregationInto:"count_field"}],s=this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.QueryRequest+json"),s.setData(i),n={success:function(i){return function(n,r){var s;if(300>r&&r>=200){if(s=n.aggregations.count_field,null!=e)return e.success(i,t,s)}else if(null!=e)return e.failure(i,"Unable to parse response")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},s.execute(n,!1)},t.prototype.count=function(t){var e;return e=f.KiiQuery.queryWithClause(),this.countWithQuery(e,t)},t.prototype["delete"]=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._deleteUsingCallbacks(r)}}(this))},t.prototype._deleteUsingCallbacks=function(t){var e,i;return i=this._getRequest({path:this._generatePath(),withApp:!0}),i.setMethod("DELETE"),e={success:function(e){return function(i,n){return null!=t?t.success(e):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(e,!0)},t._bucketWithName=function(t,e){var i;return i=new f.KiiBucket(t,e)},t.prototype._getRequest=function(t){var e,i,n;return e=t.path,n=t.withApp,i=new o(e,n)},t.prototype._generatePath=function(){var t;return t=null!=this._user?"/users/"+this._user.getUUID()+"/buckets/"+this._getQualifiedBucketName():null!=this._group?"/groups/"+this._group.getUUID()+"/buckets/"+this._getQualifiedBucketName():null!=this._thing?"/things/"+this._thing.getThingID()+"/buckets/"+this._getQualifiedBucketName():"/buckets/"+this._getQualifiedBucketName()},t.prototype._getHttpUri=function(){return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/"+this._generatePath()},t.prototype.objectWithJSON=function(t){var e;return e=this.createObject(),e._updateWithJSON(t),e},t}(),f.KiiEncryptedBucket=function(t){function e(t,i){if(this._getQualifiedBucketName=y(this._getQualifiedBucketName,this),!l._isNonEmptyString(t))throw f.InvalidArgumentException("Specified bucket name is null or empty.");f.KiiEncryptedBucket._isEncrypted(t)?e.__super__.constructor.call(this,t.replace("CRYPTO:",""),i):e.__super__.constructor.call(this,t,i)}return k(e,t),e.prototype._getQualifiedBucketName=function(){return"CRYPTO:"+this._bucketName},e._bucketWithName=function(t,e){var i;return i=new f.KiiEncryptedBucket(t,e)},e._isEncrypted=function(t){var e;return e=0===t.indexOf("CRYPTO:")},e}(f.KiiBucket),f.KiiEncryptedBucketWithToken=function(t){function e(t,i,n){this.acl=y(this.acl,this),this.createObjectWithID=y(this.createObjectWithID,this),this.createObjectWithType=y(this.createObjectWithType,this),this.createObject=y(this.createObject,this),this._getRequest=y(this._getRequest,this),e.__super__.constructor.call(this,t,i),this._authToken=n}return k(e,t),e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._authToken),i},e.prototype.createObject=function(){return f.KiiObjectWithToken.objectWithBucket(this,null,this._authToken)},e.prototype.createObjectWithType=function(t){return f.KiiObjectWithToken.objectWithBucket(this,t,this._authToken)},e.prototype.createObjectWithID=function(t){return f.KiiObjectWithToken.objectWithID(this,t,this._authToken)},e.prototype.acl=function(){var t;return t=new f.KiiACLWithToken(this,this._authToken)},e}(f.KiiEncryptedBucket),f.KiiBucketWithToken=function(t){function e(t,i,n){this.acl=y(this.acl,this),this.createObjectWithID=y(this.createObjectWithID,this),this.createObjectWithType=y(this.createObjectWithType,this),this.createObject=y(this.createObject,this),this._getRequest=y(this._getRequest,this),e.__super__.constructor.call(this,t,i),this._authToken=n}return k(e,t),e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._authToken),i},e.prototype.createObject=function(){return f.KiiObjectWithToken.objectWithBucket(this,null,this._authToken)},e.prototype.createObjectWithType=function(t){return f.KiiObjectWithToken.objectWithBucket(this,t,this._authToken)},e.prototype.createObjectWithID=function(t){return f.KiiObjectWithToken.objectWithID(this,t,this._authToken)},e.prototype.acl=function(){var t;return t=new f.KiiACLWithToken(this,this._authToken)},e}(f.KiiBucket),f.KiiGroup=function(){function t(){this._setAuthToken=y(this._setAuthToken,this),this._getHttpURI=y(this._getHttpURI,this),this._listTopicsUsingCallbacks=y(this._listTopicsUsingCallbacks,this),this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this._setOwnerFromContext=y(this._setOwnerFromContext,this),this._userWithID=y(this._userWithID,this),this._getRequest=y(this._getRequest,this),this._updateWithJSON=y(this._updateWithJSON,this),this._getOwnerUsingCallbacks=y(this._getOwnerUsingCallbacks,this),this.getOwner=y(this.getOwner,this),this._deleteUsingCallbacks=y(this._deleteUsingCallbacks,this),this["delete"]=y(this["delete"],this),this._refreshUsingCallbacks=y(this._refreshUsingCallbacks,this),this.refresh=y(this.refresh,this),this._saveWithOwnerUsingCallbacks=y(this._saveWithOwnerUsingCallbacks,this),this.saveWithOwner=y(this.saveWithOwner,this),this._saveUsingCallbacks=y(this._saveUsingCallbacks,this),this.save=y(this.save,this),this._changeGroupNameUsingCallbacks=y(this._changeGroupNameUsingCallbacks,this),this.changeGroupName=y(this.changeGroupName,this),this._changeOwner=y(this._changeOwner,this),this._saveMembers=y(this._saveMembers,this),this._getMemberListUsingCallbacks=y(this._getMemberListUsingCallbacks,this),this.getMemberList=y(this.getMemberList,this),this._removeMember=y(this._removeMember,this),this._addMember=y(this._addMember,this),this.removeUser=y(this.removeUser,this),this.addUser=y(this.addUser,this),this.encryptedBucketWithName=y(this.encryptedBucketWithName,this),this.bucketWithName=y(this.bucketWithName,this),this.objectURI=y(this.objectURI,this),this._setOwner=y(this._setOwner,this),this.getCachedOwner=y(this.getCachedOwner,this),this._setName=y(this._setName,this),this.getName=y(this.getName,this),this.getID=y(this.getID,this),this._setUUID=y(this._setUUID,this),this.getUUID=y(this.getUUID,this),this._setAddMembers=y(this._setAddMembers,this),this._getRemoveMembers=y(this._getRemoveMembers,this),this._getAddMembers=y(this._getAddMembers,this),this._addMembers={},this._removeMembers={}}return t.prototype._getAddMembers=function(){return this._addMembers},t.prototype._getRemoveMembers=function(){return this._removeMembers},t.prototype._setAddMembers=function(t){var e,i,n,r;if(null!=t){for(r=[],i=0,n=t.length;n>i;i++)e=t[i],r.push(this.addUser(e));return r}},t.prototype.getUUID=function(){return this._uuid},t.prototype._setUUID=function(t){this._uuid=t},t.prototype.getID=function(){return this._uuid},t.prototype.getName=function(){return this._groupName},t.prototype._setName=function(t){this._groupName=t},t.prototype.getCachedOwner=function(){return this._owner},t.prototype._setOwner=function(t){this._owner=t},t.prototype.objectURI=function(){return null!=this._uuid?"kiicloud://groups/"+this._uuid:null},t.registerGroupWithID=function(e,i,n,r){return new Promise(function(s,o){var u,a,c;return u={success:function(){return null!=r&&r.success.apply(r,arguments),s(arguments[0])},failure:function(){var t;return null!=r&&r.failure.apply(r,arguments),t=l._Error(arguments[1],arguments[0]),t.addMembersArray=arguments[2],t.removeMembersArray=arguments[3],o(t)}},t._registerGroupWithIDUsingCallbacks(null!=(a=f.KiiUser.getCurrentUser())?a.getAccessToken():void 0,e,i,null!=(c=f.Kii.getCurrentUser())?c.getID():void 0,n,u)})},t._registerGroupWithIDUsingCallbacks=function(e,i,n,r,s,o){var u,a,c,p,g,_,d,y,m,k;if(!l._isNonEmptyString(i))return void o.failure(null,"groupID is null or empty",s,null);if(!l._validateGroupID(i))return void o.failure(null,"invalid groupID : "+i,s,null);if(!l._isNonEmptyString(n))return void o.failure(null,"groupName is null or empty",s,null);if(null==r)return void o.failure(null,"owner is null",s,null);if(_=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/groups/"+i,d=h.createXHRWrapper("PUT",_),y=d.xhr,d.setKiiHeaders(),d.setAuthToken(e),d.setContentType("application/vnd.kii.GroupCreationRequest+json"),u={},u.name=n,u.owner=r,null!=s&&s.length>0){for(p=[],a=m=0,k=s.length;k>m;a=++m)c=s[a],p.push(c.getID());u.members=p}return g={success:function(){var e;try{return e=t.groupWithNameAndMembers(n,s),e._setUUID(i),o.success(e)}catch(r){return o.failure(null,d.getErrorString("failed to register group."))}},failure:function(){var t;return t=d.getErrorString("failed to register group."),o.failure(null,t,s,null)}},d.sendData(JSON.stringify(u),g)},t.prototype.bucketWithName=function(t){var e;return e=new f.KiiBucket(t,this)},t.prototype.encryptedBucketWithName=function(t){var e;return e=new f.KiiEncryptedBucket(t,this)},t.prototype.addUser=function(t){var e;return null==t?void f.Kii.logger("Passed member is null"):null==t.getUUID()?void f.Kii.logger("Passed member ID is null"):(e=t.getUUID(),e in this._addMembers||(this._addMembers[e]=t),e in this._removeMembers?delete this._removeMembers[e]:void 0)},t.prototype.removeUser=function(t){var e;return null==t?void f.Kii.logger("Passed member is null"):null==t.getUUID()?void f.Kii.logger("Passed member uuid is null"):(e=t.getUUID(),e in this._removeMembers||(this._removeMembers[e]=t),e in this._addMembers?delete this._addMembers[e]:void 0)},t.prototype._addMember=function(t,e){var i,n;return f.Kii.logger("Adding member "+t.getUUID()+" to group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members/"+t.getUUID(),withApp:!0}),n.setMethod("PUT"),i={success:function(i){return function(n,r){return delete i._addMembers[t.getUUID()],i._saveMembers(e)}}(this),failure:function(i){return function(n,r){var s,o,u;return s=function(){var e,i;e=this._addMembers,i=[];for(u in e)t=e[u],i.push(t);return i}.call(i),o=function(){var e,i;e=this._removeMembers,i=[];for(u in e)t=e[u],i.push(t);return i}.call(i),e.failure(i,n,s,o)}}(this)},n.execute(i,!1)},t.prototype._removeMember=function(t,e){var i,n;return f.Kii.logger("Removing member "+t.getUUID()+" to group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members/"+t.getUUID(),withApp:!0}),n.setMethod("DELETE"),i={success:function(i){return function(n,r){return delete i._getRemoveMembers()[t.getUUID()],i._saveMembers(e)}}(this),failure:function(i){return function(n,r){var s,o,u;return s=function(){var e,i;e=this._addMembers,i=[];for(u in e)t=e[u],i.push(t);return i}.call(i),o=function(){var e,i;e=this._removeMembers,i=[];for(u in e)t=e[u],i.push(t);return i}.call(i),e.failure(i,n,s,o)}}(this)},n.execute(i,!1)},t.prototype.getMemberList=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){
return null!=t&&t.success.apply(t,arguments),i(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._getMemberListUsingCallbacks(r)}}(this))},t.prototype._getMemberListUsingCallbacks=function(t){var e,i;return f.Kii.logger("Getting member list for group "+this._groupName),i=this._getRequest({path:"/groups/"+this._uuid+"/members",withApp:!0}),i.setAccept("application/vnd.kii.MembersRetrievalResponse+json"),e={success:function(e){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],o=i.members,u=0,a=o.length;a>u;u++)r=o[u],s.push(e._userWithID(r.userID));if(null!=t)return t.success(e,s)}else if(null!=t)return t.failure(e,"Unable to get member list of group")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(e,!1)},t.prototype._saveMembers=function(t){var e,i;return e=Object.keys(this._addMembers),i=Object.keys(this._removeMembers),0===e.length&&0===i.length&&t.success(this),e.length>0?void this._addMember(this._addMembers[e[0]],t):void(i.length>0&&this._removeMember(this._removeMembers[i[0]],t))},t.prototype._changeOwner=function(t,e){var i,n,r;return n=this._getRequest({path:"/groups/"+this._uuid+"/owner",withApp:!0}),n.setContentType("application/vnd.kii.GroupOwnerChangeRequest+json"),n.setMethod("PUT"),i={},i.owner=t,n.setData(i),r={success:function(t){return function(i,n){return 300>n&&n>=200?e.success(t):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!1)},t.prototype.changeGroupName=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._changeGroupNameUsingCallbacks(t,s)}}(this))},t.prototype._changeGroupNameUsingCallbacks=function(t,e){var i,n;return f.Kii.logger("Saving group: "+this.name),null!=this._uuid?(i=this._getRequest({path:"/groups/"+this._uuid+"/name",withApp:!0}),i.setContentType("text/plain"),i.setMethod("PUT"),i.setData(t),n={success:function(i){return function(n,r){if(300>r&&r>=200){if(i._setName(t),null!=e)return e.success(i)}else if(null!=e)return e.failure(i,"Unable to change group name - invalid response")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(n,!0)):e.failure(this,"Invalid group. Save the group on the server before updating the name.")},t.prototype.save=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){var i;return null!=t&&t.failure.apply(t,arguments),i=l._Error(arguments[1],e),i.addMembersArray=arguments[2],i.removeMembersArray=arguments[3],n(i)}},e._saveUsingCallbacks(r)}}(this))},t.prototype._saveUsingCallbacks=function(t){var e,i,n;return f.Kii.logger("Saving group: "+this.name),null==this._uuid?(i=this._getRequest({path:"/groups",withApp:!0}),i.setContentType("application/vnd.kii.GroupCreationRequest+json"),i.setMethod("POST"),e={},null!=this._groupName&&(e.name=this._groupName),this._setOwnerFromContext(e),i.setData(e),n={success:function(e){return function(i,n){return 300>n&&n>=200?(e._setUUID(i.groupID),e._saveMembers(t)):void 0}}(this),failure:function(e){return function(i,n){var r,s,o,u;return null!=t?(r=function(){var t,e;t=this._addMembers,e=[];for(u in t)s=t[u],e.push(s);return e}.call(e),o=function(){var t,e;t=this._removeMembers,e=[];for(u in t)s=t[u],e.push(s);return e}.call(e),t.failure(e,i,r,o)):void 0}}(this)},i.execute(n,!1)):this._saveMembers(t)},t.prototype.saveWithOwner=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){var t;return null!=e&&e.failure.apply(e,arguments),t=l._Error(arguments[1],i),t.addMembersArray=arguments[2],t.removeMembersArray=arguments[3],r(t)}},i._saveWithOwnerUsingCallbacks(t,s)}}(this))},t.prototype._saveWithOwnerUsingCallbacks=function(t,e){var i,n,r,s;return null==this._uuid?(n=this._getRequest({path:"/groups",withApp:!0}),n.setContentType("application/vnd.kii.GroupCreationRequest+json"),n.setMethod("POST"),i={},null!=this._groupName&&(i.name=this._groupName),i.owner=t,n.setData(i),r={success:function(t){return function(i,n){return 300>n&&n>=200?(t._setUUID(i.groupID),t._saveMembers(e)):void 0}}(this),failure:function(t){return function(i,n){var r,s,o,u;return null!=e?(r=function(){var t,e;t=this._addMembers,e=[];for(u in t)s=t[u],e.push(s);return e}.call(t),o=function(){var t,e;t=this._removeMembers,e=[];for(u in t)s=t[u],e.push(s);return e}.call(t),e.failure(t,i,r,o)):void 0}}(this)},n.execute(r,!1)):(s={success:function(i){return function(n){return i._changeOwner(t,e)}}(this),failure:function(t){return function(i,n){var r,s,o,u;return r=function(){var t,e;t=this._addMembers,e=[];for(u in t)s=t[u],e.push(s);return e}.call(t),o=function(){var t,e;t=this._removeMembers,e=[];for(u in t)s=t[u],e.push(s);return e}.call(t),e.failure(t,n,r,o)}}(this)},this._saveMembers(s))},t.prototype.refresh=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._refreshUsingCallbacks(r)}}(this))},t.prototype._refreshUsingCallbacks=function(t){var e,i;return f.Kii.logger("Refreshing group: "+this._groupName),i=new this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),i.setAccept("application/vnd.kii.GroupRetrievalResponse+json"),e={success:function(e){return function(i,n){return e._updateWithJSON(i),null!=t?t.success(e):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(e,!1)},t.prototype["delete"]=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._deleteUsingCallbacks(r)}}(this))},t.prototype._deleteUsingCallbacks=function(t){var e,i;return f.Kii.logger("Deleting group: "+this._groupName),i=this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),i.setMethod("DELETE"),e={success:function(e){return function(i,n){return 300>n&&n>=200&&null!=t?t.success(e):null!=t?t.failure(e,"Unable to parse response"):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(e,!0)},t.prototype.getOwner=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._getOwnerUsingCallbacks(r)}}(this))},t.prototype._getOwnerUsingCallbacks=function(t){return f.Kii.logger("Getting owner of group "+this._groupName),this.refresh({success:function(e){return function(e){return null!=t?t.success(e,e.getCachedOwner()):void 0}}(this),failure:function(e){return function(e,i){return null!=t?t.failure(e,i):void 0}}(this)})},t.groupWithName=function(t){return f.KiiGroup.groupWithNameAndMembers(t,null)},t.groupWithNameAndMembers=function(t,e){var i;return i=new f.KiiGroup,i._setName(t),i._setAddMembers(e),i},t.groupWithID=function(t){var e;if(null==t||""===t)throw new f.InvalidArgumentException("groupID should not null or empty");return e=new f.KiiGroup,e._setUUID(t),e},t.groupWithURI=function(t){var e,i,n,r;if(n=null,r=t.substr("kiicloud://".length),i=r.split("/"),e=i.length,!(e>0))throw new f.InvalidURIException;return n=new f.KiiGroup,n._setUUID(i[e-1]),n},t._groupWithJSON=function(t){var e;return e=new f.KiiGroup,null!=t.groupID&&e._setUUID(t.groupID),null!=t.name&&e._setName(t.name),null!=t.owner&&e._setOwner(f.KiiUser.userWithID(t.owner)),e},t.prototype._updateWithJSON=function(t){return null!=t.groupID&&this._setUUID(t.groupID),null!=t.name?this._setName(t.name):this._setName(null),null!=t.owner?this._setOwner(this._userWithID(t.owner)):this._setOwner(null)},t.prototype._getRequest=function(t){var e,i,n;return e=t.path,n=t.withApp,i=new o(e,n)},t.prototype._userWithID=function(t){var e;return e=f.KiiUser.userWithID(t)},t.prototype._setOwnerFromContext=function(t){return null!=f.Kii.getCurrentUser()?(this._owner=f.Kii.getCurrentUser(),t.owner=this._owner.getUUID()):void 0},t.prototype.topicWithName=function(t){var e,i;if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");if(e=this.getID(),!e)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopic(i,t)},t.prototype.listTopics=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,e)}}(this))},t.prototype._listTopicsUsingCallbacks=function(t,e){var i,n,r;return n=""+this._getHttpURI()+"/topics","string"==typeof e&&""!==e&&(n=n+"?paginationKey="+encodeURIComponent(e)),r=h.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(e){return function(){var i,n,s,o,u,a;for(i=JSON.parse(r.xhr.responseText),s=[],a=i.topics,o=0,u=a.length;u>o;o++)n=a[o],s.push(e.topicWithName(n.topicID));return null!=t?t.success(s,void 0===i.paginationKey?null:i.paginationKey):void 0}}(this),failure:function(e){return function(){var i,n;return n=r.getErrorString("list topics"),i=l._Error(n,e),null!=t?t.failure(i):void 0}}(this)},r.send(i)},t.prototype._getHttpURI=function(){return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/groups/"+this.getID()},t.prototype._setAuthToken=function(t){return t.setCurrentUserToken()},t}(),f.KiiObject=function(){function t(){this._deleteBodyUsingCallbacks=y(this._deleteBodyUsingCallbacks,this),this.deleteBody=y(this.deleteBody,this),this._publishBodyExpiresInUsingCallbacks=y(this._publishBodyExpiresInUsingCallbacks,this),this.publishBodyExpiresIn=y(this.publishBodyExpiresIn,this),this._publishBodyExpiresAtUsingCallbacks=y(this._publishBodyExpiresAtUsingCallbacks,this),this.publishBodyExpiresAt=y(this.publishBodyExpiresAt,this),this._publishBodyUsingCallbacks=y(this._publishBodyUsingCallbacks,this),this.publishBody=y(this.publishBody,this),this._downloadBodyUsingCallbacks=y(this._downloadBodyUsingCallbacks,this),this.downloadBody=y(this.downloadBody,this),this._uploadBodyUsingCallbacks=y(this._uploadBodyUsingCallbacks,this),this.uploadBody=y(this.uploadBody,this),this._moveBodyUsingCallbacks=y(this._moveBodyUsingCallbacks,this),this.moveBody=y(this.moveBody,this),this._parseObjectUri=y(this._parseObjectUri,this),this._userWithID=y(this._userWithID,this),this._setAuthorizationHeader=y(this._setAuthorizationHeader,this),this._getToken=y(this._getToken,this),this._getRequest=y(this._getRequest,this),this._setETag=y(this._setETag,this),this._deleteUsingCallbacks=y(this._deleteUsingCallbacks,this),this["delete"]=y(this["delete"],this),this._refreshUsingCallbacks=y(this._refreshUsingCallbacks,this),this.refresh=y(this.refresh,this),this._saveUsingCallbacks=y(this._saveUsingCallbacks,this),this.save=y(this.save,this),this._saveAllFieldsUsingCallbacks=y(this._saveAllFieldsUsingCallbacks,this),this.saveAllFields=y(this.saveAllFields,this),this._performUpdate=y(this._performUpdate,this),this._performSave=y(this._performSave,this),this._updateWithJSON=y(this._updateWithJSON,this),this._convertToObjectType=y(this._convertToObjectType,this),this.objectURI=y(this.objectURI,this),this.objectACL=y(this.objectACL,this),this.getGeoPoint=y(this.getGeoPoint,this),this.setGeoPoint=y(this.setGeoPoint,this),this.remove=y(this.remove,this),this.getKeys=y(this.getKeys,this),this.get=y(this.get,this),this.set=y(this.set,this),this._getPath=y(this._getPath,this),this._setBodyContentType=y(this._setBodyContentType,this),this.getBodyContentType=y(this.getBodyContentType,this),this._setBucket=y(this._setBucket,this),this.getBucket=y(this.getBucket,this),this._setObjectType=y(this._setObjectType,this),this.getObjectType=y(this.getObjectType,this),this._setModified=y(this._setModified,this),this.getModified=y(this.getModified,this),this._setCreated=y(this._setCreated,this),this.getCreated=y(this.getCreated,this),this.getID=y(this.getID,this),this._setUUID=y(this._setUUID,this),this.getUUID=y(this.getUUID,this),this._customInfo={},this._alteredFields=[]}return t.prototype.getUUID=function(){return this._uuid},t.prototype._setUUID=function(t){this._uuid=t},t.prototype.getID=function(){return this._uuid},t.prototype.getCreated=function(){return this._created},t.prototype._setCreated=function(t){this._created=t},t.prototype.getModified=function(){return this._modified},t.prototype._setModified=function(t){this._modified=t},t.prototype.getObjectType=function(){return this._objectType},t.prototype._setObjectType=function(t){this._objectType=t},t.prototype.getBucket=function(){return f.Kii.logger("GEtting bucket "+this._bucket),this._bucket},t.prototype._setBucket=function(t){this._bucket=t},t.prototype.getBodyContentType=function(){return this._bodyContentType},t.prototype._setBodyContentType=function(t){this._bodyContentType=t},t.prototype._getPath=function(){var t;return t=null!=this._bucket.getUser()?"/users/"+this._bucket.getUser().getUUID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":null!=this._bucket.getGroup()?"/groups/"+this._bucket.getGroup().getUUID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":null!=this._bucket.getThing()?"/things/"+this._bucket.getThing().getThingID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/",null!=this._uuid&&(t+=this._uuid),t},t.prototype.set=function(t,e){return l._isNonEmptyString(t)&&0!==t.indexOf("_")?(this._customInfo[t]=e,this._alteredFields.push(t)):void f.Kii.logger("[WARN] Reserved key is used for custom field. key="+t)},t.prototype.get=function(t){return this._customInfo[t]},t.prototype.getKeys=function(){var t,e;e=[];for(t in this._customInfo)e.push(t);return e},t.prototype.remove=function(t){var e;return delete this._customInfo[t],e=this._alteredFields.indexOf(t),e>=0?this._alteredFields.splice(e,1):void 0},t.prototype.setGeoPoint=function(t,e){if(!(e instanceof f.KiiGeoPoint))throw f.InvalidArgumentException("Specified kiiGeoPoint is not an instance of KiiGeoPoint");return this._customInfo[t]=e._toDict(),this._alteredFields.push(t)},t.prototype.getGeoPoint=function(t){var e,i,n;return n=this._customInfo[t],e=n.lat,i=n.lon,f.KiiGeoPoint.geoPoint(e,i)},t.prototype.objectACL=function(){return f.KiiACL.aclWithParent(this)},t.prototype.objectURI=function(){var t,e;return t="kiicloud://",null!=this._bucket&&null!=this._uuid&&(e=t,null!=this._bucket.getGroup()?e+="groups/"+this._bucket.getGroup().getUUID()+"/":null!=this._bucket.getUser()?e+="users/"+this._bucket.getUser().getUUID()+"/":null!=this._bucket.getThing()&&(e+="things/"+this._bucket.getThing().getThingID()+"/"),e+="buckets/"+this._bucket._getQualifiedBucketName()+"/objects/"+this._uuid),e},t.prototype._convertToObjectType=function(t){var e;return"application/json"===t?{success:!0,type:null}:(e=t.match(RegExp("$application/vnd\\."+f.Kii.getAppID()+"\\.([^\\.])+\\+json")),null!=e?{success:!0,type:e}:{success:!1,type:null})},t.prototype._updateWithJSON=function(t,e){var i,n,r;e||(this._customInfo={}),r=[];for(i in t)n=t[i],"_id"===i?null==this._uuid?(f.Kii.logger("Setting uuid: "+n),r.push(this._uuid=n)):r.push(void 0):"_created"===i?r.push(this._created=n):"_modified"===i?r.push(this._modified=n):"_owner"===i?r.push(this._owner=this._userWithID(n)):"_dataType"===i?r.push(this._objectType=n):"_calculated"===i?r.push(this._customInfo[i]=n):"_"!==i[0]?r.push(this._customInfo[i]=n):"_version"===i?r.push(this._etag=n):r.push(void 0);return r},t.prototype._performSave=function(t){var e,i,n,r;return i=this._getPath(),i=i.slice(0,+(i.length-2)+1||9e9),n=new this._getRequest({path:i,withApp:!0}),n.setMethod("POST"),e=this._customInfo,n.setData(e),null!=this._objectType&&n.setContentType("application/vnd."+f.Kii.getAppID()+"."+this._objectType+"+json"),r={success:function(e){return function(i,n,r){var s;if(300>n&&n>=200){if(e._etag=r.etag,null==i.objectID)return t.failure(e,"No objectID response");if(e._uuid=i.objectID,null!=i.createdAt&&(e._created=i.createdAt),null!=i.dataType&&(s=e._convertToObjectType(i.dataType),s.success&&(e._objectType=s.type)),e._modified=e._created,e._alteredFields=[],null!=t)return t.success(e)}else if(null!=t)return t.failure(e,"Unable to parse response")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!1)},t.prototype._performUpdate=function(t,e,i){var n,r,s,o,u,a,l,c,h;if(o=this._getPath(),u=new this._getRequest({path:o,withApp:!0}),n={},t)for(u.addHeader("X-HTTP-Method-Override","PATCH"),u.setMethod("POST"),h=this._alteredFields,l=0,c=h.length;c>l;l++)s=h[l],n[s]=this._customInfo[s];else u.setMethod("PUT"),n=this._customInfo;if(u.setData(n),r=this._created>0,!i)if(r){if(null==this._etag)return void e.failure(this,"IllegalState! Call KiiObject#refresh() prior call this method.");u.addHeader("If-Match",this._etag)}else{if(t&&null==this._etag)return void e.failure(this,"IllegalState! Call KiiObject#refresh() prior call this method.");u.addHeader("If-None-Match","*")}return null!=this._objectType&&u.setContentType("application/vnd."+f.Kii.getAppID()+"."+this._objectType+"+json"),a={success:function(i){return function(n,r,s){if(300>r&&r>=200){if(i._etag=s.etag,t?i._updateWithJSON(n,!0):(null!=n.createdAt&&(i._created=n.createdAt),null!=n.modifiedAt&&(i._modified=n.modifiedAt)),i._alteredFields=[],null!=e)return e.success(i)}else if(null!=e)return e.failure(i,"Unable to parse response")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},u.execute(a,!1)},t.prototype.saveAllFields=function(t,e){return null==e&&(e=!0),new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._saveAllFieldsUsingCallbacks(s,e)}}(this))},t.prototype._saveAllFieldsUsingCallbacks=function(t,e){return null==e&&(e=!0),null!=this._uuid?this._performUpdate(!1,t,e):this._performSave(t)},t.prototype.save=function(t,e){return null==e&&(e=!0),new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._saveUsingCallbacks(s,e)}}(this))},t.prototype._saveUsingCallbacks=function(t,e){return null==e&&(e=!0),null!=this._uuid?this._performUpdate(!0,t,e):this._performSave(t)},t.prototype.refresh=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._refreshUsingCallbacks(r)}}(this))},t.prototype._refreshUsingCallbacks=function(t){var e,i,n;return e=this._getPath(),n=new this._getRequest({path:e,withApp:!0}),i={success:function(e){return function(i,n,r){if(300>n&&n>=200){if(e._etag=r.etag,e._updateWithJSON(i,!1),null!=t)return t.success(e)}else if(null!=t)return t.failure(e,"Unable to parse response")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(i,!1)},t.prototype["delete"]=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._deleteUsingCallbacks(r)}}(this))},t.prototype._deleteUsingCallbacks=function(t){var e,i,n;return e=this._getPath(),n=new this._getRequest({path:e,withApp:!0}),n.setMethod("DELETE"),i={success:function(e){return function(i,n){return 300>n&&n>=200&&null!=t?t.success(e):null!=t?t.failure(e,"Unable to parse response"):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(i,!0)},t.objectWithBucket=function(t,e){var i;return f.Kii.logger("Creating object w type: "+e),i=new f.KiiObject,i._setBucket(t),i._setObjectType(e),f.Kii.logger(i),i},t.objectWithID=function(t,e){var i;return f.Kii.logger("Creating object with id: "+e),i=new f.KiiObject,i._setBucket(t),i._setUUID(e),f.Kii.logger(i),i},t.prototype._setETag=function(t){this._etag=t},t.objectWithURI=function(t){var e,i,n,r,s,o,u,a;if(o=t.substr("kiicloud://".length),s=o.split("/"),r=s.length,f.Kii.logger(s),!(r>=4))throw new f.InvalidURIException;return i=4===r?1:3,n=s[i],a=null,"groups"===s[0]?a=new f.KiiGroup.groupWithID(s[1]):"users"===s[0]?a=f.KiiUser.userWithID(s[1]):"things"===s[0]&&(a=f.KiiThing.thingWithID(s[1])),e=null,e=f.KiiEncryptedBucket._isEncrypted(n)?new f.KiiEncryptedBucket._bucketWithName(n,a):new f.KiiBucket._bucketWithName(n,a),f.Kii.logger(e),u=e.createObject(),u._setUUID(s[r-1]),f.Kii.logger(u),u},t.prototype._getRequest=function(t){var e,i,n;return e=t.path,n=t.withApp,i=new o(e,n)},t.prototype._getToken=function(){var t,e;return t=f.KiiUser.getCurrentUser(),e=t?t.getAccessToken():null,e?e:null},t.prototype._setAuthorizationHeader=function(t){var e;return e=this._getToken(),e?t.setRequestHeader("Authorization","Bearer "+e):void 0},t.prototype._userWithID=function(t){var e;return e=f.KiiUser.userWithID(t)},t.prototype._parseObjectUri=function(t){var e,i,n,r;if(n=t.replace(/^kiicloud:\/\//g,"").split("/"),r=n[0],"users"===r)i={appID:f.Kii.getAppID(),userID:n[1],type:"APP_AND_USER"},e=f.KiiEncryptedBucket._isEncrypted(n[3])?{targetObjectScope:i,targetBucketType:"crypto",targetBucketID:n[3].replace("CRYPTO:",""),targetObjectID:n[5]}:{targetObjectScope:i,targetBucketID:n[3],targetObjectID:n[5]};else if("groups"===r)i={appID:f.Kii.getAppID(),groupID:n[1],type:"APP_AND_GROUP"},e=f.KiiEncryptedBucket._isEncrypted(n[3])?{targetObjectScope:i,targetBucketType:"crypto",targetBucketID:n[3].replace("CRYPTO:",""),targetObjectID:n[5]}:{targetObjectScope:i,targetBucketID:n[3],targetObjectID:n[5]};else{if("things"===r)throw new f.InvalidURIException;i={appID:f.Kii.getAppID(),type:"APP"},e=f.KiiEncryptedBucket._isEncrypted(n[1])?{targetObjectScope:i,targetBucketType:"crypto",targetBucketID:n[1].replace("CRYPTO:",""),targetObjectID:n[3]}:{targetObjectScope:i,targetBucketID:n[1],targetObjectID:n[3]}}return e},t.prototype.moveBody=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){var t;return null!=e&&e.failure.apply(e,arguments),t=l._Error(arguments[2],i),t.targetObjectUri=arguments[1],r(t)}},i._moveBodyUsingCallbacks(t,s)}}(this))},t.prototype._moveBodyUsingCallbacks=function(t,e){var i,n,r,s;if(null==t)return e.failure(this,null,f.InvalidArgumentException("targetObjectUri is required"));if(null==this.getUUID())return e.failure(this,t,f.InvalidArgumentException("Source object is not saved on the cloud"));r=this._getPath()+"/body/move",s=new this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.ObjectBodyMoveRequest+json");try{s.setData(this._parseObjectUri(t))}catch(o){return i=o,e.failure(this,t,"Not support to move body of thing scope object.")}return n={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=e?e.success(i,t):null!=e?e.failure(i,t,"Unable to parse response"):void 0}}(this),failure:function(i){return function(n,r){return null!=e?e.failure(i,t,n):void 0}}(this)},s.execute(n,!0)},t.prototype.uploadBody=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){var t;return null!=e&&null!=(t=e.success)&&t.apply(e,arguments),n(arguments[0])},failure:function(){var t;return null!=e&&null!=(t=e.failure)&&t.apply(e,arguments),r(l._Error(arguments[1],i))},progress:function(){var t;return null!=e&&null!=(t=e.progress)?t.apply(e,arguments):void 0}},i._uploadBodyUsingCallbacks(t,s)}}(this))},t.prototype._uploadBodyUsingCallbacks=function(t,e){var i,n,r,s,o;return t&&t instanceof Blob?(r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",i="application/octet-stream",t.type&&(i=t.type),s=h.createXHRWrapper("PUT",r),o=s.xhr,o.setRequestHeader("Content-Type",i),o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(o),n={success:function(t){return function(){var n;return n=JSON.parse(o.responseText),null!=n.modifiedAt&&(t._modified=n.modifiedAt),t._setBodyContentType(i),null!=e?e.success(t):void 0}}(this),failure:function(t){return function(){var i,n;if(i="failed to upload body. statusCode: "+o.status,null!=e)try{if(n=JSON.parse(decodeURIComponent(o.responseText)),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" message: "+n.message}catch(r){}finally{f.Kii.logger("Failure: "+i),f.Kii.logger(o.responseText),e.failure(t,i)}}}(this),progress:function(t){return function(t){return e&&e.progress?e.progress(t):void 0}}(this)},s.sendData(t,n)):void e.failure(this,"Invalid parameter")},t.prototype.downloadBody=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){var e;return null!=t&&null!=(e=t.success)&&e.apply(t,arguments),i(arguments)},failure:function(){var i;return null!=t&&null!=(i=t.failure)&&i.apply(t,arguments),n(l._Error(arguments[1],e))},progress:function(){var e;return null!=t&&null!=(e=t.progress)?e.apply(t,arguments):void 0}},e._downloadBodyUsingCallbacks(r)}}(this))},t.prototype._downloadBodyUsingCallbacks=function(t){var e,i,n,r;return i=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",n=h.createXHRWrapper("GET",i),r=n.xhr,r.setRequestHeader("x-kii-appid",f.Kii.getAppID()),r.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),r.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(r),r.responseType="blob",e={success:function(e){return function(){var i;return i=r.status,e._setBodyContentType(r.getResponseHeader("content-type")),null!=t?t.success(e,r.response):void 0}}(this),failure:function(e){return function(){var i,n,s,o;return null!=t?(i="failed to download body. statusCode: "+r.status,n=new FileReader,o=null,s=e,n.onload=function(){var e;o=this.result;try{if(e=JSON.parse(decodeURIComponent(o)),null!=e.errorCode&&(i+=" error code: "+e.errorCode),null!=e.message)return i+=" message: "+e.message}catch(n){}finally{f.Kii.logger("Failure: "+i),f.Kii.logger(r.response),t.failure(s,i)}},n.readAsText(r.response)):void 0}}(this),progress:function(e){return function(e){return t&&t.progress?t.progress(e):void 0}}(this)},n.send(e)},t.prototype.publishBody=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._publishBodyUsingCallbacks(r)}}(this))},t.prototype._publishBodyUsingCallbacks=function(t){var e,i,n,r,s,o;return r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",s=h.createXHRWrapper("POST",r),o=s.xhr,o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),o.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(o),n={success:function(e){return function(){var i;if(null!=t)try{return i=JSON.parse(o.responseText),i.url?t.success(e,i.url):t.failure(e,"failed to parse response")}catch(n){return t.failure(e,"failed to parse response")}}}(this),failure:function(e){return function(){var i,n;if(null!=t){i="failed to publish body. statusCode: "+o.status;try{if(n=JSON.parse(o.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{t.failure(e,i)}}}}(this)},i={},e=JSON.stringify(i),s.sendData(e,n)},t.prototype.publishBodyExpiresAt=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._publishBodyExpiresAtUsingCallbacks(t,s)}}(this))},t.prototype._publishBodyExpiresAtUsingCallbacks=function(t,e){var i,n,r,s,o,u;return s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",o=h.createXHRWrapper("POST",s),u=o.xhr,u.setRequestHeader("x-kii-appid",f.Kii.getAppID()),u.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),u.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),u.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(u),r={success:function(t){return function(){var i;if(null!=e)try{return i=JSON.parse(u.responseText),i.url?e.success(t,i.url):e.failure(t,"failed to parse response")}catch(n){return e.failure(t,"failed to parse response")}}}(this),failure:function(t){return function(){var i,n;if(null!=e){i="failed to publish body. statusCode: "+u.status,null==u.responseText&&(e.failure(t,i),retunr);try{if(n=JSON.parse(u.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{e.failure(t,i)}}}}(this)},n={},n.expiresAt=t,i=JSON.stringify(n),o.sendData(i,r)},t.prototype.publishBodyExpiresIn=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._publishBodyExpiresInUsingCallbacks(t,s)}}(this))},t.prototype._publishBodyExpiresInUsingCallbacks=function(t,e){var i,n,r,s,o,u;return s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",o=h.createXHRWrapper("POST",s),u=o.xhr,u.setRequestHeader("x-kii-appid",f.Kii.getAppID()),u.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),u.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),u.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(u),r={success:function(t){return function(){var i;try{return i=JSON.parse(u.responseText),i.url?e.success(t,i.url):e.failure(t,"failed to parse response")}catch(n){return e.failure(t,"failed to parse response")}}}(this),failure:function(t){return function(){var i,n;i="failed to publish body. statusCode: "+u.status;try{if(n=JSON.parse(u.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{e.failure(t,i)}}}(this)},n={},n.expiresIn=t,i=JSON.stringify(n),o.sendData(i,r)},t.prototype.deleteBody=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e));
}},e._deleteBodyUsingCallbacks(r)}}(this))},t.prototype._deleteBodyUsingCallbacks=function(t){var e,i,n,r;return i=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",n=h.createXHRWrapper("DELETE",i),r=n.xhr,r.setRequestHeader("x-kii-appid",f.Kii.getAppID()),r.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),r.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(r),e={success:function(e){return function(){return e._setBodyContentType(null),null!=t?t.success(e):void 0}}(this),failure:function(e){return function(){var i,n;if(null!=t){i="failed to delete body. statusCode: "+r.status;try{if(n=JSON.parse(r.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(s){}finally{t.failure(e,i)}}}}(this)},n.send(e)},t.isValidObjectID=function(t){var e;return e=/^[a-zA-Z0-9-_.]{2,100}$/i,"string"!==(typeof t).toLowerCase()?!1:null!==t.match(e)},t}(),f.KiiQuery=function(){function t(t){return this._dictValue=y(this._dictValue,this),this.sortByAsc=y(this.sortByAsc,this),this.sortByDesc=y(this.sortByDesc,this),this.setLimit=y(this.setLimit,this),this.getLimit=y(this.getLimit,this),this._setClause=y(this._setClause,this),this.setPaginationKey=y(this.setPaginationKey,this),this.getPaginationKey=y(this.getPaginationKey,this),this._clone=y(this._clone,this),this._clone(t)}return t.prototype._clone=function(t){var e,i;if(null==t||"object"!=typeof t)return t;i=new t.constructor;for(e in t)i[e]=this._clone(t[e]);return i},t.prototype.getPaginationKey=function(){return this._paginationKey},t.prototype.setPaginationKey=function(t){this._paginationKey=t},t.prototype._setClause=function(t){this._clause=t},t.prototype.getLimit=function(){return this._limit},t.prototype.setLimit=function(t){if(t>0)return this._limit=t;throw new f.InvalidLimitException},t.queryWithClause=function(t){var e;return e=new f.KiiQuery,e._setClause(t),e},t.prototype.sortByDesc=function(t){return this._sortField=t,this._sortDescending=!0},t.prototype.sortByAsc=function(t){return this._sortField=t,this._sortDescending=!1},t._emptyDictValue=function(){return{type:"all"}},t.prototype._dictValue=function(){var t,e;return e={},e.bestEffortLimit=this._limit,null!=this._paginationKey&&(e.paginationKey=this._paginationKey),t={descending:this._sortDescending},null!=this._clause?t.clause=this._clause._getDictValue():t.clause=f.KiiQuery._emptyDictValue(),null!=this._sortField&&(t.orderBy=this._sortField),e.bucketQuery=t,e},t}(),f.KiiClause=function(){function t(){this._getDictValue=y(this._getDictValue,this),this._setDictValue=y(this._setDictValue,this),this._setWhereClauses=y(this._setWhereClauses,this),this._setWhereType=y(this._setWhereType,this)}return t.constructor=function(){return t._whereClauses=[],t._dictExpression={}},t.prototype._setWhereType=function(t){this._whereType=t},t.prototype._setWhereClauses=function(t){this._whereClauses=t},t.prototype._setDictValue=function(t){this._dictExpression=t},t.prototype._getDictValue=function(){var t,e,i,n,r,s;if(i={},null!=this._whereClauses&&null!=this._whereType)if(e=[],1===this._whereClauses.length)t=this._whereClauses[0],i="not"===this._whereType?{type:this._whereType,clause:t._getDictValue()}:t._getDictValue();else{for(s=this._whereClauses,n=0,r=s.length;r>n;n++)t=s[n],e.push(t._getDictValue());i={type:this._whereType,clauses:e}}else null!=this._whereClauses?this._whereClauses.length>0&&(i=this._whereClauses[0]._getDictValue()):null!=this._dictExpression&&(i=this._dictExpression);return null==i&&(i=f.KiiQuery.emptyDictValue()),i},t.createWithWhere=function(t,e){var i;return i=new f.KiiClause,i._setWhereType(t),i._setWhereClauses(e),i},t.create=function(t,e,i){var n,r;return n=new f.KiiClause,r={},"="===t?(r.type="eq",r.field=e,r.value=i):"<"===t?(r.type="range",r.field=e,r.upperLimit=i,r.upperIncluded=!1):"<="===t?(r.type="range",r.field=e,r.upperLimit=i,r.upperIncluded=!0):">"===t?(r.type="range",r.field=e,r.lowerLimit=i,r.lowerIncluded=!1):">="===t?(r.type="range",r.field=e,r.lowerLimit=i,r.lowerIncluded=!0):"in"===t?(r.type="in",r.field=e,r.values=i):"prefix"===t?(r.type="prefix",r.field=e,r.prefix=i):"hasField"===t&&(r.type="hasField",r.field=e,r.fieldType=i),n._setDictValue(r),n},t.and=function(){return t.createWithWhere("and",arguments)},t.or=function(){return t.createWithWhere("or",arguments)},t.not=function(e){return t.createWithWhere("not",[e])},t.equals=function(t,e){return null!=e._className&&(e=e.objectURI),f.KiiClause.create("=",t,e)},t.notEquals=function(t,e){return null!=e._className&&(e=e.objectURI),f.KiiClause.createWithWhere("not",[f.KiiClause.equals(t,e)])},t.greaterThan=function(t,e){return f.KiiClause.create(">",t,e)},t.greaterThanOrEqual=function(t,e){return f.KiiClause.create(">=",t,e)},t.lessThan=function(t,e){return f.KiiClause.create("<",t,e)},t.lessThanOrEqual=function(t,e){return f.KiiClause.create("<=",t,e)},t["in"]=function(t,e){return f.KiiClause.create("in",t,e)},t.inClause=function(t,e){return f.KiiClause.create("in",t,e)},t.startsWith=function(t,e){return f.KiiClause.create("prefix",t,e)},t.geoDistance=function(t,e,i,n){var r,s,o,u,a;if(o=function(t){return"string"==typeof t&&t.length>0},s=function(t){return null==t?!1:t instanceof f.KiiGeoPoint},!o(t))throw f.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!s(e))throw f.InvalidArgumentException("center is not a reference of KiiGeoPoint.");if(u="^[a-zA-Z_][a-zA-Z0-9_]*$",null!=n&&!n.match(u))throw f.InvalidArgumentException("putDistanceInto is invalid.");if(0>=i||i>2e7||isNaN(i))throw f.InvalidArgumentException("radius is invalid.");return r=new f.KiiClause,a={},a.type="geodistance",a.field=t,e=e._toDict(),a.center=e,a.radius=i,a.putDistanceInto=n,r._setDictValue(a),r},t.geoBox=function(t,e,i){var n,r,s,o,u,a;if(s=function(t){return"string"==typeof t&&t.length>0},r=function(t){return null==t?!1:t instanceof f.KiiGeoPoint},!s(t))throw f.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!r(e)||!r(i))throw f.InvalidArgumentException("northEast or southWest is not a reference of KiiGeoPoint.");return n=new f.KiiClause,a={},a.type="geobox",a.field=t,o=e._toDict(),u=i._toDict(),a.box={ne:o,sw:u},n._setDictValue(a),n},t.hasField=function(t,e){if("STRING"!==e&&"INTEGER"!==e&&"DECIMAL"!==e&&"BOOLEAN"!==e)throw f.InvalidArgumentException("fieldType is invalid.");return f.KiiClause.create("hasField",t,e)},t}(),o=function(){function t(t,e){this.execute=y(this.execute,this),this.setAdminToken=y(this.setAdminToken,this),this.addHeader=y(this.addHeader,this),this.setAccept=y(this.setAccept,this),this.getAccept=y(this.getAccept,this),this.setAnonymous=y(this.setAnonymous,this),this.isAnonymous=y(this.isAnonymous,this),this.setContentType=y(this.setContentType,this),this.getContentType=y(this.getContentType,this),this.setData=y(this.setData,this),this.getData=y(this.getData,this),this.setHeaders=y(this.setHeaders,this),this.getHeaders=y(this.getHeaders,this),this.setMethod=y(this.setMethod,this),this.getMethod=y(this.getMethod,this),this.setPath=y(this.setPath,this),this.getPath=y(this.getPath,this),this._path=e?"/apps/"+f.Kii.getAppID()+t:t,this._method="GET",this._headers={accept:"*/*"},this._contentType="application/json",this._anonymous=!1,this._success=function(t){return function(){}}(this),this._failure=function(t){return function(){}}(this),this._httpRequest=null}return t.prototype.getPath=function(){return this._path},t.prototype.setPath=function(t){this._path=t},t.prototype.getMethod=function(){return this._method},t.prototype.setMethod=function(t){this._method=t},t.prototype.getHeaders=function(){return this._headers},t.prototype.setHeaders=function(t){this._headers=t},t.prototype.getData=function(){return this._data},t.prototype.setData=function(t){this._data=t},t.prototype.getContentType=function(){return this._contentType},t.prototype.setContentType=function(t){this._contentType=t},t.prototype.isAnonymous=function(){return this._anonymous},t.prototype.setAnonymous=function(t){this._anonymous=t},t.prototype.getAccept=function(){return this._accept},t.prototype.setAccept=function(t){this._accept=t},t.prototype.addHeader=function(t,e){return this._headers[t]=e},t.prototype.setAdminToken=function(t){return this._adminToken=t},t.prototype.execute=function(t,e){var i,n,r,s,o,u,a;if(this._success=null!=t.success?t.success:this._success,this._failure=null!=t.failure?t.failure:this._failure,this._ignoreBody=e,o=f.Kii.getBaseURL()+this._path,f.Kii.logger("POSTING: "),f.Kii.logger(JSON.stringify(this._data)),s=l._isJSONType(this._contentType)?JSON.stringify(this._data):this._data,f.Kii.logger("Making request["+this._method+"] to "+o+" with data: "+s),i=f.Kii.getAdditionalHeaders(),null!=i)for(r in i)u=i[r],this._headers[r]=u;this._headers["x-kii-appid"]=f.Kii.getAppID(),this._headers["x-kii-appkey"]=f.Kii.getAppKey(),this._headers["x-kii-sdk"]=f.KiiSDKClientInfo.getSDKClientInfo(),null!=this._accept&&(this._headers.accept=this._accept),this._anonymous||null==f.KiiUser.getCurrentUser()||(this._headers.Authorization="Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),null!=this._adminToken&&(this._headers.Authorization="Bearer "+this._adminToken),null!=this._contentType&&(this._headers["Content-Type"]=this._contentType),f.Kii.logger("Headers: "),f.Kii.logger(JSON.stringify(this._headers)),t={onComplete:function(t){return function(){var e,i,n,r,s,o,u;if(o=t._httpRequest.xhr,4===o.readyState){if(200<=(u=o.status)&&400>u){if(f.Kii.logger("Completed Request["+o.status+"]"),f.Kii.logger(o.responseText),s=t._parseResponseHeaders(o.getAllResponseHeaders()),t._ignoreBody)return t._success(null,o.status);try{r=JSON.parse(o.responseText)}catch(a){e=a,r=null}return null!=r?null!=r.errorCode?(i=r.errorCode,null!=r.message&&(i+=": "+r.message),t._failure(i,o.status,r.errorCode)):t._success(r,o.status,s):t._success(null,o.status,null)}f.Kii.logger("Error loading data..."),i=o.status+" : "+f.Kii.getBaseURL()+t._path;try{r=JSON.parse(decodeURIComponent(o.responseText))}catch(a){n=a,r=null}return null!=r&&null!=r.errorCode&&(i=r.errorCode,null!=r.message&&(i+=": "+r.message)),f.Kii.logger("Failure: "+i),f.Kii.logger(o.responseText),t._failure(i,o.status)}}}(this),onError:function(t){return function(){var e,i,n,r;r=t._httpRequest.xhr,f.Kii.logger("Error loading data..."),e=r.status+" : "+f.Kii.getBaseURL()+t._path;try{n=JSON.parse(decodeURIComponent(r.responseText))}catch(s){i=s,n=null}return null!=n&&null!=n.errorCode&&(e=n.errorCode,null!=n.message&&(e+=": "+n.message)),f.Kii.logger("Failure: "+e),f.Kii.logger(r.responseText),t._failure(e,r.status)}}(this)},this._httpRequest=this._createHttpRequest(this._method,o,t),null==this._httpRequest.xhr&&this._failure("Cross-Origin Resource Sharing is not supported by the browser.",0),a=this._headers;for(n in a)u=a[n],this._httpRequest.xhr.setRequestHeader(n,u);return"GET"!==this._method&&"DELETE"!==this._method?this._httpRequest.xhr.send(s):this._httpRequest.xhr.send()},t.prototype._createHttpRequest=function(t,e,i){var n;return n=null,null===f.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(f.Kii.logger("Use jQuery"),n=new s(t,e,i)):"undefined"!=typeof XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),n=new p(t,e,i)):"undefined"!=typeof Titanium&&(f.Kii.logger("Use Titanium"),n=new a(t,e,i)):(f.Kii.logger("Use http request backdoor"),f.Kii._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.Kii.logger("Use jQuery"),n=new s(t,e,i)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),n=new p(t,e,i)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),n=new a(t,e,i))),n},t.prototype._parseResponseHeaders=function(t){var e,i,n,r,s,o,u;if(n={},!t)return n;for(i=t.split("\r\n"),r=0;r<i.length;)e=i[r],s=e.indexOf(": "),s>0&&(o=e.substring(0,s).toLowerCase(),u=e.substring(s+2),n[o]=u),r++;return n},t}(),f.KiiUser=function(){function t(){this._setAuthToken=y(this._setAuthToken,this),this._getHttpURI=y(this._getHttpURI,this),this._clone=y(this._clone,this),this._getSubscriberPath=y(this._getSubscriberPath,this),this.pushInstallation=y(this.pushInstallation,this),this.pushSubscription=y(this.pushSubscription,this),this._listTopicsUsingCallbacks=y(this._listTopicsUsingCallbacks,this),this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this._groupWithJSON=y(this._groupWithJSON,this),this._setAuthHeader=y(this._setAuthHeader,this),this._getXhrWrapper=y(this._getXhrWrapper,this),this._getRequest=y(this._getRequest,this),this._updateWithJSON=y(this._updateWithJSON,this),this._validateLocalPhoneNumber=y(this._validateLocalPhoneNumber,this),this._validateIdentityData=y(this._validateIdentityData,this),this._updateWithUserFields=y(this._updateWithUserFields,this),this._updateWithIdentityData=y(this._updateWithIdentityData,this),this._deleteUsingCallbacks=y(this._deleteUsingCallbacks,this),this["delete"]=y(this["delete"],this),this._refreshUsingCallbacks=y(this._refreshUsingCallbacks,this),this.refresh=y(this.refresh,this),this._saveUsingCallbacks=y(this._saveUsingCallbacks,this),this.save=y(this.save,this),this._changeEmailUsingCallbacks=y(this._changeEmailUsingCallbacks,this),this.changeEmail=y(this.changeEmail,this),this._changePhoneUsingCallbacks=y(this._changePhoneUsingCallbacks,this),this.changePhone=y(this.changePhone,this),this._ownerOfGroupsUsingCallbacks=y(this._ownerOfGroupsUsingCallbacks,this),this.ownerOfGroups=y(this.ownerOfGroups,this),this._memberOfGroupsUsingCallbacks=y(this._memberOfGroupsUsingCallbacks,this),this.memberOfGroups=y(this.memberOfGroups,this),this.resendPhoneNumberVerification=y(this.resendPhoneNumberVerification,this),this.resendEmailVerification=y(this.resendEmailVerification,this),this._resendVerificationUsingCallbacks=y(this._resendVerificationUsingCallbacks,this),this.resendVerification=y(this.resendVerification,this),this.verifyPhoneNumber=y(this.verifyPhoneNumber,this),this._verifyCredentialsUsingCallbacks=y(this._verifyCredentialsUsingCallbacks,this),this.verifyCredentials=y(this.verifyCredentials,this),this._updatePasswordUsingCallbacks=y(this._updatePasswordUsingCallbacks,this),this.updatePassword=y(this.updatePassword,this),this._updateUsingCallbacks=y(this._updateUsingCallbacks,this),this.update=y(this.update,this),this._putIdentityUsingCallbacks=y(this._putIdentityUsingCallbacks,this),this.putIdentity=y(this.putIdentity,this),this._registerUsingCallbacks=y(this._registerUsingCallbacks,this),this.register=y(this.register,this),this._authenticateWithToken=y(this._authenticateWithToken,this),this._authenticate=y(this._authenticate,this),this.encryptedBucketWithName=y(this.encryptedBucketWithName,this),this.bucketWithName=y(this.bucketWithName,this),this.get=y(this.get,this),this.set=y(this.set,this),this.objectURI=y(this.objectURI,this),this.getAccessTokenObject=y(this.getAccessTokenObject,this),this._setExpiresAt=y(this._setExpiresAt,this),this._setAccessToken=y(this._setAccessToken,this),this.getAccessToken=y(this.getAccessToken,this),this.getLinkedSocialAccounts=y(this.getLinkedSocialAccounts,this),this._setPhoneVerified=y(this._setPhoneVerified,this),this.getPhoneVerified=y(this.getPhoneVerified,this),this._setEmailVerified=y(this._setEmailVerified,this),this.getEmailVerified=y(this.getEmailVerified,this),this._setModified=y(this._setModified,this),this.getModified=y(this.getModified,this),this._setCreated=y(this._setCreated,this),this.getCreated=y(this.getCreated,this),this.setLocale=y(this.setLocale,this),this.getLocale=y(this.getLocale,this),this.setCountry=y(this.setCountry,this),this.getCountry=y(this.getCountry,this),this._clearPassword=y(this._clearPassword,this),this._setPassword=y(this._setPassword,this),this._setLocalPhone=y(this._setLocalPhone,this),this.getPendingPhoneNumber=y(this.getPendingPhoneNumber,this),this._setPhoneNumber=y(this._setPhoneNumber,this),this.getPhoneNumber=y(this.getPhoneNumber,this),this.getPendingEmailAddress=y(this.getPendingEmailAddress,this),this._setEmailAddress=y(this._setEmailAddress,this),this.getEmailAddress=y(this.getEmailAddress,this),this.isPseudoUser=y(this.isPseudoUser,this),this.setDisplayName=y(this.setDisplayName,this),this.getDisplayName=y(this.getDisplayName,this),this._setDisabled=y(this._setDisabled,this),this.disabled=y(this.disabled,this),this._setUsername=y(this._setUsername,this),this.getUsername=y(this.getUsername,this),this.getID=y(this.getID,this),this._setUUID=y(this._setUUID,this),this.getUUID=y(this.getUUID,this),this._customInfo={}}return t.prototype.getUUID=function(){return this._uuid},t.prototype._setUUID=function(t){this._uuid=t},t.prototype.getID=function(){return this._uuid},t.prototype.getUsername=function(){return this._username},t.prototype._setUsername=function(t){var e;if(e=l._trim(t),f.Kii.logger("Setting username: "+e),l._validateUsername(e))return this._username=e;throw new f.InvalidUsernameException},t.prototype.disabled=function(){return this._disabled},t.prototype._setDisabled=function(t){this._disabled=t},t.prototype.getDisplayName=function(){return this._displayName},t.prototype.setDisplayName=function(t){if(!l._validateDisplayName(t))throw new f.InvalidDisplayNameException;return this._displayName=t},t.prototype.isPseudoUser=function(){return null!=this._hasPassword?!this._hasPassword:!this._username&&!this._emailAddress&&!this._phoneNumber},t.prototype.getEmailAddress=function(){return this._emailAddress},t.prototype._setEmailAddress=function(t){var e;if(e=l._trim(t),f.Kii.logger("Setting email: "+e),l._validateEmail(e))return this._emailAddress=e;throw new f.InvalidEmailException},t.prototype.getPendingEmailAddress=function(){return this._emailAddressPending},t.prototype.getPhoneNumber=function(){return this._phoneNumber},t.prototype._setPhoneNumber=function(t){if(f.Kii.logger("Setting phone number: "+t),l._validatePhoneNumber(t))return this._phoneNumber=t;throw new f.InvalidPhoneNumberException},t.prototype.getPendingPhoneNumber=function(){return this._phoneNumberPending},t.prototype._setLocalPhone=function(t,e){if(f.Kii.logger("Setting local phone number: "+t+", country: "+e),!l._validateLocalPhone(t))throw new f.InvalidPhoneNumberException;if(!l._validateCountryCode(e))throw new f.InvalidCountryException;return this._phoneNumber=t,this._country=e},t.prototype._setPassword=function(t){if(l._validatePassword(t))return this._password=t;throw new f.InvalidPasswordException},t.prototype._clearPassword=function(){return this._password=null},t.prototype.getCountry=function(){return this._country},t.prototype.setCountry=function(t){if(l._validateCountryCode(t))return this._country=t;throw new f.InvalidCountryException},t.prototype.getLocale=function(){return this._locale},t.prototype.setLocale=function(t){return this._locale=t},t.prototype.getCreated=function(){return this._created},t.prototype._setCreated=function(t){this._created=t},t.prototype.getModified=function(){return this._modified},t.prototype._setModified=function(t){this._modified=t},t.prototype.getEmailVerified=function(){return this._emailVerified},t.prototype._setEmailVerified=function(t){this._emailVerified=t},t.prototype.getPhoneVerified=function(){return this._phoneVerified},t.prototype._setPhoneVerified=function(t){this._phoneVerified=t},t.prototype.getLinkedSocialAccounts=function(){return f.Kii.logger("third party accounts: "+this._thirdPartyAccounts),null!=this._thirdPartyAccounts?this._thirdPartyAccounts:this._thirdPartyAccounts={}},t.prototype.getAccessToken=function(){return f.Kii.logger("Getting access token: "+this._accessToken),this._accessToken},t.prototype._setAccessToken=function(t){return this._accessToken=t,f.Kii.logger("Setting access token: "+this._accessToken)},t.prototype._setExpiresAt=function(t){return this._expiresAt=t,f.Kii.logger("Setting expires at: "+this._expiresAt)},t.prototype.getAccessTokenObject=function(){var t;return t=null,null!=this._accessToken&&(t={access_token:this._accessToken,expires_at:this._expiresAt}),t},t.prototype.objectURI=function(){var t;return t=null,null!=this._uuid&&(t="kiicloud://users/"+this._uuid),t},t.prototype.set=function(t,e){return l._isNonEmptyString(t)&&0!==t.indexOf("_")?(f.Kii.logger(this),f.Kii.logger(this._customInfo),this._customInfo[t]=e):void f.Kii.logger("[WARN] Reserved key is used for custom field. key="+t)},t.prototype.get=function(t){return this._customInfo[t]},t.getCurrentUser=function(){return f.Kii.getCurrentUser()},t.userWithUsername=function(t,e){var i;return i=new f.KiiUser,i._setUsername(t),i._setPassword(e),i},t._userWithEmailAddress=function(t,e){var i;return i=new f.KiiUser,i._setEmailAddress(t),i._setPassword(e),i},t._userWithPhoneNumber=function(t,e){var i;return i=new f.KiiUser,i._setPhoneNumber(t),i._setPassword(e),i},t.userWithPhoneNumber=function(e,i){return t._userWithPhoneNumber(e,i)},t.userWithPhoneNumberAndUsername=function(t,e,i){var n;return n=new f.KiiUser,n._setPhoneNumber(t),n._setUsername(e),n._setPassword(i),n},t.userWithEmailAddress=function(e,i){return t._userWithEmailAddress(e,i)},t.userWithEmailAddressAndUsername=function(t,e,i){var n;return n=new f.KiiUser,n._setEmailAddress(t),n._setUsername(e),n._setPassword(i),n},t.userWithEmailAddressAndPhoneNumber=function(t,e,i){var n;return n=new f.KiiUser,n._setEmailAddress(t),n._setPhoneNumber(e),n._setPassword(i),n},t.userWithCredentials=function(t,e,i,n){var r;return r=new f.KiiUser,r._setEmailAddress(t),r._setPhoneNumber(e),r._setUsername(i),r._setPassword(n),r},t._validateURI=function(t){var e,i,n;return t=l._trim(t),i=/^kiicloud:\/\/users\/(.*$)/i,"string"===(typeof t).toLowerCase()&&(e=t.match(i),null!=e&&(n=e[1])),n},t.userWithID=function(t){var e;if(null==t||""===t)throw new f.InvalidArgumentException("userID should not null or empty");return e=new f.KiiUser,e._setUUID(t),e},t.userWithURI=function(t){var e,i;if(f.Kii.logger("About to extract from: "+t),i=f.KiiUser._validateURI(t),f.Kii.logger("Extracted uuid from uri: "+i),null==i)throw new f.InvalidURIException;return e=new f.KiiUser,e._setUUID(i),e},t.prototype.bucketWithName=function(t){var e;return e=new f.KiiBucket(t,this)},t.prototype.encryptedBucketWithName=function(t){var e;return e=new f.KiiEncryptedBucket(t,this)},t.prototype._authenticate=function(t){var e,i,n,r,s,o;return f.Kii.logger("Authenticating user:"),f.Kii.logger(this),f.Kii.logger("Email verified: "+this._emailVerified),f.Kii.logger("Phone verified: "+this._phoneVerified),null!=this._username?o=this._username:null!=this._emailAddress&&this._emailVerified===!0?o=this._emailAddress:null!=this._phoneNumber&&this._phoneVerified===!0?o=this._phoneNumber:null!=this._emailAddress?o=this._emailAddress:null!=this._phoneNumber&&(o=this._phoneNumber),n={username:o,password:this._password},r=new Date,i=r.getTime(),f.Kii.getAccessTokenExpiration()>0&&(n.expiresAt=l._safeCalculateExpiresAtAsNumber(f.Kii.getAccessTokenExpiration(),i)),s=this._getRequest({path:"/oauth2/token",withApp:!1}),s.setAnonymous(!0),s.setMethod("POST"),s.setData(n),e={success:function(e){return function(n){return e._setUUID(n.id),e._clearPassword(),e._setAccessToken(n.access_token),null!=n.expires_in&&(r=new Date,i=r.getTime(),e._expiresAt=l._safeCalculateExpiresAtAsDate(n.expires_in,i)),f.Kii.setCurrentUser(e),null!=t?t.success(f.Kii.getCurrentUser()):void 0}}(this),failure:function(e){return function(i,n){return e._clearPassword(),null!=t?t.failure(e,i):void 0}}(this)},s.execute(e,!1)},t.prototype._authenticateWithToken=function(t,e,i){var n,r;return f.Kii.logger("Authenticating user "+this),f.Kii.logger(e),r=this._getRequest({path:"/users/me",withApp:!0}),r.setAnonymous(!0),r.addHeader("Authorization","Bearer "+t),n={success:function(n){return function(r){return n._updateWithJSON(r),n._setAccessToken(t),"undefined"==typeof i?n._setExpiresAt(new Date(l.MAX_DATE_IN_MILLIS)):n._setExpiresAt(i),f.Kii.setCurrentUser(n),null!=e?e.success(f.Kii.getCurrentUser()):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},r.execute(n,!1)},t.authenticate=function(e,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success.apply(n,arguments),r(arguments[0])},failure:function(){var t;return null!=n&&n.failure.apply(n,arguments),t=l._Error(arguments[1]),t.target=arguments[0],s(t)}},t._authenticateUsingCallbacks(e,i,o)})},t._authenticateUsingCallbacks=function(t,e,i){var n,r;try{if(f.Kii.logger("UserIdentifier: "+t),!l._validatePassword(e))throw new f.InvalidPasswordException;if(l._validateEmail(t))r=f.KiiUser._userWithEmailAddress(t,e);else if(l._validatePhoneNumber(t))r=f.KiiUser._userWithPhoneNumber(t,e);else{if(!l._validateUsername(t))throw new f.InvalidUserIdentifierException;r=f.KiiUser.userWithUsername(t,e)}return r._authenticate(i)}catch(s){if(n=s,null!=r&&r._clearPassword(),null!=i)return i.failure(null,n.message)}},t.authenticateWithToken=function(e,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){var t;return null!=i&&i.failure.apply(i,arguments),t=l._Error(arguments[1]),t.target=arguments[0],s(t)}},t._authenticateWithTokenUsingCallbacks(e,o,n)})},t._authenticateWithTokenUsingCallbacks=function(t,e,i){var n,r;return n=l._type(i),"undefined"!==n&&"date"!==n?e.failure(null,f.InvalidArgumentException("Specified expiresAt must be a Date")):(r=new f.KiiUser,r._authenticateWithToken(t,e,i))},t.prototype.register=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._registerUsingCallbacks(r)}}(this))},t.prototype._registerUsingCallbacks=function(t){var e,i,n,r,s,o;if(f.Kii.logger("Registering user "+this),e={password:this._password},null!=this._username&&(e.loginName=this._username),null!=this._displayName&&(e.displayName=this._displayName),null!=this._emailAddress&&(e.emailAddress=this._emailAddress),null!=this._phoneNumber&&(e.phoneNumber=this._phoneNumber),!this._validateLocalPhoneNumber(this._phoneNumber,this._country))return void t.failure(this,"needs to provide country for the local phone number");null!=this._country&&(e.country=this._country),null!=this._locale&&(e.locale=this._locale),f.Kii.logger("CINFO"),f.Kii.logger(JSON.stringify(this._customInfo)),o=this._customInfo;for(i in o)s=o[i],f.Kii.logger("Key/val: "+i+"/"+s),e[i]=s;return r=this._getRequest({path:"/users",withApp:!0}),r.setMethod("POST"),r.setData(e),r.setAnonymous(!0),r.setContentType("application/vnd.kii.RegistrationRequest+json"),n={success:function(e){return function(i){return f.Kii.logger("Succreg"),e._updateWithJSON(i),e._authenticate(t)}}(this),failure:function(e){return function(i,n){return f.Kii.logger("Failreg"),e._clearPassword(),null!=t?t.failure(e,i):void 0}}(this)},r.execute(n,!1)},t.registerAsPseudoUser=function(e,i){return new Promise(function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1]))}},t._registerAsPseudoUserUsingCallbacks(s,i)})},t._registerAsPseudoUserUsingCallbacks=function(t,e){var i,n,r,s,o;return r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users",s=h.createXHRWrapper("POST",r),o=s.xhr,o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),o.setRequestHeader("Content-Type","application/vnd.kii.RegistrationAndAuthorizationRequest+json"),n={success:function(){var e,i,n,s;try{return o.status<300&&o.status>=200?(n=JSON.parse(o.responseText),e=n._accessToken,s=new f.KiiUser,s._updateWithJSON(n),s._setAccessToken(e),s._setExpiresAt(new Date(l.MAX_DATE_IN_MILLIS)),f.Kii.setCurrentUser(s),t.success(s)):(i=o.status+" : "+r,t.failure(null,i))}catch(u){return t.failure(null,"failed to parse response")}},failure:function(){var e,i;e="failed to register pseudo user. statusCode: "+o.status;try{if(i=JSON.parse(o.responseText),null!=i.errorCode&&(e+=" error code: "+i.errorCode),null!=i.message)return e+=" error message: "+i.message}catch(n){}finally{t.failure(null,e)}}},null==e&&(e={}),i=JSON.stringify(e),s.sendData(i,n)},t.prototype.putIdentity=function(t,e,i,n,r){return new Promise(function(s){return function(o,u){var a;return a={success:function(){return null!=i&&i.success.apply(i,arguments),o(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),u(l._Error(arguments[1],s))}},s._putIdentityUsingCallbacks(t,e,a,n,r)}}(this))},t.prototype._putIdentityUsingCallbacks=function(t,e,i,n,r){var s,o,u,a;if(f.Kii.logger("Put identity user: "+this._uuid+", data: "+JSON.stringify(t)),o={},!this.isPseudoUser())return void(null!=i&&i.failure(this,"This user has the identity already"));if(null==t)return void(null!=i&&i.failure(this,"identityData is null"));try{this._validateIdentityData(t)}catch(c){return u=c,void(null!=i&&i.failure(this,u))}return a=!1,null!=t.emailAddress&&(a=!0),null!=t.phoneNumber&&(a=!0),null!=t.username&&(a=!0),a?null==e?void(null!=i&&i.failure(this,"password is null")):l._validatePassword(e)?(s=null!=n?n.country:null,null==t.phoneNumber||this._validateLocalPhoneNumber(t.phoneNumber,s)?this.refresh({failure:function(t){return function(e,n){return f.Kii.logger("Failreg"),null!=i?i.failure(t,n):void 0}}(this),success:function(s){return function(u){var a,l,c,h,p,g,_,d,y,m;if(!u.isPseudoUser())return void(null!=i&&i.failure(u,"This user has the identity already"));if(o=s._clone(u._customInfo),null!=t.emailAddress&&(o.emailAddress=t.emailAddress),null!=t.phoneNumber&&(o.phoneNumber=t.phoneNumber),null!=t.username&&(o.loginName=t.username),o.password=e,null!=n)for(l in n)g=n[l],o[l]=g;if(null!=r)for(y=0,m=r.length;m>y;y++)c=r[y],delete o[c];return p=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/"+s._uuid),_=s._getXhrWrapper("POST",p),d=_.xhr,s._setAuthHeader(d),d.setRequestHeader("Content-Type","application/vnd.kii.UserUpdateRequest+json"),h={success:function(){var e,o;try{return o=JSON.parse(d.responseText),d.status<300&&d.status>=200?(u._setModified(o.modifiedAt),u._updateWithIdentityData(t),u._updateWithUserFields(n,r),s._hasPassword=!0,i.success(u)):(e=d.status+" : "+p,i.failure(s,e))}catch(a){return i.failure(s,"failed to parse response")}},failure:function(){var t,e;t="failed to put identity data. statusCode: "+d.status;try{if(e=JSON.parse(d.responseText),null!=e.errorCode&&(t+=" error code: "+e.errorCode),null!=e.message)return t+=" error message: "+e.message}catch(n){}finally{i.failure(s,t)}}},a=JSON.stringify(o),_.sendData(a,h)}}(this)}):void i.failure(this,"needs to provide country for the local phone number")):void(null!=i&&i.failure(this,"invalid password")):void(null!=i&&i.failure(this,"needs to provide at least one of login name, email address or phone number"))},t.prototype.update=function(t,e,i,n){return new Promise(function(r){return function(s,o){var u;return u={success:function(){return null!=e&&e.success.apply(e,arguments),s(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),o(l._Error(arguments[1],r))}},r._updateUsingCallbacks(t,u,i,n)}}(this))},t.prototype._updateUsingCallbacks=function(t,e,i,n){var r,s,o,u,a,l,c,h,p,g,_;if(f.Kii.logger("update user: "+this._uuid),s={},u=!1,l=!1,a=!1,null!=t){try{this._validateIdentityData(t)}catch(d){return o=d,void(null!=e&&e.failure(this,o))}null!=t.emailAddress&&(u=!0),null!=t.phoneNumber&&(u=!0),null!=t.username&&(u=!0)}if(null!=i)for(c in i){p=i[c],l=!0;break}if(null!=n)for(g=0,_=n.length;_>g;g++){h=n[g],a=!0;break}return u||l||a?(r=null!=i?i.country:null,null==t||null==t.phoneNumber||this._validateLocalPhoneNumber(t.phoneNumber,r)?this.refresh({
failure:function(t){return function(i,n){return f.Kii.logger("Failreg"),null!=e?e.failure(t,n):void 0}}(this),success:function(r){return function(o){var a,l,g,_,d,y,m;if(o.isPseudoUser()&&u)return void(null!=e&&e.failure(o,"Pseudo user must use putIdentity()"));if(s=r._clone(o._customInfo),null!=t&&(null!=t.emailAddress&&(s.emailAddress=t.emailAddress),null!=t.phoneNumber&&(s.phoneNumber=t.phoneNumber),null!=t.username&&(s.loginName=t.username)),null!=i)for(c in i)p=i[c],s[c]=p;if(null!=n)for(y=0,m=n.length;m>y;y++)h=n[y],delete s[h];return g=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/"+r._uuid),_=r._getXhrWrapper("POST",g,!1),d=_.xhr,r._setAuthHeader(d),d.setRequestHeader("Content-Type","application/vnd.kii.UserUpdateRequest+json"),l={success:function(){var u,a;try{return a=JSON.parse(d.responseText),d.status<300&&d.status>=200?(o._setModified(s.modifiedAt),o._updateWithIdentityData(t),o._updateWithUserFields(i,n),e.success(o)):(u=d.status+" : "+g,e.failure(r,u))}catch(l){return e.failure(r,"failed to parse response")}},failure:function(){var t,i;t="failed to update user. statusCode: "+d.status;try{if(i=JSON.parse(d.responseText),null!=i.errorCode&&(t+=" error code: "+i.errorCode),null!=i.message)return t+=" error message: "+i.message}catch(n){}finally{e.failure(r,t)}}},a=JSON.stringify(s),_.sendData(a,l)}}(this)}):void e.failure(this,"needs to provide country for the local phone number")):void e.failure(this,"all arguments are null or empty")},t.prototype.updatePassword=function(t,e,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(l._Error(arguments[1],n))}},n._updatePasswordUsingCallbacks(t,e,o)}}(this))},t.prototype._updatePasswordUsingCallbacks=function(t,e,i){var n,r,s,o;return f.Kii.logger("Updating password from "+t+" to "+e),l._validatePassword(e)?(n={oldPassword:t,newPassword:e},r="/users/"+this._uuid+"/password",s=this._getRequest({path:r,withApp:!0}),s.setMethod("PUT"),s.setData(n),s.setContentType("application/vnd.kii.ChangePasswordRequest+json"),o={success:function(t){return function(e,n){if(t._clearPassword,300>n&&n>=200){if(null!=i)return i.success(t)}else if(null!=i)return i.failure(t,"Unable to change password")}}(this),failure:function(t){return function(e,n){return t._clearPassword,null!=i?i.failure(t,e):void 0}}(this)},s.execute(o,!0)):null!=i?i.failure(this,(new f.InvalidPasswordException).message):void 0},t.resetPassword=function(e,i){return new Promise(function(n,r){var s;return s={success:function(){return null!=i&&i.success(),n()},failure:function(){return null!=i&&i.failure(arguments[0]),r(l._Error(arguments[0]))}},t._resetPasswordUsingCallbacks(e,s)})},t._resetPasswordUsingCallbacks=function(t,e){var i,n,r,s;if(f.Kii.logger("Resetting password with identifier: "+t),l._validateEmail(t))i="EMAIL";else if(null!=e)return void e.failure("Invalid user identifier. Must be a valid email address");return null!=i?(n="/users/"+i+":"+t+"/password/request-reset",r=new o(n,!0),r.setMethod("POST"),r.setAnonymous(!0),s={success:function(t,i){return 300>i&&i>=200&&null!=e?e.success():null!=e?e.failure("Unable to reset password"):void 0},failure:function(t,i){return null!=e?e.failure(t):void 0}},r.execute(s,!0)):void 0},t.resetPasswordWithNotificationMethod=function(e,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success(),r()},failure:function(){return null!=n&&n.failure(arguments[0]),s(l._Error(arguments[0]))}},t._resetPasswordWithNotificationMethodUsingCallbacks(e,i,o)})},t._resetPasswordWithNotificationMethodUsingCallbacks=function(t,e,i){var n,r,s,o,u,a;return"string"!=typeof t?void(null!=i&&i.failure("given userIdentifier is not string")):""===t?void(null!=i&&i.failure("given userIdentifier is empty")):"EMAIL"!==e&&"SMS"!==e&&"SMS_PIN"!==e?void(null!=i&&i.failure("notificationMethod should be 'EMAIL' or 'SMS' or 'SMS_PIN'")):(r=l._validateEmail(t)?"EMAIL:"+t:l._isGlobalPhoneNumber(t)?"PHONE:"+t:t,r=encodeURIComponent(r),n={notificationMethod:e},"SMS_PIN"===e&&(n.notificationMethod="SMS",n.smsResetMethod="PIN"),o=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users/"+r+"/password/request-reset",u=h.createXHRWrapper("POST",o),a=u.xhr,a.setRequestHeader("x-kii-appid",f.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/vnd.kii.ResetPasswordRequest+json"),s={success:function(){return null!=i?i.success():void 0},failure:function(){var t,e;t="failed to reset password. statusCode: "+a.status;try{if(e=JSON.parse(a.responseText),null!=e.errorCode&&(t+=" error code: "+e.errorCode),null!=e.message)return t+=" error message: "+e.message}catch(n){}finally{null!=i&&i.failure(t)}}},u.sendData(JSON.stringify(n),s))},t.completeResetPassword=function(e,i,n,r){return new Promise(function(s,o){var u;return u={success:function(){return null!=r&&r.success(),s()},failure:function(){return null!=r&&r.failure(arguments[0]),o(l._Error(arguments[0]))}},t._completeResetPasswordUsingCallbacks(e,i,n,u)})},t._completeResetPasswordUsingCallbacks=function(t,e,i,n){var r,s,o,u,a,c;return l._isNonEmptyString(t)?l._isNonEmptyString(e)?(s=l._validateEmail(t)?"EMAIL:"+t:l._isGlobalPhoneNumber(t)?"PHONE:"+t:t,s=encodeURIComponent(s),r={pinCode:e},l._isNonEmptyString(i)&&(r.newPassword=i),u=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users/"+s+"/password/complete-reset",a=h.createXHRWrapper("POST",u),c=a.xhr,c.setRequestHeader("x-kii-appid",f.Kii.getAppID()),c.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),c.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),c.setRequestHeader("Content-Type","application/vnd.kii.CompletePasswordResetRequest+json"),o={success:function(){return null!=n?n.success():void 0},failure:function(){var t,e;t="failed to reset password. statusCode: "+c.status;try{if(e=JSON.parse(c.responseText),null!=e.errorCode&&(t+=" error code: "+e.errorCode),null!=e.message)return t+=" error message: "+e.message}catch(i){}finally{null!=n&&n.failure(t)}}},a.sendData(JSON.stringify(r),o)):void(null!=n&&n.failure("given pinCode is null or empty")):void(null!=n&&n.failure("given userIdentifier is null or empty"))},t.prototype.verifyCredentials=function(t,e,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(l._Error(arguments[1],n))}},n._verifyCredentialsUsingCallbacks(t,e,o)}}(this))},t.prototype._verifyCredentialsUsingCallbacks=function(t,e,i){var n,r,s;return f.Kii.logger("Verifying "+t+" with code: "+e),n="/users/me/"+t+"/verify",r=this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),r.setData({verificationCode:e}),r.setContentType("application/vnd.kii.AddressVerificationRequest+json"),s={success:function(e){return function(n,r){if(300>r&&r>=200){if("email-address"===t?e._setEmailVerified(!0):"phone-number"===t&&e._setPhoneVerified(!0),null!=i)return i.success(e)}else if(null!=i)return i.failure(e,"Unable to verify "+t)}}(this),failure:function(t){return function(e,n){return null!=i?i.failure(t,e):void 0}}(this)},r.execute(s,!0)},t.prototype.verifyPhoneNumber=function(t,e){return this.verifyCredentials("phone-number",t,e)},t.prototype.resendVerification=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._resendVerificationUsingCallbacks(t,s)}}(this))},t.prototype._resendVerificationUsingCallbacks=function(t,e){var i,n,r,s;return f.Kii.logger("Resending verification "+t),i=this.getID(),n="/users/"+i+"/"+t+"/resend-verification",r=this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),s={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=e?e.success(i):null!=e?e.failure(i,"Unable to resend "+t+" verification"):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},r.execute(s,!0)},t.prototype.resendEmailVerification=function(t){return this.resendVerification("email-address",t)},t.prototype.resendPhoneNumberVerification=function(t){return this.resendVerification("phone-number",t)},t.prototype.memberOfGroups=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._memberOfGroupsUsingCallbacks(r)}}(this))},t.prototype._memberOfGroupsUsingCallbacks=function(t){var e,i,n;return f.Kii.logger("Getting groups for member "+this._uuid),i="/groups/?is_member="+this._uuid,n=this._getRequest({path:i,withApp:!0}),n.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),e={success:function(e){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],a=i.groups,o=0,u=a.length;u>o;o++)r=a[o],s.push(e._groupWithJSON(r));if(null!=t)return t.success(e,s)}else if(null!=t)return t.failure(e,"Unable to retrieve groups")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(e,!1)},t.prototype.ownerOfGroups=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._ownerOfGroupsUsingCallbacks(r)}}(this))},t.prototype._ownerOfGroupsUsingCallbacks=function(t){var e,i,n;return f.Kii.logger("Getting groups owned by the user "+this._uuid),i="/groups/?owner="+this._uuid,n=this._getRequest({path:i,withApp:!0}),n.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),e={success:function(e){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],a=i.groups,o=0,u=a.length;u>o;o++)r=a[o],s.push(e._groupWithJSON(r));if(null!=t)return t.success(e,s)}else if(null!=t)return t.failure(e,"Unable to retrieve groups")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(e,!1)},t.prototype.changePhone=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._changePhoneUsingCallbacks(t,s)}}(this))},t.prototype._changePhoneUsingCallbacks=function(t,e){var i,n,r;return f.Kii.logger("Updating phone number to "+t),i="/users/"+this._uuid+"/phone-number",n=this._getRequest({path:i,withApp:!0}),n.setMethod("PUT"),n.setContentType("application/vnd.kii.PhoneNumberModificationRequest+json"),n.setData({phoneNumber:t}),r={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to update phone number"):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!0)},t.prototype.changeEmail=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._changeEmailUsingCallbacks(t,s)}}(this))},t.prototype._changeEmailUsingCallbacks=function(t,e){var i,n,r;return f.Kii.logger("Updating email address to: "+t),l._validateEmail(t)?(i="/users/"+this._uuid+"/email-address",n=this._getRequest({path:i,withApp:!0}),n.setMethod("PUT"),n.setContentType("application/vnd.kii.EmailAddressModificationRequest+json"),n.setData({emailAddress:t}),r={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to update email address"):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!0)):e.failure(this,"Invalid email address format")},t.prototype.save=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._saveUsingCallbacks(r)}}(this))},t.prototype._saveUsingCallbacks=function(t){var e,i,n,r;return f.Kii.logger("Saving user: "+this._uuid),i="/users/"+this._uuid,f.Kii.logger("CUSTOMINFO: "),f.Kii.logger(this._customInfo),n=this._getRequest({path:i,withApp:!0}),n.setMethod("POST"),n.setContentType("application/vnd.kii.UserUpdateRequest+json"),e=this._customInfo,null!=this._country&&(e.country=this._country),null!=this._locale&&(e.locale=this._locale),null!=this._displayName&&(e.displayName=this._displayName),n.setData(e),r={success:function(e){return function(i,n){if(300>n&&n>=200){if(e._setModified(i.modifiedAt),null!=t)return t.success(e)}else if(null!=t)return t.failure(e,"Unable to parse response")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!1)},t.prototype.refresh=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._refreshUsingCallbacks(r)}}(this))},t.prototype._refreshUsingCallbacks=function(t){var e,i;return f.Kii.logger("Refreshing user: "+this._uuid),i=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),e={success:function(e){return function(i,n){if(300>n&&n>=200){if(e._phoneNumberPending=null,e._emailAddressPending=null,e._updateWithJSON(i),null!=t)return t.success(e)}else if(null!=t)return t.failure(e,"Unable to parse response")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(e,!1)},t.prototype["delete"]=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(){return null!=t&&t.success.apply(t,arguments),i(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),n(l._Error(arguments[1],e))}},e._deleteUsingCallbacks(r)}}(this))},t.prototype._deleteUsingCallbacks=function(t){var e,i;return f.Kii.logger("Deleting user..."),i=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),i.setMethod("DELETE"),e={success:function(e){return function(i,n){return 300>n&&n>=200&&null!=t?t.success(e):null!=t?t.failure(e,"Unable to parse response"):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(e,!0)},t.logOut=function(){return f.Kii.logOut()},t.loggedIn=function(){return f.Kii.loggedIn()},t.prototype._updateWithIdentityData=function(t){return null!=t&&(null!=t.username&&(this._username=t.username),null!=t.emailAddress&&(this._emailAddress=t.emailAddress),null!=t.phoneNumber)?this._phoneNumber=t.phoneNumber:void 0},t.prototype._updateWithUserFields=function(t,e){var i,n,r,s,o,u;if(null!=t)for(i in t)r=t[i],"displayName"===i?this._displayName=r:"country"===i?this._country=r:"locale"===i?this._locale=r:""===i?(f.Kii.logger("Setting empty to custom info"),this._customInfo[i]=r):"_"!==i.substring(0,1)&&(f.Kii.logger("Setting to custom info"),this._customInfo[i]=r);if(null!=e){for(u=[],s=0,o=e.length;o>s;s++)n=e[s],u.push(delete this._customInfo[n]);return u}},t.prototype._validateIdentityData=function(t){if(null!=t){if(null!=t.emailAddress&&!l._validateEmail(t.emailAddress))throw"invalid email";if(null!=t.phoneNumber&&!l._validatePhoneNumber(t.phoneNumber))throw"invalid phone number";if(null!=t.username&&!l._validateUsername(t.username))throw"invalid username"}},t.prototype._validateLocalPhoneNumber=function(t,e){return null==t||l._isGlobalPhoneNumber(t)?!0:null!=e?l._validateCountryCode(e):!1},t.prototype._updateWithJSON=function(t){var e,i,n,r;f.Kii.logger("Updating with:"),f.Kii.logger(t),this._thirdPartyAccounts={},r=[];for(e in t)n=t[e],f.Kii.logger("key/val => "+e+"/"+n),f.Kii.logger("Substr "+e.substring(0,1)),"userID"===e||"id"===e?r.push(this._uuid=n):"created"===e||"createdAt"===e||"_created"===e?r.push(this._created=n):"modified"===e||"modifiedAt"===e||"_modified"===e?r.push(this._modified=n):"loginName"===e?r.push(this._username=n):"displayName"===e?r.push(this._displayName=n):"country"===e?(f.Kii.logger("Is setting country"),r.push(this._country=n)):"locale"===e?r.push(this._locale=n):"emailAddress"===e?r.push(this._emailAddress=n):"_emailAddressPending"===e?r.push(this._emailAddressPending=n):"phoneNumber"===e?r.push(this._phoneNumber=n):"_phoneNumberPending"===e?r.push(this._phoneNumberPending=n):"emailAddressVerified"===e?(f.Kii.logger("Email verified: "+n),r.push(this._emailVerified=n)):"phoneNumberVerified"===e?(f.Kii.logger("Phone verified: "+n),r.push(this._phoneVerified=n)):"_hasPassword"===e?(f.Kii.logger("_hasPassword: "+n),r.push(this._hasPassword=n)):"_thirdPartyAccounts"===e?(null!=n.hotmail&&(i=n.hotmail,i.type="live",n.live=i,delete n.hotmail),f.Kii.logger("_thirdPartyAccounts: "+n),r.push(this._thirdPartyAccounts=n)):"_disabled"===e?(f.Kii.logger("disabled: "+n),r.push(this._disabled=n)):""===e?(f.Kii.logger("Setting empty to custom info"),r.push(this._customInfo[e]=n)):e.substring(0,!0)?(f.Kii.logger("Setting to custom info"),r.push(this._customInfo[e]=n)):r.push(f.Kii.logger("Doing nothing"));return r},t.prototype._getRequest=function(t){var e,i,n;return e=t.path,n=t.withApp,i=new o(e,n)},t.findUserByEmail=function(e,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=l._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):t._findUserByEmail(e,i)},t._findUserByEmail=function(e,i,n){var r,s,o;return null==e||""===e?(s=f.InvalidArgumentException("email should not null or empty"),r=l._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/EMAIL:"+e),t._findUserRequestImpl(o,i,n))},t.findUserByPhone=function(e,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=l._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):t._findUserByPhone(e,i)},t._findUserByPhone=function(e,i,n){var r,s,o;return null==e||""===e?(s=f.InvalidArgumentException("phone should not null or empty"),r=l._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/PHONE:"+e),t._findUserRequestImpl(o,i,n))},t.findUserByUsername=function(e,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=l._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):t._findUserByUsername(e,i)},t._findUserByUsername=function(e,i,n){var r,s,o;return null==e||""===e?(s=f.InvalidArgumentException("username should not null or empty"),r=l._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/LOGIN_NAME:"+e),t._findUserRequestImpl(o,i,n))},t._findUserRequestImpl=function(e,i,n){return new Promise(function(r,s){var o;return o={success:function(){var t;return null!=i&&null!=(t=i.success)&&t.apply(i,arguments),r(null!=n?arguments:arguments[0])},failure:function(){var t;return null!=i&&null!=(t=i.failure)&&t.apply(i,arguments),s(null!=n?l._Error(arguments[1],arguments[0]):l._Error(arguments[0]))}},t._findUserRequestImplUsingCallbacks(e,o,n)})},t._findUserRequestImplUsingCallbacks=function(t,e,i){var n,r,s;return r=h.createXHRWrapper("GET",t),s=r.xhr,s.setRequestHeader("x-kii-appid",f.Kii.getAppID()),s.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),s.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),null!=i?s.setRequestHeader("Authorization","Bearer "+i._getToken()):s.setRequestHeader("Authorization","Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),n={success:function(){var t,n;if(null!=e)try{return t=JSON.parse(s.responseText),null!=i?(n=new f.KiiUserWithToken(i._getToken()),n._updateWithJSON(t),e.success(i,n)):(n=new f.KiiUser,n._updateWithJSON(t),e.success(n))}catch(r){return null!=i?e.failure(i,"Unable to parse response"):e.failure("Unable to parse response")}},failure:function(){var t,n;if(null!=e){t="Failed to find user. statusCode: "+s.status;try{if(n=JSON.parse(s.responseText),null!=n.errorCode&&(t+=" error code: "+n.errorCode),null!=n.message)return t+=" error message: "+n.message}finally{null!=i?e.failure(i,t):e.failure(t)}}}},r.send(n)},t.prototype._getXhrWrapper=function(t,e){var i,n;return i=h.createXHRWrapper(t,e),n=i.xhr,n.setRequestHeader("x-kii-appid",f.Kii.getAppID()),n.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),n.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),i},t.prototype._setAuthHeader=function(t){var e;return e=f.KiiUser.getCurrentUser(),null!=e?t.setRequestHeader("Authorization","Bearer "+e.getAccessToken()):void 0},t.prototype._groupWithJSON=function(t){return f.KiiGroup._groupWithJSON(t)},t.prototype.topicWithName=function(t){var e,i;if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");if(e=this.getID(),!e)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopic(i,t)},t.prototype.listTopics=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,e)}}(this))},t.prototype._listTopicsUsingCallbacks=function(t,e){var i,n,r;return n=""+this._getHttpURI()+"/topics","string"==typeof e&&""!==e&&(n=n+"?paginationKey="+encodeURIComponent(e)),r=h.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(e){return function(){var i,n,s,o,u,a;for(i=JSON.parse(r.xhr.responseText),s=[],a=i.topics,o=0,u=a.length;u>o;o++)n=a[o],s.push(e.topicWithName(n.topicID));return null!=t?t.success(s,void 0===i.paginationKey?null:i.paginationKey):void 0}}(this),failure:function(e){return function(){var i,n;return n=r.getErrorString("list topics"),i=l._Error(n,e),null!=t?t.failure(i):void 0}}(this)},r.send(i)},t.prototype.pushSubscription=function(){return new f.KiiPushSubscription(this)},t.prototype.pushInstallation=function(){return new f.KiiPushInstallation(this)},t.prototype._getSubscriberPath=function(){return"users/"+this.getID()},t.prototype._clone=function(t){var e,i;if(null==t||"object"!=typeof t)return t;i=new t.constructor;for(e in t)i[e]=this._clone(t[e]);return i},t.prototype._getHttpURI=function(){return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users/"+this.getID()},t.prototype._setAuthToken=function(t){return t.setCurrentUserToken()},t}(),l=function(){function t(){}return t.MAX_DATE_IN_MILLIS=864e13,t.MIN_DATE_IN_MILLIS=-864e13,t._validateEmail=function(e){var i;return"string"!==(typeof e).toLowerCase()?(f.Kii.logger("Not string"),!1):(e=t._trim(e),i=/^[^@]+@[^@]+$/,i.test(e))},t._validatePhoneNumber=function(e){var i;return e=t._trim(e),i=/^[\\+]?[0-9]{10,}$/i,"string"!==(typeof e).toLowerCase()?(f.Kii.logger("Not string"),!1):!!e.match(i)},t._isGlobalPhoneNumber=function(e){var i;return e=t._trim(e),i=/^[\\+]{1}[0-9]{2}/,"string"!==(typeof e).toLowerCase()?(f.Kii.logger("Not string"),!1):!!e.match(i)},t._validateLocalPhone=function(e){var i;return e=t._trim(e),i=/^\d+$/,"string"!==(typeof e).toLowerCase()?(f.Kii.logger("Not string"),!1):e.match(i)?!0:(f.Kii.logger("Invalid format"),!1)},t._assertLocalPhoneIsValid=function(e){if(!t._validateLocalPhone(e))throw new f.InvalidLocalPhoneNumberException},t._validateCountryCode=function(e){var i;return e=t._trim(e),i=/^[a-z]{2}$/i,"string"!==(typeof e).toLowerCase()?(f.Kii.logger("Not string"),!1):e.match(i)?(f.Kii.logger("Is true"),!0):!1},t._assertCountryCodeIsValid=function(e){if(!t._validateCountryCode(e))throw new f.InvalidCountryException},t._validatePassword=function(t){var e;return f.Kii.logger("Validating password: "+t),e=/^[\x20-\x7E]{4,50}$/,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("not string"),!1):t.match(e)?(f.Kii.logger("matched"),!0):(f.Kii.logger("other exception"),!1)},t._assertPasswordIsValid=function(e){if(!t._validatePassword(e))throw new f.InvalidPasswordException},t._validateUsername=function(t){var e;return e=/^[a-zA-Z0-9-_\\.]{3,64}$/i,"string"!==(typeof t).toLowerCase()?!1:!!t.match(e)},t._validateGroupID=function(t){var e;return e=/^[a-z0-9-_.]{1,30}$/,"string"!==(typeof t).toLowerCase()?!1:!!t.match(e)},t._validateDisplayName=function(e){var i;return"string"===t._type(e)&&1<=(i=e.length)&&50>=i},t._trim=function(t){var e;return e=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,(t||"").replace(e,"")},t._safeAddTicks=function(e,i){if(isNaN(parseInt(e,10))||isNaN(parseInt(i,10)))throw new f.InvalidArgumentException("Parameters should be a number");if(Math.abs(e+i)>t.MAX_DATE_IN_MILLIS)throw new f.ArithmeticException("Addition of "+e+" and "+i+" result in long overflow");return e+i},t._safeMultiplyTicks=function(e,i){if(isNaN(parseInt(e,10))||isNaN(parseInt(i,10)))throw new f.InvalidArgumentException("Parameters should be a number");if(Math.abs(e*i)>t.MAX_DATE_IN_MILLIS)throw new f.ArithmeticException("Multiplication of "+e+" and "+i+" result in long overflow");return e*i},t._safeCalculateExpiresAtAsNumber=function(e,i){var n,r,s;s=0;try{r=t._safeMultiplyTicks(e,1e3),s=t._safeAddTicks(i,r)}catch(o){if(n=o,!(n instanceof f.ArithmeticException))throw n;s=t.MAX_DATE_IN_MILLIS}return s},t._safeCalculateExpiresAtAsDate=function(e,i){var n,r,s;s=0;try{r=t._safeMultiplyTicks(e,1e3),s=t._safeAddTicks(i,r)}catch(o){if(n=o,!(n instanceof f.ArithmeticException))throw n;s=t.MAX_DATE_IN_MILLIS}return new Date(s)},t._isJSONType=function(t){var e;return e=/\+?json(;.*)?$/i,t.match(e)},t._type=function(t){var e;return void 0===t||null===t?String(t):(e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},e[Object.prototype.toString.call(t)])},t._disableCacheURL=function(t){return t+=-1!==t.indexOf("?")?"&disable_cache=":"?disable_cache=",t+=(new Date).getTime()},t._validateServerCodeEntryName=function(e){var i;return i=/^[a-zA-Z][_a-zA-Z0-9]*$/i,"string"===t._type(e)&&e.match(i)},t._validateServerCodeEntryArgument=function(e){return"null"===t._type(e)||"object"===t._type(e)&&Object.keys(e).length>0},t._validateServerCodeEnryVersion=function(e){return"string"===t._type(e)&&""!==e},t._isNonEmptyString=function(t){return"string"!=typeof t?!1:t.length>0},t._Error=function(t,e){var i;return i=Error(t),i.target=e,i},t._clone=function(e){var i,n,r;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return i="",e.global&&(i+="g"),e.ignoreCase&&(i+="i"),e.multiline&&(i+="m"),e.sticky&&(i+="y"),new RegExp(e.source,i);r=new e.constructor;for(n in e)r[n]=t._clone(e[n]);return r},t}(),f.KiiSocialConnect=function(){function t(){}var e;return e=null,t.setupNetwork=function(t,e,i,n){},t.logIn=function(i,n,r){return null==e&&(e=new d),new Promise(function(e,s){var o,u,a;a={success:function(){return null!=r&&r.success.apply(r,arguments),e(arguments)},failure:function(){var t;return null!=r&&r.failure.apply(r,arguments),t=l._Error(arguments[2]),t.network=i,s(t)}};try{return t._logInUsingCallbacks(i,n,a)}catch(c){return u=c,null!=r&&"function"==typeof r.failure&&r.failure(null,i,u),o=l._Error(u),o.network=i,s(o)}})},t._logInUsingCallbacks=function(t,i,n){var r;return r=!1,null!=e&&(f.Kii.logger("And manager: "),f.Kii.logger(e._getManager(t)),e._getManager(t)&&(e._getManager(t)._logIn(i,n),r=!0)),f.Kii.logger("Callbacks"),f.Kii.logger(n),r||null==n?void 0:n.failure(f.KiiUser.getCurrentUser(),t,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},t.linkCurrentUserWithNetwork=function(i,n,r){return null==e&&(e=new d),new Promise(function(e,s){var o,u,a,c;c={success:function(){return null!=r&&r.success.apply(r,arguments),e(arguments)},failure:function(){var t;return null!=r&&r.failure.apply(r,arguments),t=l._Error(arguments[2]),t.target=arguments[0],t.network=i,s(t)}};try{return t._linkCurrentUserWithNetworkUsingCallbacks(i,n,c)}catch(h){return a=h,o=f.KiiUser.getCurrentUser(),null!=r&&"function"==typeof r.failure&&r.failure(o,i,a),u=l._Error(a),u.target=o,u.network=i,s(u)}})},t._linkCurrentUserWithNetworkUsingCallbacks=function(t,i,n){var r;return f.Kii.logger("Trying with instance"),f.Kii.logger(e),r=!1,null!=e&&(f.Kii.logger("And manager: "),f.Kii.logger(e._getManager(t)),e._getManager(t)&&(e._getManager(t)._linkWithCurrentUser(i,n),r=!0)),f.Kii.logger("Callbacks"),f.Kii.logger(n),r||null==n?void 0:n.failure(f.KiiUser.getCurrentUser(),t,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},t.unLinkCurrentUserFromNetwork=function(i,n){return null==e&&(e=new d),new Promise(function(e,r){var s;return s={success:function(){return null!=n&&n.success.apply(n,arguments),e(arguments)},failure:function(){var t;return null!=n&&n.failure.apply(n,arguments),t=l._Error(arguments[2]),t.target=arguments[0],t.network=i,r(t)}},t._unLinkCurrentUserWithNetworkUsingCallbacks(i,s)})},t._unLinkCurrentUserWithNetworkUsingCallbacks=function(t,i){if(f.Kii.logger("Trying with instance"),f.Kii.logger(e),null!=e){if(f.Kii.logger("And manager: "),f.Kii.logger(e._getManager(t)),e._getManager(t))return e._getManager(t)._unlinkFromCurrentUser(i)}else if(null!=i)return i.failure(f.KiiUser.getCurrentUser(),t,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},t.getAccessTokenForNetwork=function(t){return null!=e?e._getManager(t)._getToken():void 0},t.getAccessTokenExpirationForNetwork=function(t){return null!=e?e._getManager(t)._getTokenExpiration():void 0},t.getAccessTokenObjectForNetwork=function(t){return null!=e?e._getManager(t)._getTokenObject():void 0},t.logOutAll=function(){var t,i,n,r,s;return null!=e&&(t=e._getManager(f.KiiSocialNetworkName.FACEBOOK),null!=t&&t._logOut(),s=e._getManager(f.KiiSocialNetworkName.TWITTER),null!=s&&s._logOut(),n=e._getManager(f.KiiSocialNetworkName.QQ),null!=n&&n._logOut(),i=e._getManager(f.KiiSocialNetworkName.GOOGLEPLUS),null!=i&&i._logOut(),r=e._getManager(f.KiiSocialNetworkName.RENREN),null!=r)?r._logOut():void 0},t}(),d=function(){function t(){this._getManager=y(this._getManager,this)}return t.prototype._getManager=function(t){return t===f.KiiSocialNetworkName.FACEBOOK?null!=this._facebookManager?this._facebookManager:this._facebookManager=new f.KiiSCNFacebook:t===f.KiiSocialNetworkName.TWITTER?null!=this._twitterManager?this._twitterManager:this._twitterManager=new f.KiiSCNTwitter:t===f.KiiSocialNetworkName.QQ?null!=this._qqManager?this._qqManager:this._qqManager=new f.KiiSCNQQ:t===f.KiiSocialNetworkName.GOOGLEPLUS?null!=this._googleManager?this._googleManager:this._googleManager=new f.KiiSCNGoogle:t===f.KiiSocialNetworkName.RENREN?null!=this._renrenManager?this._renrenManager:this._renrenManager=new f.KiiSCNRenRen:void 0;
},t}(),f.KiiSocialConnectNetwork=function(){function t(t){this._network=t,this._unlink=y(this._unlink,this),this._link=y(this._link,this),this._register=y(this._register,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._isAuthenticated=y(this._isAuthenticated,this),this._getTokenObject=y(this._getTokenObject,this),this._setTokenObject=y(this._setTokenObject,this),this._getTokenExpiration=y(this._getTokenExpiration,this),this._setTokenExpiration=y(this._setTokenExpiration,this),this._getToken=y(this._getToken,this),this._setToken=y(this._setToken,this),this._getNetwork=y(this._getNetwork,this),this._setNetwork=y(this._setNetwork,this),this._tokenExpiration=null,this._token=null}return t.prototype._className="KiiSocialConnectNetwork",t.prototype._setNetwork=function(t){this._network=t},t.prototype._getNetwork=function(){return this._network},t.prototype._setToken=function(t){this._token=t},t.prototype._getToken=function(){return this._token},t.prototype._setTokenExpiration=function(t){this._tokenExpiration=t},t.prototype._getTokenExpiration=function(){return this._tokenExpiration},t.prototype._setTokenObject=function(t){this._tokenObject=t},t.prototype._getTokenObject=function(){return this._tokenObject},t.prototype._isAuthenticated=function(){return null!=this._tokenObject},t.prototype._logIn=function(t,e){},t.prototype._logOut=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null},t.prototype._linkWithCurrentUser=function(t,e){},t.prototype._unlinkFromCurrentUser=function(t){},t.prototype._createTokenObject=function(t,e){},t.prototype._getAccessToken=function(t){},t.prototype._register=function(t,e,i,n,r){var s,u,a,c,h;return f.Kii.getAccessTokenExpiration()>0&&(u=new Date,s=u.getTime(),i.expiresAt=l._safeCalculateExpiresAtAsNumber(f.Kii.getAccessTokenExpiration(),s)),c=new o("/integration/"+t,!0),c.setMethod("POST"),c.setData(i),c.setAnonymous(!0),c.setContentType(e),h=this._getAccessToken(n),a={success:function(t){return function(e){var i,o,a,c;return t._setToken(h),o=t._createTokenObject(n,e),t._setTokenObject(o),a=new f.KiiUser,a._updateWithJSON(e),a._setAccessToken(e.access_token),null!=e.expires_in&&(u=new Date,s=u.getTime(),c=l._safeCalculateExpiresAtAsDate(e.expires_in,s),a._setExpiresAt(c)),f.Kii.setCurrentUser(a),i={success:function(e){return f.Kii.setCurrentUser(e),null!=r?r.success(e,t._network):void 0},failure:function(e,i){return null!=r?r.failure(e,t._network,i):void 0}},a.refresh(i)}}(this),failure:function(t){return function(e,i){return null!=r?r.failure(null,t._network,e):void 0}}(this)},c.execute(a,!1)},t.prototype._link=function(t,e,i,n,r){var s,u,a;return u=new o("/users/me/"+t+"/link",!0),u.setMethod("POST"),u.setData(i),u.setContentType(e),a=this._getAccessToken(n),s={success:function(t){return function(e){var i,s;return t._setToken(a),s=t._createTokenObject(n,e),t._setTokenObject(s),i={success:function(e){return f.Kii.setCurrentUser(e),null!=r?r.success(e,t._network):void 0},failure:function(e,i){return null!=r?r.failure(e,t._network,i):void 0}},f.KiiUser.getCurrentUser().refresh(i)}}(this),failure:function(t){return function(e,i){return null!=r?r.failure(f.KiiUser.getCurrentUser(),t._network,e):void 0}}(this)},u.execute(s,!0)},t.prototype._unlink=function(t,e){var i,n;return i=new o("/users/me/"+t+"/unlink",!0),i.setMethod("POST"),n={success:function(t){return function(i){var n;return t._setToken(null),t._setTokenExpiration(null),t._setTokenObject(null),n={success:function(i){return f.Kii.setCurrentUser(i),null!=e?e.success(i,t._network):void 0},failure:function(i,n){return null!=e?e.failure(i,t._network,n):void 0}},f.KiiUser.getCurrentUser().refresh(n)}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(f.KiiUser.getCurrentUser(),t._network,i):void 0}}(this)},i.execute(n,!0)},t}(),f.KiiSCNFacebook=function(t){function e(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),e.__super__.constructor.call(this,f.KiiSocialNetworkName.FACEBOOK)}return k(e,t),e.prototype._setup=function(t,i,n){return this._key=t,this._secret=i,this._extras=n,e.__super__._setup.call(this,this._key,this._secret,this._extras)},e.prototype._createTokenObject=function(t,e){var i;return i={access_token:t.access_token},null!=e&&null!=e.new_user_created&&(i.kii_new_user=e.new_user_created),i},e.prototype._getAccessToken=function(t){return t.access_token},e.prototype._logIn=function(t,e){var i;if(f.Kii.logger("should auth fb"),f.Kii.logger("Checking options"),null==t||!t.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:t.access_token},this._register("facebook","application/vnd.kii.AuthTokenFacebookRequest+json",i,t,e)},e.prototype._logOut=function(){return e.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out fb")},e.prototype._linkWithCurrentUser=function(t,e){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==t||!t.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:t.access_token},this._link("facebook","application/vnd.kii.LinkFacebookRequest+json",i,t,e)}return null!=e?e.failure(null,this._network,"A KiiUser must be logged in before linking to Facebook"):void 0},e.prototype._unlinkFromCurrentUser=function(t){return null!=f.KiiUser.getCurrentUser()?this._unlink("facebook",t):null!=t?t.failure("A KiiUser must be logged in before unlinking from Facebook"):void 0},e}(f.KiiSocialConnectNetwork),f.InvalidDisplayNameException=function(){return this.message="Unable to set displayName. Must be between 1-50 characters."},f.InvalidPasswordException=function(){return this.message="Unable to set password. Must be between 4-50 characters composed with ascii (exclude control character)"},f.InvalidUsernameException=function(){return this.message="Unable to set username. Must be between 3 and 64 characters, which can include alphanumeric characters as well as underscores '_' and periods '.'"},f.InvalidUserIdentifierException=function(){return this.message="User identifier should be one of user name, phone number or email"},f.InvalidEmailException=function(){return this.message="Unable to set email address. Must be a valid email"},f.InvalidPhoneNumberException=function(){return this.message="Unable to set phone number. Must begin with a '+' and be at least 10 digits"},f.InvalidLocalPhoneNumberException=function(){return this.message="Unable to set phone number. Must be a sequence of numbers"},f.InvalidCountryException=function(){return this.message="Unable to set country code. Must be 2 alphabetic characters. Ex: US, JP, CN"},f.InvalidURIException=function(){return this.message="Unable to set URI. Must be of the form kiicloud://some/path/to/object/or/entity"},f.InvalidACLAction=function(){return this.message="Unable to set ACL action. Must be one of the permitted values in KiiACLAction"},f.InvalidACLSubject=function(){return this.message="Unable to set ACL subject. Must be of type KiiUser or KiiGroup"},f.InvalidACLGrant=function(){return this.message="Unable to set ACL grant. Must be a boolean type"},f.InvalidLimitException=function(){return this.message="Unable to set query limit. Must be an integer > 0"},f.InvalidArgumentException=function(t){return this.message="InvalidArgument: "+t},f.IllegalStateException=function(t){return this.message="IllegalState: "+t},f.ArithmeticException=function(t){return this.message="ArithmeticException: "+t},f.UnsupportedOperationException=function(t){return this.message="UnsupportedOperationException: "+t},f.KiiAppAdminContext=function(){function t(t){this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this.loadThingWithThingID=y(this.loadThingWithThingID,this),this.loadThingWithVendorThingID=y(this.loadThingWithVendorThingID,this),this.registerOwnerWithVendorThingID=y(this.registerOwnerWithVendorThingID,this),this.registerOwnerWithThingID=y(this.registerOwnerWithThingID,this),this.thingWithID=y(this.thingWithID,this),this.registerThing=y(this.registerThing,this),this.registerGroupWithOwnerAndID=y(this.registerGroupWithOwnerAndID,this),this._getToken=y(this._getToken,this),this.getAccessToken=y(this.getAccessToken,this),this._getId=y(this._getId,this),this._objectWithURI=y(this._objectWithURI,this),this._token=t.token,this._id=t.id}return t.prototype.bucketWithName=function(t){var e;return e=new f.KiiBucketWithToken(t,null,this._token)},t.prototype.encryptedBucketWithName=function(t){var e;return e=new f.KiiEncryptedBucketWithToken(t,null,this._token)},t.prototype.groupWithName=function(t){var e;return e=f.KiiGroupWithToken._groupWithName(t,this._token)},t.prototype.userWithID=function(t){var e;return e=f.KiiUserWithToken._userWithID(t,this._token)},t.prototype.objectWithURI=function(t){var e;return e=this._objectWithURI(t)},t.prototype._userWithLoginName=function(t,e){var i,n,r;return r=new f.KiiUserWithToken(this._token),n=r._getRequest({path:"/users/LOGIN_NAME:"+t,withApp:!0}),n.setAdminToken(this._token),i={success:function(t){return function(t,i){if(300>i&&i>=200){if(r._updateWithJSON(t),null!=e)return e.success(r)}else if(null!=e)return e.failure("Unable to parse response")}}(this),failure:function(t){return function(t,i){return null!=e?e.failure(t):void 0}}(this)},n.execute(i,!1)},t.prototype._objectWithURI=function(t){var e,i,n,r,s,o,u,a,l;if(!t)throw new f.InvalidURIException;if(l=0===t.indexOf("kiicloud://"),o=t.substr("kiicloud://".length),s=o.split("/"),r=s.length,!(r>=4&&l))throw new f.InvalidURIException;if(i=4===r?1:3,n=s[i],a=null,"groups"===s[0]&&6===r)a=new f.KiiGroupWithToken._groupWithID(s[1],this._token);else if("users"===s[0]&&6===r)a=f.KiiUserWithToken._userWithID(s[1],this._token);else if("things"===s[0]&&6===r)a=f.KiiThingWithToken.thingWithID(s[1],this._token);else if(4!==r)throw new f.InvalidURIException;return e=new f.KiiBucketWithToken(n,a,this._token),u=e.createObject(),u._setUUID(s[r-1]),u},t.prototype._getId=function(){return this._id},t.prototype.getAccessToken=function(){return this._getToken()},t.prototype._getToken=function(){return this._token},t.prototype.groupWithID=function(t){var e;if(null==t||""===t)throw new f.InvalidArgumentException("groupID should not null or empty");return e=f.KiiGroupWithToken._groupWithID(t,this._token)},t.prototype.registerGroupWithOwnerAndID=function(t,e,i,n,r){return new Promise(function(s){return function(o,u){var a;return a={success:function(){return null!=r&&r.success.apply(r,arguments),o(arguments[0])},failure:function(){var t;return null!=r&&r.failure.apply(r,arguments),t=l._Error(arguments[1],arguments[0]),t.addMembersArray=arguments[2],t.removeMembersArray=arguments[3],u(t)}},f.KiiGroup._registerGroupWithIDUsingCallbacks(s._token,t,e,i,n,a)}}(this))},t.prototype.groupWithURI=function(t){var e,i,n;if(null==t)throw new f.InvalidURIException;if(0!==t.indexOf("kiicloud://"))throw new f.InvalidURIException;if(n=t.substr("kiicloud://".length),e=n.split("/"),2!==e.length||"groups"!==e[0])throw new f.InvalidURIException;return i=f.KiiGroupWithToken._groupWithID(e[1],this._token)},t.prototype.findUserByEmail=function(t,e){return f.KiiUser._findUserByEmail(t,e,this)},t.prototype.findUserByPhone=function(t,e){return f.KiiUser._findUserByPhone(t,e,this)},t.prototype.findUserByUsername=function(t,e){return f.KiiUser._findUserByUsername(t,e,this)},t.prototype.registerThing=function(t,e){return f.KiiThingWithToken.register(t,e,this._token)},t.prototype.thingWithID=function(t){return f.KiiThingWithToken.thingWithID(t,this._token)},t.prototype.registerOwnerWithThingID=function(t,e,i){return f.KiiThingWithToken.registerOwnerWithThingID(t,e,i,this._token)},t.prototype.registerOwnerWithVendorThingID=function(t,e,i){return f.KiiThingWithToken.registerOwnerWithVendorThingID(t,e,i,this._token)},t.prototype.thingWithID=function(t){return f.KiiThingWithToken.thingWithID(t,this._token)},t.prototype.loadThingWithVendorThingID=function(t,e){return f.KiiThingWithToken.loadWithVendorThingID(t,e,this._token)},t.prototype.loadThingWithThingID=function(t,e){return f.KiiThingWithToken.loadWithThingID(t,e,this._token)},t.prototype.topicWithName=function(t){if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopicWithToken(""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID(),t,this._token)},t.prototype.listTopics=function(t,e){return f.Kii._listTopics(t,e,this)},t}(),f.KiiACLWithToken=function(t){function e(t,i){this._userWithID=y(this._userWithID,this),this._groupWithID=y(this._groupWithID,this),this._getRequest=y(this._getRequest,this),e.__super__.constructor.call(this),this._setParent(t),this._authToken=i}return k(e,t),e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._authToken),i},e.prototype._groupWithID=function(t){var e;return e=f.KiiGroupWithToken._groupWithID(t,this._authToken)},e.prototype._userWithID=function(t){var e;return e=f.KiiUserWithToken._userWithID(t,this._authToken)},e}(f.KiiACL),f.KiiGroupWithToken=function(t){function e(t){this.topicWithName=y(this.topicWithName,this),this._setAuthToken=y(this._setAuthToken,this),this._setOwnerFromContext=y(this._setOwnerFromContext,this),this._userWithID=y(this._userWithID,this),this.bucketWithName=y(this.bucketWithName,this),this._getRequest=y(this._getRequest,this),e.__super__.constructor.call(this),this._authToken=t}return k(e,t),e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._authToken),i},e._groupWithName=function(t,e){return f.KiiGroupWithToken._groupWithNameAndMembers(t,null,e)},e._groupWithNameAndMembers=function(t,e,i){var n;return n=new f.KiiGroupWithToken(i),n._setName(t),n._setAddMembers(e),n},e._groupWithID=function(t,e){var i;return i=new f.KiiGroupWithToken(e),i._setUUID(t),i},e.prototype.bucketWithName=function(t){var e;return e=new f.KiiBucketWithToken(t,this,this._authToken)},e.prototype.encryptedBucketWithName=function(t){var e;return e=new f.KiiEncryptedBucketWithToken(t,this,this._authToken)},e.prototype._userWithID=function(t){var e;return e=f.KiiUserWithToken._userWithID(t,this._authToken)},e.prototype._setOwnerFromContext=function(t){},e._groupWithJSON=function(t,e){var i;return i=new f.KiiGroupWithToken(e),null!=t.groupID&&i._setUUID(t.groupID),null!=t.name&&i._setName(t.name),null!=t.owner&&i._setOwner(f.KiiUserWithToken._userWithID(t.owner,e)),i},e.prototype._setAuthToken=function(t){return t.setAuthToken(this._authToken)},e.prototype.topicWithName=function(t){var e,i;if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");if(e=this.getID(),!e)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopicWithToken(i,t,this._authToken)},e}(f.KiiGroup),f.KiiObjectWithToken=function(t){function e(t){this._userWithID=y(this._userWithID,this),this.objectACL=y(this.objectACL,this),this._getToken=y(this._getToken,this),this._getRequest=y(this._getRequest,this),e.__super__.constructor.call(this),this._authToken=t}return k(e,t),e.prototype._getRequest=function(t){var i;return f.Kii.logger("admin req: "+this._authToken),i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._authToken),i},e.prototype._getToken=function(){return this._authToken?this._authToken:null},e.objectWithBucket=function(t,e,i){var n;return f.Kii.logger("Creating object w type: "+e),n=new f.KiiObjectWithToken(i),n._setBucket(t),n._setObjectType(e),f.Kii.logger(n),n},e.objectWithID=function(t,e,i){var n;return f.Kii.logger("Creating object w id: "+e),n=new f.KiiObjectWithToken(i),n._setBucket(t),n._setUUID(e),f.Kii.logger(n),n},e.prototype.objectACL=function(){var t;return t=new f.KiiACLWithToken(this,this._authToken)},e.prototype._userWithID=function(t){var e;return e=f.KiiUserWithToken._userWithID(t,this._authToken)},e}(f.KiiObject),f.KiiUserWithToken=function(t){function e(t){this.pushInstallation=y(this.pushInstallation,this),this.topicWithName=y(this.topicWithName,this),this.pushSubscription=y(this.pushSubscription,this),this._groupWithJSON=y(this._groupWithJSON,this),this.bucketWithName=y(this.bucketWithName,this),this._setAuthHeader=y(this._setAuthHeader,this),this._setAuthToken=y(this._setAuthToken,this),this._getRequest=y(this._getRequest,this),e.__super__.constructor.call(this),this._authToken=t}return k(e,t),e._userWithID=function(t,e){var i;return i=new f.KiiUserWithToken(e),i._setUUID(t),i},e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._authToken),i},e.prototype._setAuthToken=function(t){return t.setAuthToken(this._authToken)},e.prototype._setAuthHeader=function(t){return t.setRequestHeader("Authorization","Bearer "+this._authToken)},e.prototype.bucketWithName=function(t){var e;return e=new f.KiiBucketWithToken(t,this,this._authToken)},e.prototype.encryptedBucketWithName=function(t){var e;return e=new f.KiiEncryptedBucketWithToken(t,this,this._authToken)},e.prototype._groupWithJSON=function(t){var e;return e=new f.KiiGroupWithToken._groupWithJSON(t,this._authToken)},e.prototype.pushSubscription=function(){return new f.KiiPushSubscriptionWithToken(this,this._authToken)},e.prototype.topicWithName=function(t){var e;if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");if(e=this.getID(),!e)throw"can not instantiate topic from instance which doesn't have ID";return new f.KiiTopicWithToken(this._getHttpURI(),t,this._authToken)},e.prototype.pushInstallation=function(){throw new f.UnsupportedOperationException("Push installation is not supported by admin context")},e}(f.KiiUser),f.KiiAnonymousUser=function(){function t(){this.getID=y(this.getID,this)}return t.prototype.getID=function(){return"ANONYMOUS_USER"},t}(),f.KiiAnyAuthenticatedUser=function(){function t(){this.getID=y(this.getID,this)}return t.prototype.getID=function(){return"ANY_AUTHENTICATED_USER"},t}(),f.KiiSDKClientInfo=function(){function t(){}return t.getSDKClientInfo=function(){return null==t._clientInfo&&(t._clientInfo="sn=jss;sv="+f.Kii.getSDKVersion()),t._clientInfo},t}(),f.KiiSCNTwitter=function(t){function e(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),e.__super__.constructor.call(this,f.KiiSocialNetworkName.TWITTER)}return k(e,t),e.prototype._setup=function(t,i,n){return this._key=t,this._secret=i,this._extras=n,e.__super__._setup.call(this,this._key,this._secret,this._extras)},e.prototype._createTokenObject=function(t,e){var i;return i={oauth_token:t.oauth_token,oauth_token_secret:t.oauth_token_secret},null!=e&&null!=e.new_user_created&&(i.kii_new_user=e.new_user_created),i},e.prototype._getAccessToken=function(t){return t.oauth_token},e.prototype._logIn=function(t,e){var i;if(f.Kii.logger("Checking options"),f.Kii.logger(t),null==t||!t.oauth_token&&!t.oauth_token_secret)throw f.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!t.oauth_token)throw f.InvalidArgumentException("options.oauth_token is required");if(!t.oauth_token_secret)throw f.InvalidArgumentException("options.oauth_token_secret is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:t.oauth_token,accessTokenSecret:t.oauth_token_secret},this._register("twitter","application/vnd.kii.AuthTokenTwitterRequest+json",i,t,e)},e.prototype._logOut=function(){return e.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out twitter")},e.prototype._linkWithCurrentUser=function(t,e){var i;if(null==f.KiiUser.getCurrentUser())return void e.failure(null,this._network,"No user logged in");if(null==t||!t.oauth_token&&!t.oauth_token_secret)throw f.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!t.oauth_token)throw f.InvalidArgumentException("options.oauth_token is required");if(!t.oauth_token_secret)throw f.InvalidArgumentException("options.oauth_token_secret is required");return i={accessToken:t.oauth_token,accessTokenSecret:t.oauth_token_secret},this._link("twitter","application/vnd.kii.LinkTwitterRequest+json",i,t,e)},e.prototype._unlinkFromCurrentUser=function(t){return null==f.KiiUser.getCurrentUser()?void t.failure(null,this._network,"No user logged in"):this._unlink("twitter",t)},e}(f.KiiSocialConnectNetwork),f.KiiGeoPoint=function(){function t(t,e){var i;if(this._latitude=t,this._longitude=e,this._toDict=y(this._toDict,this),this.getLongitude=y(this.getLongitude,this),this.getLatitude=y(this.getLatitude,this),i=function(t,e,i){return i>t&&e>i&&!isNaN(i)},!i(-90,90,this._latitude)||!i(-180,180,this._longitude))throw f.InvalidArgumentException("Specified latitide or longitude is invalid")}return t.prototype.getLatitude=function(){return this._latitude},t.prototype.getLongitude=function(){return this._longitude},t.geoPoint=function(t,e){return new f.KiiGeoPoint(t,e)},t.prototype._toDict=function(){var t;return t={_type:"point",lat:this._latitude,lon:this._longitude}},t}(),s=function(){function t(t,e,i){this.xhr=$.ajaxSettings.xhr(),e=l._disableCacheURL(e),this.xhr.open(t,e,!0),this.xhr.onreadystatechange=i.onComplete}return t}(),p=function(){function t(t,e,i){e=l._disableCacheURL(e),this.xhr=new XMLHttpRequest,"withCredentials"in this.xhr?(this.xhr.open(t,e,!0),this.xhr.onreadystatechange=i.onComplete):this.xhr=null}return t}(),a=function(){function t(t,e,i){this.xhr=Ti.Network.createHTTPClient(),e=l._disableCacheURL(e),this.xhr.open(t,e,!0),this.xhr.onload=i.onComplete,this.xhr.onerror=i.onError}return t}(),h=function(){function t(){}return t.createXHRWrapper=function(t,e){var i;return i=null,null===f.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(f.Kii.logger("Use jQuery"),i=new r(t,e)):"undefined"!=typeof XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),i=new c(t,e)):"undefined"!=typeof Titanium&&(f.Kii.logger("Use Titanium"),i=new u(t,e)):(f.Kii.logger("Use http request backdoor"),f.Kii._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.Kii.logger("Use jQuery"),i=new r(t,e)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),i=new c(t,e)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),i=new u(t,e))),i},t}(),c=function(){function t(t,e){this.setAuthToken=y(this.setAuthToken,this),this.setAdminOrUserToken=y(this.setAdminOrUserToken,this),this.setCurrentUserToken=y(this.setCurrentUserToken,this),this.setContentType=y(this.setContentType,this),this.setKiiHeaders=y(this.setKiiHeaders,this),this.getErrorCode=y(this.getErrorCode,this),this.getErrorString=y(this.getErrorString,this),this.sendData=y(this.sendData,this),this.send=y(this.send,this),this._setUpCallbacks=y(this._setUpCallbacks,this);var i,n,r;if(e=l._disableCacheURL(e),this.xhr=new XMLHttpRequest,this.method=t,"withCredentials"in this.xhr){if(this.xhr.open(t,e,!0),i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}else this.xhr=null}return t.prototype.getAppID=function(){return f.Kii.getAppID()},t.prototype.getAppKey=function(){return f.Kii.getAppKey()},t.prototype.getLogger=function(){return f.Kii.logger()},t.prototype._setUpCallbacks=function(t){return t&&t.progress?"PUT"===this.method?this.xhr.upload.addEventListener("progress",t.progress,!1):this.xhr.addEventListener("progress",t.progress,!1):void 0},t.prototype.send=function(t){var e;return this._setUpCallbacks(t),e={onComplete:function(e){return function(){var i;if(4===e.xhr.readyState)if(200<=(i=e.xhr.status)&&400>i){if(e.getLogger("Completed Request["+e.xhr.status+"]"),null!=t)return t.success()}else if(e.getLogger("Error loading data..."),e.getLogger("callback : "+t),null!=t)return t.failure()}}(this)},this.xhr.onreadystatechange=e.onComplete,this.xhr.send()},t.prototype.sendData=function(t,e){var i;return this._setUpCallbacks(e),i={onComplete:function(t){return function(){var i;if(4===t.xhr.readyState)if(200<=(i=t.xhr.status)&&400>i){if(t.getLogger("Completed Request["+t.xhr.status+"]"),null!=e)return e.success()}else if(t.getLogger("Error loading data..."),null!=e)return e.failure()}}(this)},this.xhr.onreadystatechange=i.onComplete,this.xhr.send(t)},t.prototype.getErrorString=function(t){var e,i;e=""+t+" failed. statusCode: "+this.xhr.status;try{return i=JSON.parse(decodeURIComponent(this.xhr.responseText)),null!=i.errorCode&&(e+=" error code: "+i.errorCode),null!=i.message&&(e+=" message: "+i.message),e}catch(n){return e}},t.prototype.getErrorCode=function(){var t;try{return t=JSON.parse(decodeURIComponent(this.xhr.responseText)),t.errorCode}catch(e){return null}},t.prototype.setKiiHeaders=function(){return this.xhr.setRequestHeader("x-kii-appid",this.getAppID()),this.xhr.setRequestHeader("x-kii-appkey",this.getAppKey()),this.xhr.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo())},t.prototype.setContentType=function(t){return this.xhr.setRequestHeader("Content-Type",t)},t.prototype.setCurrentUserToken=function(){var t,e;return t=null!=(e=this.getCurrentUser())?e.getAccessToken():void 0,null!=t?(this.xhr.setRequestHeader("authorization","bearer "+t),!0):!1},t.prototype.setAdminOrUserToken=function(t){var e,i;return e=null!=t?t._getToken():null!=(i=this.getCurrentUser())?i.getAccessToken():void 0,null!=e?(this.xhr.setRequestHeader("authorization","bearer "+e),!0):!1},t.prototype.setAuthToken=function(t){return null!=t?this.xhr.setRequestHeader("authorization","bearer "+t):void 0},t.prototype.getCurrentUser=function(){return f.KiiUser.getCurrentUser()},t}(),u=function(t){function e(t,e){this.sendData=y(this.sendData,this),this.send=y(this.send,this);var i,n,r;if(e=l._disableCacheURL(e),this.xhr=Ti.Network.createHTTPClient(),this.method=t,this.xhr.open(t,e,!0),i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}return k(e,t),e.prototype.send=function(t){var e;return this._setUpCallbacks(t),e={onComplete:function(e){return function(){var i;if(4===e.xhr.readyState)if(200<=(i=e.xhr.status)&&400>i){if(f.Kii.logger("Completed Request["+e.xhr.status+"]"),null!=t)return t.success()}else if(f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+t),null!=t)return t.failure()}}(this),onError:function(e){return function(){return f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+t),null!=t?t.failure():void 0}}(this)},this.xhr.onload=e.onComplete,this.xhr.onerror=e.onError,this.xhr.send()},e.prototype.sendData=function(t,e){var i;return this._setUpCallbacks(e),i={onComplete:function(t){return function(){var i;if(4===t.xhr.readyState)if(200<=(i=t.xhr.status)&&400>i){if(f.Kii.logger("Completed Request["+t.xhr.status+"]"),null!=e)return e.success()}else if(f.Kii.logger("Error loading data..."),null!=e)return e.failure()}}(this),onError:function(t){return function(){return f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+e),null!=e?e.failure():void 0}}(this)},this.xhr.onload=i.onComplete,this.xhr.onerror=i.onError,this.xhr.send(t)},e}(c),r=function(t){function e(t,e){var i,n,r;if(e=l._disableCacheURL(e),this.xhr=$.ajaxSettings.xhr(),this.xhr.open(t,e,!0),this.method=t,i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}return k(e,t),e}(c),f.KiiSCNQQ=function(t){function e(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),e.__super__.constructor.call(this,f.KiiSocialNetworkName.QQ)}return k(e,t),e.prototype._setup=function(t,i,n){return this._key=t,this._secret=i,this._extras=n,e.__super__._setup.call(this,this._key,this._secret,this._extras)},e.prototype._createTokenObject=function(t,e){var i;return i={access_token:t.access_token,openID:t.openID},null!=e&&null!=e.new_user_created&&(i.kii_new_user=e.new_user_created),i},e.prototype._getAccessToken=function(t){return t.access_token},e.prototype._logIn=function(t,e){var i;if(f.Kii.logger("Checking options"),f.Kii.logger(t),null==t||!t.access_token&&!t.openID)throw f.InvalidArgumentException("Both options.access_token and options.openID are required");if(!t.access_token)throw f.InvalidArgumentException("options.access_token is required");if(!t.openID)throw f.InvalidArgumentException("options.openID is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:t.access_token,openID:t.openID},this._register("qq","application/vnd.kii.AuthTokenQQRequest+json",i,t,e)},e.prototype._logOut=function(){return e.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out qq")},e.prototype._linkWithCurrentUser=function(t,e){var i;if(null==f.KiiUser.getCurrentUser())return void e.failure(null,this._network,"No user logged in");if(null==t||!t.access_token&&!t.openID)throw f.InvalidArgumentException("Both options.access_token and options.openID are required");if(!t.access_token)throw f.InvalidArgumentException("options.access_token is required");if(!t.openID)throw f.InvalidArgumentException("options.openID is required");return i={accessToken:t.access_token,openID:t.openID},this._link("qq","application/vnd.kii.LinkQQRequest+json",i,t,e)},e.prototype._unlinkFromCurrentUser=function(t){return null==f.KiiUser.getCurrentUser()?void t.failure(null,this._network,"No user logged in"):this._unlink("qq",t)},e}(f.KiiSocialConnectNetwork),f.KiiServerCodeEntry=function(){function t(t,e,i){this.entryName=t,this.version=e,this.environmentVersion=i}return t.prototype.execute=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){var t;return null!=e&&e.failure.apply(e,arguments),t=l._Error(arguments[3],i),t.argument=arguments[1],r(t)}},i._executeUsingCallbacks(t,s)}}(this))},t.prototype._executeUsingCallbacks=function(t,e){var i,n,r,s,o,u,a,c;return l._validateServerCodeEntryArgument(t)?(n=null!=t?t:{},o=null!=(c=this.version)?c:"current",i=JSON.stringify(n),s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/server-code/versions/"+o+"/"+this.entryName),this.environmentVersion&&(s+="?environment-version="+this.environmentVersion),u=h.createXHRWrapper("POST",s),a=u.xhr,a.setRequestHeader("x-kii-appid",f.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/json"),null!=f.KiiUser.getCurrentUser()&&a.setRequestHeader("Authorization","Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),r={success:function(i){return function(){var n,r,s,o,u;u=a.getResponseHeader("x-step-count"),n=a.getResponseHeader("x-environment-version");try{if(o=JSON.parse(a.responseText),s=new f.KiiServerCodeExecResult(o,u,n),null!=e)return e.success(i,t,s)}catch(l){if(null!=e)return r="fail to parse response. statusCode: "+a.status+" executedSteps: "+u+" error code: failed_to_parse_response response: "+a.responseText,
e.failure(i,t,null,r)}}}(this),failure:function(i){return function(){var n,r,s,o;o=a.getResponseHeader("x-step-count"),n={statusCode:a.status,executedSteps:o},r="fail to execute server code. statusCode: "+a.status+" executedSteps: "+o;try{if(s=JSON.parse(a.responseText),null!=s.errorCode&&(r+=" error code: "+s.errorCode),null!=s.message&&(r+=" message: "+s.message),null!=s.details&&null!=s.details.message)return r+=" detailMessage: "+s.details.message}catch(u){return r+=" error code: failed_to_parse_response message: "+a.responseText}finally{null!=e&&e.failure(i,t,null,r)}}}(this)},u.sendData(i,r)):e.failure(this,t,null,f.InvalidArgumentException("arugment is invalid"))},t.prototype.getEntryName=function(){return this.entryName},t}(),f.KiiServerCodeExecResult=function(){function t(t,e,i){this.returnObject=t,this.exeSteps=e,this.environmentVersion=i}return t.prototype.getExecutedSteps=function(){return this.exeSteps},t.prototype.getEnvironmentVersion=function(){return this.environmentVersion},t.prototype.getReturnedValue=function(){return this.returnObject},t}(),f.KiiThing=function(){function t(t){this.fields=t,this._getSubscriberPath=y(this._getSubscriberPath,this),this._setAuthToken=y(this._setAuthToken,this),this._getHttpURI=y(this._getHttpURI,this),this.pushSubscription=y(this.pushSubscription,this),this._listTopicsUsingCallbacks=y(this._listTopicsUsingCallbacks,this),this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this.encryptedBucketWithName=y(this.encryptedBucketWithName,this),this.bucketWithName=y(this.bucketWithName,this),this.updatePassword=y(this.updatePassword,this),this._changeStatus=y(this._changeStatus,this),this.enable=y(this.enable,this),this.disable=y(this.disable,this),this.unregisterOwner=y(this.unregisterOwner,this),this._getOwnerURL=y(this._getOwnerURL,this),this.registerOwnerWithPassword=y(this.registerOwnerWithPassword,this),this.registerOwner=y(this.registerOwner,this),this.isOwner=y(this.isOwner,this),this.deleteThing=y(this.deleteThing,this),this.update=y(this.update,this),this._refresh=y(this._refresh,this),this.refresh=y(this.refresh,this),this.getOnlineStatusModifiedAt=y(this.getOnlineStatusModifiedAt,this),this.isOnline=y(this.isOnline,this),this.getDisabled=y(this.getDisabled,this),this.getCreated=y(this.getCreated,this),this.getAccessToken=y(this.getAccessToken,this),this.getVendorThingID=y(this.getVendorThingID,this),this.getThingID=y(this.getThingID,this),this._renewThingFields=y(this._renewThingFields,this),null!=this.fields&&this._renewThingFields(this.fields)}return t.prototype._renewThingFields=function(t){return this._online=null,this._onlineStatusModifiedAt=null,this.fields=t,this._thingID=t._thingID,this._vendorThingID=t._vendorThingID,this._accessToken=t._accessToken,this._created=new Date(t._created),this._disabled=t._disabled,null!=t._online&&(this._online=t._online),null!=t._onlineStatusModifiedAt&&(this._onlineStatusModifiedAt=new Date(t._onlineStatusModifiedAt)),delete this.fields._thingID,delete this.fields._vendorThingID,delete this.fields._accessToken,delete this.fields._created,delete this.fields._disabled},t.prototype.getThingID=function(){return this._thingID},t.prototype.getVendorThingID=function(){return this._vendorThingID},t.prototype.getAccessToken=function(){return this._accessToken},t.prototype.getCreated=function(){return this._created},t.prototype.getDisabled=function(){return this._disabled},t.prototype.isOnline=function(){return this._online},t.prototype.getOnlineStatusModifiedAt=function(){return this._onlineStatusModifiedAt},t.register=function(t,e){return new Promise(function(i,n){var r,s;return s=h.createXHRWrapper("POST",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things"),s.setKiiHeaders(),s.setContentType("application/vnd.kii.ThingRegistrationAndAuthorizationRequest+json"),r={success:function(){var t,n;return t=JSON.parse(decodeURIComponent(s.xhr.responseText)),n=new f.KiiThing(t),null!=e&&e.success(n),i(n)},failure:function(){var t,i;return i=s.getErrorString("register thing"),t=l._Error(i),null!=e&&e.failure(t),n(t)}},s.sendData(JSON.stringify(t),r)})},t.executeQuery=function(t,e){return new Promise(function(i,n){var r,s,o;return null==t?(r=l._Error("thingQuery is null"),null!=e&&e.failure(r),void n(r)):(o=h.createXHRWrapper("POST",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/query"),o.setKiiHeaders(),o.setCurrentUserToken(),o.setContentType("application/vnd.kii.ThingQueryRequest+json"),s={success:function(){var n,r,s,u,a,l,c;for(r=JSON.parse(decodeURIComponent(o.xhr.responseText)),u=[],c=r.results,a=0,l=c.length;l>a;a++)s=c[a],u.push(new f.KiiThing(s));return n=new f.KiiThingQueryResult(t,u,r.nextPaginationKey),null!=e&&e.success(n),i(n)},failure:function(){var t;return t=o.getErrorString("query thing"),r=l._Error(t),null!=e&&e.failure(r),n(r)}},o.sendData(JSON.stringify(t._dictValue()),s))})},t.prototype.refresh=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(n){return e._renewThingFields(n),null!=t&&t.success(e),i(e)},failure:function(i){var r;return r=l._Error(i,e),null!=t&&t.failure(r),n(r)}},e._refresh(r)}}(this))},t.prototype._refresh=function(t){var e,i,n;return e=null!=this._thingID?this._thingID:"VENDOR_THING_ID:"+this._vendorThingID,n=h.createXHRWrapper("GET",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e),n.setKiiHeaders(),this._setAuthToken(n),i={success:function(e){return function(){var e;return e=JSON.parse(decodeURIComponent(n.xhr.responseText)),t.success(e)}}(this),failure:function(e){return function(){var e;return e=n.getErrorString("refresh thing"),t.failure(e)}}(this)},n.send(i)},t.prototype.update=function(t){return new Promise(function(e){return function(i,n){var r;return r={success:function(r){var s,o,u,a,c;c=e.fields;for(s in c)u=c[s],r[s]=u;return e.fields=r,a=h.createXHRWrapper("PATCH",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e._thingID),a.setKiiHeaders(),a.setContentType("application/vnd.kii.ThingUpdateRequest+json"),e._setAuthToken(a),o={success:function(){return null!=t&&t.success(e),i(e)},failure:function(){var i,r;return r=a.getErrorString("update thing"),i=l._Error(r,e),null!=t&&t.failure(i),n(i)}},a.sendData(JSON.stringify(e.fields),o),"function"==typeof e._testOnUpdateRequest?e._testOnUpdateRequest():void 0},failure:function(i){var r;return r=l._Error(i,e),null!=t&&t.failure(r),n(r)}},e._refresh(r)}}(this))},t.prototype.deleteThing=function(t){return new Promise(function(e){return function(i,n){var r,s;return s=h.createXHRWrapper("DELETE",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e._thingID),s.setKiiHeaders(),e._setAuthToken(s),r={success:function(){return null!=t&&t.success(e),i(e)},failure:function(){var i,r;return r=s.getErrorString("delete thing"),i=l._Error(r,e),null!=t&&t.failure(i),n(i)}},s.send(r)}}(this))},t.prototype.isOwner=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u,a,c;try{u=i._getOwnerURL(i._thingID,t)}catch(p){return o=p,s=l._Error(o,i),null!=e&&e.failure(s),void r(s)}return c=h.createXHRWrapper("HEAD",u),c.setKiiHeaders(),i._setAuthToken(c),a={success:function(){return null!=e&&e.success(i,t,!0),n([i,t,!0])},failure:function(){var o;return 404===c.xhr.status?(null!=e&&e.success(i,t,!1),void n([i,t,!1])):(o=c.getErrorString("register owner"),s=l._Error(o,i),null!=e&&e.failure(s),r(s))}},c.send(a)}}(this))},t.prototype.registerOwner=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u,a,c;try{u=i._getOwnerURL(i._thingID,t)}catch(p){return o=p,s=l._Error(o,i),null!=e&&e.failure(s),void r(s)}return c=h.createXHRWrapper("PUT",u),c.setKiiHeaders(),i._setAuthToken(c),a={success:function(){return null!=e&&e.success(i,t),n([i,t])},failure:function(){var t;return t=c.getErrorString("register owner"),s=l._Error(t,i),null!=e&&e.failure(s),r(s)}},c.send(a)}}(this))},t.prototype.registerOwnerWithPassword=function(t,e,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success(n,t),r([n,t])},failure:function(t){return null!=i&&i.failure(t),s(t)}},f.KiiThing._registerOwnerWithIdentifierAndPassword(n._thingID,t,e,o)}}(this))},t.registerOwnerWithThingID=function(t,e,i){return f.KiiThing._registerOwnerWithIdentifier(t,e,i)},t.registerOwnerWithThingIDAndPassword=function(t,e,i,n){return f.KiiThing._registerOwnerWithIdentifierAndPassword(t,e,i,n)},t.registerOwnerWithVendorThingID=function(t,e,i){return l._isNonEmptyString(t)?f.KiiThing._registerOwnerWithIdentifier("VENDOR_THING_ID:"+t,e,i):f.KiiThing._registerOwnerWithIdentifier(null,e,i)},t.registerOwnerWithVendorThingIDAndPassword=function(t,e,i,n){return l._isNonEmptyString(t)?f.KiiThing._registerOwnerWithIdentifierAndPassword("VENDOR_THING_ID:"+t,e,i,n):f.KiiThing._registerOwnerWithIdentifierAndPassword(null,e,i,n)},t._registerOwnerWithIdentifier=function(t,e,i){return new Promise(function(n,r){var s,o,u,a,c;if(!l._isNonEmptyString(t))return s=l._Error("identifier is null or empty"),null!=i&&i.failure(s),void r(s);if(null==e)return s=l._Error("owner is null"),null!=i&&i.failure(s),void r(s);try{u=f.KiiThing.prototype._getOwnerURL(t,e)}catch(p){return o=p,s=l._Error(o),null!=i&&i.failure(s),void r(s)}return c=h.createXHRWrapper("PUT",u),c.setKiiHeaders(),f.KiiThing.prototype._setAuthToken(c),a={success:function(){return null!=i&&i.success(e),n([e])},failure:function(){var t;return t=c.getErrorString("register owner"),s=l._Error(t),null!=i&&i.failure(s),r(s)}},c.send(a)})},t._registerOwnerWithIdentifierAndPassword=function(t,e,i,n){return new Promise(function(r,s){var o,u,a,c,p;if(!l._isNonEmptyString(t))return o=l._Error("identifier is null or empty"),null!=n&&n.failure(o),void s(o);if(null==e)return o=l._Error("owner is null"),null!=n&&n.failure(o),void s(o);if(!l._isNonEmptyString(i))return o=l._Error("password is null or empty"),null!=n&&n.failure(o),void s(o);if(c=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t+"/ownership",p=h.createXHRWrapper("POST",c),p.setKiiHeaders(),p.setContentType("application/vnd.kii.ThingOwnershipRequest+json"),f.KiiThing.prototype._setAuthToken(p),u={thingPassword:i},e instanceof f.KiiUser)u.userID=e.getID();else{if(!(e instanceof f.KiiGroup))return o=l._Error("owner should be instance of KiiUser or KiiGroup"),null!=n&&n.failure(o),void s(o);u.groupID=e.getID()}return a={success:function(){return null!=n&&n.success(e),r(e)},failure:function(){var t;return t=p.getErrorString("register owner"),o=l._Error(t),null!=n&&n.failure(o),s(o)}},p.sendData(JSON.stringify(u),a)})},t.prototype._getOwnerURL=function(t,e){var i,n;if(e instanceof f.KiiUser)i=e.getID(),n="user";else{if(!(e instanceof f.KiiGroup))throw"owner should be instance of user or group";i=e.getID(),n="group"}if(null==i)throw"owner instance does not have id";return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t+"/ownership/"+n+":"+i},t.prototype.unregisterOwner=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u,a,c;try{u=i._getOwnerURL(i._thingID,t)}catch(p){return o=p,s=l._Error(o,i),null!=e&&e.failure(s),void r(s)}return c=h.createXHRWrapper("DELETE",u),c.setKiiHeaders(),i._setAuthToken(c),a={success:function(){return null!=e&&e.success(i,t),n([i,t])},failure:function(){var t;return t=c.getErrorString("unregister owner"),s=l._Error(t,i),null!=e&&e.failure(s),r(s)}},c.send(a)}}(this))},t.prototype.disable=function(t){return this._changeStatus(!0,t)},t.prototype.enable=function(t){return this._changeStatus(!1,t)},t.prototype._changeStatus=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u;return u=h.createXHRWrapper("PUT",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+i._thingID+"/status"),u.setKiiHeaders(),i._setAuthToken(u),u.setContentType("application/vnd.kii.ThingStatusUpdateRequest+json"),o={success:function(){return i._disabled=t,null!=e&&e.success(i),n(i)},failure:function(){var n,s;return s=u.getErrorString("disable thing "+t),n=l._Error(s,i),null!=e&&e.failure(n),r(n)}},s={disabled:t},u.sendData(JSON.stringify(s),o)}}(this))},t.prototype.updatePassword=function(t,e){var i;return i=l._Error("updatePassword can be used only by app admin."),null!=e&&e.failure(i),Promise.reject(i)},t.loadWithVendorThingID=function(t,e){var i;return i="VENDOR_THING_ID:"+t,f.KiiThing._load(i,e)},t.loadWithThingID=function(t,e){return f.KiiThing._load(t,e)},t._load=function(t,e){return new Promise(function(i,n){var r,s;return s=h.createXHRWrapper("GET",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t),s.setKiiHeaders(),f.KiiThing.prototype._setAuthToken(s),r={success:function(){var t,n;return t=JSON.parse(decodeURIComponent(s.xhr.responseText)),n=new f.KiiThing(t),null!=e&&e.success(n),i(n)},failure:function(){var t,i;return i=s.getErrorString("load thing"),t=l._Error(i),null!=e&&e.failure(t),n(t)}},s.send(r)})},t.prototype.bucketWithName=function(t){return new f.KiiBucket._bucketWithName(t,this)},t.prototype.encryptedBucketWithName=function(t){return new f.KiiEncryptedBucket(t,this)},t.prototype.topicWithName=function(t){if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopic(this._getHttpURI(),t)},t.prototype.listTopics=function(t,e){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,e)}}(this))},t.prototype._listTopicsUsingCallbacks=function(t,e){var i,n,r;return n=""+this._getHttpURI()+"/topics","string"==typeof e&&""!==e&&(n=n+"?paginationKey="+encodeURIComponent(e)),r=h.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(e){return function(){var i,n,s,o,u,a;for(i=JSON.parse(r.xhr.responseText),s=[],a=i.topics,o=0,u=a.length;u>o;o++)n=a[o],s.push(e.topicWithName(n.topicID));return null!=t?t.success(s,void 0===i.paginationKey?null:i.paginationKey):void 0}}(this),failure:function(e){return function(){var i,n;return n=r.getErrorString("list topics"),i=l._Error(n,e),null!=t?t.failure(i):void 0}}(this)},r.send(i)},t.prototype.pushSubscription=function(){return new f.KiiPushSubscription(this)},t.prototype._getHttpURI=function(){return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+this.getThingID()},t.thingWithID=function(t){var e;if(null==t||""===t)throw new f.InvalidArgumentException("thingID should not null or empty");return e=new f.KiiThing,e._thingID=t,e},t.prototype._setAuthToken=function(t){return t.setCurrentUserToken()},t.prototype._getSubscriberPath=function(){return"things/"+this.getThingID()},t}(),f.KiiTopic=function(){function t(t,e){this._getHttpUri=y(this._getHttpUri,this),this._setAuthToken=y(this._setAuthToken,this),this.acl=y(this.acl,this),this.deleteTopic=y(this.deleteTopic,this),this.sendMessage=y(this.sendMessage,this),this.save=y(this.save,this),this.exists=y(this.exists,this),this.getName=y(this.getName,this),this._uri=""+t+"/topics/"+e,this._name=e}return t.prototype.getName=function(){return this._name},t.prototype.exists=function(t){return new Promise(function(e){return function(i,n){var r,s;return s=h.createXHRWrapper("HEAD",e._uri),s.setKiiHeaders(),e._setAuthToken(s),r={success:function(){return null!=t&&t.success(!0),i(!0)},failure:function(){var r,o;return 404===s.xhr.status?(null!=t&&t.success(!1),void i(!1)):(o=s.getErrorString("check topic"),r=l._Error(o,e),null!=t&&t.failure(r),n(r))}},s.send(r)}}(this))},t.prototype.save=function(t){return new Promise(function(e){return function(i,n){var r,s;return s=h.createXHRWrapper("PUT",e._uri),s.setKiiHeaders(),e._setAuthToken(s),r={success:function(){return null!=t&&t.success(e),i(e)},failure:function(){var i,r;return r=s.getErrorString("save topic"),i=l._Error(r,e),null!=t&&t.failure(i),n(i)}},s.send(r)}}(this))},t.prototype.sendMessage=function(t,e){return new Promise(function(i){return function(n,r){var s,o;return o=h.createXHRWrapper("POST",""+i._uri+"/push/messages"),o.setKiiHeaders(),i._setAuthToken(o),o.setContentType("application/vnd.kii.SendPushMessageRequest+json"),s={success:function(){return null!=e&&e.success(i,t),n([i,t])},failure:function(){var t,n;return n=o.getErrorString("send messages"),t=l._Error(n,i),null!=e&&e.failure(t),r(t)}},o.sendData(JSON.stringify(t),s)}}(this))},t.prototype.deleteTopic=function(t){return new Promise(function(e){return function(i,n){var r,s;return s=h.createXHRWrapper("DELETE",e._uri),s.setKiiHeaders(),e._setAuthToken(s),r={success:function(){return null!=t&&t.success(e),i(e)},failure:function(){var i,r;return r=s.getErrorString("delete topic"),i=l._Error(r,e),null!=t&&t.failure(i),n(i)}},s.send(r)}}(this))},t.prototype.acl=function(){return f.KiiACL.aclWithParent(this)},t.prototype._setAuthToken=function(t){return t.setCurrentUserToken()},t.prototype._getHttpUri=function(){return this._uri},t}(),f.KiiPushMessageBuilder=function(){function t(t){this.data=t,this.mqttData=y(this.mqttData,this),this.jpushData=y(this.jpushData,this),this.apnsMutableContent=y(this.apnsMutableContent,this),this.apnsCategory=y(this.apnsCategory,this),this.apnsContentAvailable=y(this.apnsContentAvailable,this),this.apnsBadge=y(this.apnsBadge,this),this.apnsSound=y(this.apnsSound,this),this.apnsAlert=y(this.apnsAlert,this),this.apnsData=y(this.apnsData,this),this.gcmRestrictedPackageName=y(this.gcmRestrictedPackageName,this),this.gcmTimeToLive=y(this.gcmTimeToLive,this),this.gcmDelayWhileIdle=y(this.gcmDelayWhileIdle,this),this.gcmCollapseKey=y(this.gcmCollapseKey,this),this.gcmData=y(this.gcmData,this),this.enableMqtt=y(this.enableMqtt,this),this.enableJpush=y(this.enableJpush,this),this.enableApns=y(this.enableApns,this),this.enableGcm=y(this.enableGcm,this),this.setSendToProduction=y(this.setSendToProduction,this),this.setSendToDevelopment=y(this.setSendToDevelopment,this),this.build=y(this.build,this),this.gcm={},this.apns={},this.jpush={},this.mqtt={},this.gcm.enabled=!0,this.apns.enabled=!0,this.jpush.enabled=!0,this.mqtt.enabled=!0}return t.prototype.build=function(){var t;return t={},t.data=this.data,t.gcm=this.gcm,t.apns=this.apns,t.jpush=this.jpush,t.mqtt=this.mqtt,null!=this.sendToDevelopment&&(t.sendToDevelopment=this.sendToDevelopment),null!=this.sendToProduction&&(t.sendToProduction=this.sendToProduction),t},t.prototype.setSendToDevelopment=function(t){return this.sendToDevelopment=t,this},t.prototype.setSendToProduction=function(t){return this.sendToProduction=t,this},t.prototype.enableGcm=function(t){return this.gcm.enabled=t,this},t.prototype.enableApns=function(t){return this.apns.enabled=t,this},t.prototype.enableJpush=function(t){return this.jpush.enabled=t,this},t.prototype.enableMqtt=function(t){return this.mqtt.enabled=t,this},t.prototype.gcmData=function(t){return this.gcm.data=t,this},t.prototype.gcmCollapseKey=function(t){return this.gcm.collapseKey=t,this},t.prototype.gcmDelayWhileIdle=function(t){return this.gcm.delayWhileIdle=t,this},t.prototype.gcmTimeToLive=function(t){return this.gcm.timeToLive=t,this},t.prototype.gcmRestrictedPackageName=function(t){return this.gcm.restrictedPackageName=t,this},t.prototype.apnsData=function(t){return this.apns.data=t,this},t.prototype.apnsAlert=function(t){return this.apns.alert=t,this},t.prototype.apnsSound=function(t){return this.apns.sound=t,this},t.prototype.apnsBadge=function(t){return this.apns.badge=t,this},t.prototype.apnsContentAvailable=function(t){return t>0?this.apns.contentAvailable=!0:delete this.apns.contentAvailable,this},t.prototype.apnsCategory=function(t){return this.apns.category=t,this},t.prototype.apnsMutableContent=function(t){return t>0?this.apns.mutableContent=!0:delete this.apns.mutableContent,this},t.prototype.jpushData=function(t){return this.jpush.data=t,this},t.prototype.mqttData=function(t){return this.mqtt.data=t,this},t}(),f.KiiPushSubscription=function(){function t(t){this._subscriber=t,this._setAuthToken=y(this._setAuthToken,this),this._getRequestHTTPURI=y(this._getRequestHTTPURI,this),this._validateTarget=y(this._validateTarget,this),this.isSubscribed=y(this.isSubscribed,this),this.unsubscribe=y(this.unsubscribe,this),this.subscribe=y(this.subscribe,this)}return t.prototype.getSubscriber=function(){return this._subscriber},t.prototype.subscribe=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u;return i._validateTarget(t)?(s=i._getRequestHTTPURI(t),u=h.createXHRWrapper("PUT",s),u.setKiiHeaders(),i._setAuthToken(u),o={success:function(){return null!=e&&e.success(i,t),n([i,t])},failure:function(){var t,n;return n=u.getErrorString("subscribe"),t=l._Error(n,i),null!=e&&e.failure(t),r(t)}},u.send(o)):(null!=e&&e.failure(f.InvalidArgumentException("target is invalid")),void r(l._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},t.prototype.unsubscribe=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u;return i._validateTarget(t)?(s=i._getRequestHTTPURI(t),u=h.createXHRWrapper("DELETE",s),u.setKiiHeaders(),i._setAuthToken(u),o={success:function(){return null!=e&&e.success(i,t),n([i,t])},failure:function(){var t,n;return n=u.getErrorString("unsubscribe"),t=l._Error(n,i),null!=e&&e.failure(t),r(t)}},u.send(o)):(null!=e&&e.failure(f.InvalidArgumentException("target is invalid")),void r(l._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},t.prototype.isSubscribed=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u;return i._validateTarget(t)?(s=i._getRequestHTTPURI(t),u=h.createXHRWrapper("GET",s),u.setKiiHeaders(),i._setAuthToken(u),o={success:function(){return null!=e&&e.success(i,t,!0),n([i,t,!0])},failure:function(){var s,o,a;return a=u.getErrorCode(),"FILTER_NOT_FOUND"===a||"PUSH_SUBSCRIPTION_NOT_FOUND"===a?(null!=e&&e.success(i,t,!1),n([i,t,!1])):(o=u.getErrorString("Check is subscribed"),s=l._Error(o,i),null!=e&&e.failure(s),r(s))}},u.send(o)):(null!=e&&e.failure(f.InvalidArgumentException("target is invalid")),void r(l._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},t.prototype._validateTarget=function(t){return null!=t&&(t instanceof f.KiiBucket||t instanceof f.KiiTopic)},t.prototype._getRequestHTTPURI=function(t){var e;return t instanceof f.KiiBucket?e=""+t._getHttpUri()+"/filters/all/push/subscriptions/"+this._subscriber._getSubscriberPath():t instanceof f.KiiTopic?e=""+t._getHttpUri()+"/push/subscriptions/"+this._subscriber._getSubscriberPath():void 0},t.prototype._setAuthToken=function(t){return t.setCurrentUserToken()},t}(),f.KiiThingWithToken=function(t){function e(t,i,n,r){this._adminToken=r,this._getIdentifier=y(this._getIdentifier,this),this.updatePassword=y(this.updatePassword,this),this.topicWithName=y(this.topicWithName,this),this.bucketWithName=y(this.bucketWithName,this),this.pushSubscription=y(this.pushSubscription,this),this._setAuthToken=y(this._setAuthToken,this),e.__super__.constructor.call(this,t),null!=i&&(this._thingID=i),null!=n&&(this._vendorThingID=n)}return k(e,t),e.register=function(t,e,i){return new Promise(function(n,r){var s,o;return o=h.createXHRWrapper("POST",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things"),o.setKiiHeaders(),o.setContentType("application/vnd.kii.ThingRegistrationAndAuthorizationRequest+json"),o.setAuthToken(i),s={success:function(){var t,r;return t=JSON.parse(decodeURIComponent(o.xhr.responseText)),r=new f.KiiThingWithToken(t,null,null,i),null!=e&&e.success(r),n(r)},failure:function(){var t,i;return i=o.getErrorString("register thing"),t=l._Error(i),null!=e&&e.failure(t),r(t)}},o.sendData(JSON.stringify(t),s)})},e.registerOwnerWithThingID=function(t,e,i,n){return f.KiiThingWithToken._registerOwnerWithIdentifier(t,e,i,n)},e.registerOwnerWithVendorThingID=function(t,e,i,n){return f.KiiThingWithToken._registerOwnerWithIdentifier("VENDOR_THING_ID:"+t,e,i,n)},e._registerOwnerWithIdentifier=function(t,e,i,n){return new Promise(function(r,s){var o,u,a,c;if(e instanceof f.KiiUser)o=e.getID(),a="user";else{if(!(e instanceof f.KiiGroup))throw"owner should be instance of user or group";o=e.getID(),a="group"}if(null==o)throw"owner instance does not have id";return c=h.createXHRWrapper("PUT",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t+"/ownership/"+a+":"+o),c.setKiiHeaders(),c.setAuthToken(n),u={success:function(){return null!=i&&i.success(e),r([e])},failure:function(){var t,e;return e=c.getErrorString("register owner"),t=l._Error(e),null!=i&&i.failure(t),s(t)}},c.send(u)})},e.loadWithVendorThingID=function(t,e,i){var n;return n=new f.KiiThingWithToken(null,null,t,i),n.refresh(e)},e.loadWithThingID=function(t,e,i){var n;return n=new f.KiiThingWithToken(null,t,null,i),n.refresh(e)},e.prototype._setAuthToken=function(t){return t.setAuthToken(this._adminToken)},e.prototype.pushSubscription=function(){return new f.KiiPushSubscriptionWithToken(this,this._adminToken)},e.prototype.bucketWithName=function(t){return new f.KiiBucketWithToken(t,this,this._adminToken)},e.prototype.encryptedBucketWithName=function(t){return new f.KiiEncryptedBucketWithToken(t,this,this._adminToken)},e.prototype.topicWithName=function(t){if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopicWithToken(this._getHttpURI(),t,this._adminToken)},e.prototype.updatePassword=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u,a;return l._isNonEmptyString(t)?(o={newPassword:t},a=h.createXHRWrapper("PUT",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+i._getIdentifier()+"/password"),a.setKiiHeaders(),a.setAuthToken(i._adminToken),a.setContentType("application/vnd.kii.ChangeThingPasswordRequest+json"),u={success:function(){return null!=e&&e.success(i),n(i)},failure:function(){var t;return t=a.getErrorString("changing thing password"),s=l._Error(t),null!=e&&e.failure(s),r(s)}},a.sendData(JSON.stringify(o),u)):(s=l._Error("newPassword is null or empty"),null!=e&&e.failure(s),void r(s))}}(this))},e.prototype._getIdentifier=function(){return null!=this._thingID?this._thingID:null!=this._vendorThingID?"VENDOR_THING_ID:"+this._vendorThingID:null},e.thingWithID=function(t,e){var i;return i=new f.KiiThingWithToken(null,t,null,e)},e}(f.KiiThing),f.KiiTopicWithToken=function(t){function e(t,i,n){this._authToken=n,this.acl=y(this.acl,this),this._setAuthToken=y(this._setAuthToken,this),e.__super__.constructor.call(this,t,i)}return k(e,t),e.prototype._setAuthToken=function(t){return t.setAuthToken(this._authToken)},e.prototype.acl=function(){return new f.KiiACLWithToken(this,this._authToken)},e}(f.KiiTopic),f.KiiPushSubscriptionWithToken=function(t){function e(t,i){this._authToken=i,this._setAuthToken=y(this._setAuthToken,this),e.__super__.constructor.call(this,t)}return k(e,t),e.prototype._setAuthToken=function(t){return t.setAuthToken(this._authToken)},e}(f.KiiPushSubscription),f.KiiAnalyticsSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api",SG:"https://api-sg.kii.com/api",CN3:"https://api-cn3.kii.com/api"},f.KiiAnalytics=function(){function t(){}var e;return e=null,t.getBaseURL=function(){return e._baseURL},t.getAppID=function(){return e._appID},t.getAppKey=function(){return e._appKey},t.getAppKey=function(){return e._appKey},t.getDeviceId=function(){return e._deviceId},t.isLogging=function(){return e._logging},t.setLogging=function(t){return f.KiiAnalytics.logger("Setting logging: "+t),e._logging=t},t.initializeWithSite=function(t,e,i,n){return f.KiiAnalytics._initializeWithSite(t,e,i,n)},t.initialize=function(t,e,i){return f.KiiAnalytics._initializeWithSite(t,e,f.KiiAnalyticsSite.US,i)},t._initializeWithSite=function(t,i,n,r){return e=new _(t,i,n,r),(null!=r?r.length:void 0)>0&&e._deviceId!==r&&(e._deviceId=r),f.KiiAnalytics.logger("Initialized "+t+", "+i+", "+n)},t.error=function(t){return console.log("KiiAnalytics SDK Error => "+t)},t.logger=function(t){return e._logging?console.log("KiiAnalytics => "+t):void 0},t.trackEvent=function(t){return f.KiiAnalytics.trackEventWithExtras(t,null)},t.trackEventWithExtras=function(t,e){return f.KiiAnalytics.trackEventWithExtrasAndCallbacks(t,e,null)},t.trackEventWithExtrasAndCallbacks=function(e,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success(),r()},failure:function(){return null!=n&&n.failure.apply(n,arguments),s(l._Error(arguments[0]))}},t._trackEventWithExtrasAndCallbacks(e,i,o)})},t._trackEventWithExtrasAndCallbacks=function(i,r,s){var o,u,a,l,c,h,p,g,_,d,y;h=Math.round((new Date).getTime()),c="^[a-zA-Z][a-zA-Z0-9_]{0,63}$",f.KiiAnalytics.logger("deviceId = "+e._deviceId),p={_triggeredAt:h,_uploadedAt:h,_deviceID:e._deviceId,_type:i},u=function(t){return null!=t&&null!=t.match(c)},o=function(t){var e,i,n,r;for(n=0,r=t.length;r>n;n++){if(i=t[n],e=typeof i,"string"!==e&&"boolean"!==e&&"number"!==e)return!1;if("string"===e){if(i.length<=0)return!1}else if("number"===e&&(!isFinite(i)||isNaN(i)))return!1}return!0},a=function(t){var e;return e=typeof t,"string"===e?t.length>0:"number"===e?isFinite(t)&&!isNaN(t):"object"===e?t instanceof Array&&t.length>0&&o(t):"boolean"===e};for(l in r)d=r[l],u(l)&&a(d)?p[l]=d:f.KiiAnalytics.logger("ignoring invalid key/value pair, key:"+l+" value:"+d);return _=""+t.getBaseURL()+"/apps/"+t.getAppID()+"/event",y=n.createXHRWrapper("POST",_),y.setKiiHeaders(),y.setContentType("application/vnd.kii.Event+json"),g={success:function(){return null!=s?s.success():void 0},failure:function(){var t;return t=y.getErrorString("track event"),null!=s?s.failure(t,y.xhr.status):void 0}},y.sendData(JSON.stringify(p),g)},t.setBaseURL=function(t){return f.KiiAnalytics.logger("Setting base URL: "+t),e._baseURL=t},t.getSDKVersion=function(){return f.Kii.getSDKVersion()},t._setHttpRequestType=function(t){return f.KiiAnalytics.logger("Set http request as "+t),e._httpRequestType=t},t._getHttpRequestType=function(){return e._httpRequestType},t}(),_=function(){function t(e,i,n,r){null==n&&(n=f.KiiAnalyticsSite.US),r||(r=t.generateDeviceId()),this._appKey=i,this._appID=e,this._baseURL=n,this._deviceId=r}return t.prototype._httpRequestType=null,t.generateDeviceId=function(){var t;return t=function(t){var e;return e=(Math.random().toString(16)+"000000000").substr(2,8),t?"-"+e.substr(0,4)+"-"+e.substr(4,4):e},t()+t(!0)+t(!0)+t()},t}(),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},e.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},e.prototype.getLogger=function(){return f.KiiAnalytics.logger()},e.prototype.getCurrentUser=function(){return null},e}(c),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},e.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},e.prototype.getLogger=function(){return f.KiiAnalytics.logger()},e.prototype.getCurrentUser=function(){return null},e}(r),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},e.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},e.prototype.getLogger=function(){return f.KiiAnalytics.logger()},e.prototype.getCurrentUser=function(){return null},e}(u),n=function(){function n(){}return n.createXHRWrapper=function(n,r){var s;return s=null,null===f.KiiAnalytics._getHttpRequestType()?"undefined"!=typeof jQuery?(f.KiiAnalytics.logger("Use jQuery"),s=new t(n,r)):"undefined"!=typeof XMLHttpRequest?(f.KiiAnalytics.logger("Use XMLHttpRequest"),s=new i(n,r)):"undefined"!=typeof Titanium&&(f.KiiAnalytics.logger("Use Titanium"),s=new e(n,r)):(f.KiiAnalytics.logger("Use http request backdoor"),f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.KiiAnalytics.logger("Use jQuery"),
s=new t(n,r)):f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),s=new i(n,r)):f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),s=new e(n,r))),s},n}(),f.KiiSCNGoogle=function(t){function e(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),e.__super__.constructor.call(this,f.KiiSocialNetworkName.GOOGLEPLUS)}return k(e,t),e.prototype._setup=function(t,i,n){return this._key=t,this._secret=i,this._extras=n,e.__super__._setup.call(this,this._key,this._secret,this._extras)},e.prototype._createTokenObject=function(t,e){var i;return i={access_token:t.access_token},null!=e&&null!=e.new_user_created&&(i.kii_new_user=e.new_user_created),i},e.prototype._getAccessToken=function(t){return t.access_token},e.prototype._logIn=function(t,e){var i;if(f.Kii.logger("should auth google"),f.Kii.logger("Checking options"),null==t||!t.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:t.access_token},this._register("google","application/vnd.kii.AuthTokenGoogleRequest+json",i,t,e)},e.prototype._logOut=function(){return e.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out google")},e.prototype._linkWithCurrentUser=function(t,e){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==t||!t.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:t.access_token},this._link("google","application/vnd.kii.LinkGoogleRequest+json",i,t,e)}return null!=e?e.failure(null,this._network,"A KiiUser must be logged in before linking to Google"):void 0},e.prototype._unlinkFromCurrentUser=function(t){return null!=f.KiiUser.getCurrentUser()?this._unlink("google",t):null!=t?t.failure("A KiiUser must be logged in before unlinking from Google"):void 0},e}(f.KiiSocialConnectNetwork),f.KiiSCNRenRen=function(t){function e(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),e.__super__.constructor.call(this,f.KiiSocialNetworkName.RENREN)}return k(e,t),e.prototype._setup=function(t,i,n){return this._key=t,this._secret=i,this._extras=n,e.__super__._setup.call(this,this._key,this._secret,this._extras)},e.prototype._createTokenObject=function(t,e){var i;return i={access_token:t.access_token},null!=e&&null!=e.new_user_created&&(i.kii_new_user=e.new_user_created),i},e.prototype._getAccessToken=function(t){return t.access_token},e.prototype._logIn=function(t,e){var i;if(f.Kii.logger("should auth renren"),f.Kii.logger("Checking options"),null==t||!t.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:t.access_token},this._register("renren","application/vnd.kii.AuthTokenRenRenRequest+json",i,t,e)},e.prototype._logOut=function(){return e.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out renren")},e.prototype._linkWithCurrentUser=function(t,e){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==t||!t.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:t.access_token},this._link("renren","application/vnd.kii.LinkRenRenRequest+json",i,t,e)}return null!=e?e.failure(null,this._network,"A KiiUser must be logged in before linking to RenRen"):void 0},e.prototype._unlinkFromCurrentUser=function(t){return null!=f.KiiUser.getCurrentUser()?this._unlink("renren",t):null!=t?t.failure("A KiiUser must be logged in before unlinking from RenRen"):void 0},e}(f.KiiSocialConnectNetwork),f.KiiThingContext=function(){function t(t){this._objectWithURI=y(this._objectWithURI,this),this._getToken=y(this._getToken,this),this.pushInstallation=y(this.pushInstallation,this),this.getAuthenticatedThing=y(this.getAuthenticatedThing,this),this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this._token=t.token,this._thingId=t.thingId,null!=t.vendorThingID&&(this._vendorThingID=t.vendorThingID)}return t.prototype.bucketWithName=function(t){var e;return e=new f.KiiBucketWithToken(t,null,this._token)},t.prototype.encryptedBucketWithName=function(t){var e;return e=new f.KiiEncryptedBucketWithToken(t,null,this._token)},t.prototype.objectWithURI=function(t){var e;return e=this._objectWithURI(t)},t.prototype.topicWithName=function(t){if("string"!=typeof t||""===t)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopicWithToken(""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID(),t,this._token)},t.prototype.listTopics=function(t,e){return f.Kii._listTopics(t,e,this)},t.prototype.getAuthenticatedThing=function(){var t;return t=f.KiiThingWithToken.thingWithID(this._thingId,this._token),t._accessToken=this._token,t._vendorThingID=this._vendorThingID,t},t.prototype.pushInstallation=function(){return new f.KiiPushInstallationWithToken(this._token)},t.prototype._getToken=function(){return this._token},t.prototype._objectWithURI=function(t){var e,i,n,r,s,o,u,a,l;if(!t)throw new f.InvalidURIException;if(l=0===t.indexOf("kiicloud://"),o=t.substr("kiicloud://".length),s=o.split("/"),r=s.length,!(r>=4&&l))throw new f.InvalidURIException;if(i=4===r?1:3,n=s[i],a=null,"groups"===s[0]&&6===r)a=new f.KiiGroupWithToken._groupWithID(s[1],this._token);else if("users"===s[0]&&6===r)a=f.KiiUserWithToken._userWithID(s[1],this._token);else if("things"===s[0]&&6===r)a=f.KiiThingWithToken.thingWithID(s[1],this._token);else if(4!==r)throw new f.InvalidURIException;return e=new f.KiiBucketWithToken(n,a,this._token),u=e.createObject(),u._setUUID(s[r-1]),u},t}(),f.KiiUserBuilder=function(){function t(){this._password=null,this._username=null,this._emailAddress=null,this._phoneNumber=null,this._country=null}return t.builderWithIdentifier=function(t,e){var i,n;if(null==t)throw new f.InvalidArgumentException("Identifier must not be null or undefined");if(!l._validatePassword(e))throw new f.InvalidPasswordException;if(i=new f.KiiUserBuilder,i._password=e,l._validatePhoneNumber(t))i._phoneNumber=t;else if(n=l._trim(t),l._validateEmail(n))i._emailAddress=n;else{if(!l._validateUsername(n))throw new f.InvalidArgumentException;i._username=n}return i},t.builderWithEmailAddress=function(t,e){var i;if(!l._validateEmail(t))throw new f.InvalidEmailException;if(!l._validatePassword(e))throw new f.InvalidPasswordException;return i=new f.KiiUserBuilder,i._emailAddress=l._trim(t),i._password=e,i},t.builderWithGlobalPhoneNumber=function(t,e){var i;if(!l._validatePhoneNumber(t))throw new f.InvalidPhoneNumberException;if(!l._isGlobalPhoneNumber(t))throw new f.InvalidPhoneNumberException;if(!l._validatePassword(e))throw new f.InvalidPasswordException;return i=new f.KiiUserBuilder,i._phoneNumber=t,i._password=e,i},t.builderWithLocalPhoneNumber=function(t,e,i){var n;if(!l._validateLocalPhone(t))throw new f.InvalidPhoneNumberException;if(!l._validateCountryCode(e))throw new f.InvalidCountryException;if(!l._validatePassword(i))throw new f.InvalidPasswordException;return n=new f.KiiUserBuilder,n._phoneNumber=t,n._country=e,n._password=i,n},t.builderWithUsername=function(t,e){var i,n;if(n=l._trim(t),!l._validateUsername(n))throw new f.InvalidUsernameException;if(!l._validatePassword(e))throw new f.InvalidPasswordException;return i=new f.KiiUserBuilder,i._username=n,i._password=e,i},t.prototype.setUsername=function(t){var e;if(null!=t){if(e=l._trim(t),!l._validateUsername(e))throw new f.InvalidUsernameException;this._username=e}return this},t.prototype.setEmailAddress=function(t){var e;if(null!=t){if(e=l._trim(t),!l._validateEmail(e))throw new f.InvalidEmailException;this._emailAddress=e}return this},t.prototype.setGlobalPhoneNumber=function(t){if(null!=t){if(!l._validatePhoneNumber(t))throw new f.InvalidPhoneNumberException;this._phoneNumber=t,this._country=null}return this},t.prototype.setLocalPhoneNumber=function(t,e){if(null!=t&&!l._validateLocalPhone(t))throw new f.InvalidPhoneNumberException;if(null!=e&&!l._validateCountryCode(e))throw new f.InvalidCountryException;return null!=t&&(this._phoneNumber=t),null!=e&&(this._country=e),this},t.prototype.build=function(){var t;return t=new f.KiiUser,null!=this._username&&t._setUsername(this._username),null!=this._emailAddress&&t._setEmailAddress(this._emailAddress),null!=this._country?t._setLocalPhone(this._phoneNumber,this._country):null!=this._phoneNumber&&t._setPhoneNumber(this._phoneNumber),t._setPassword(this._password),t},t}(),f.KiiPushInstallation=function(){function t(t){this._setAuthToken=y(this._setAuthToken,this),this.uninstallByInstallationID=y(this.uninstallByInstallationID,this),this.uninstall=y(this.uninstall,this),this._getMqttEndpoint=y(this._getMqttEndpoint,this),this.getMqttEndpoint=y(this.getMqttEndpoint,this),this._install=y(this._install,this),this.installMqtt=y(this.installMqtt,this),this.installApns=y(this.installApns,this),this.installGcm=y(this.installGcm,this),this._user=t}return t.prototype.installGcm=function(t,e,i){return l._isNonEmptyString(t)?this._install(t,"ANDROID",e,i):new Promise(function(t){return function(e,n){var r;return r=l._Error("installationRegistrationID must not be null or empty.",t),null!=i&&i.failure(r),n(r)}}(this))},t.prototype.installApns=function(t,e,i){return l._isNonEmptyString(t)?this._install(t,"IOS",e,i):new Promise(function(t){return function(e,n){var r;return r=l._Error("deviceToken must not be null or empty.",t),null!=i&&i.failure(r),n(r)}}(this))},t.prototype.installMqtt=function(t,e){return this._install(null,"MQTT",t,e)},t.prototype._install=function(t,e,i,n){return new Promise(function(r){return function(s,o){var u,a,c,p;return"boolean"!=typeof i&&(u=l._Error("type of development must be boolean.",r),null!=n&&n.failure(u),o(u)),p=h.createXHRWrapper("POST",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/installations"),p.setKiiHeaders(),r._setAuthToken(p),p.setContentType("application/vnd.kii.InstallationCreationRequest+json"),a={deviceType:e,development:i},null!=t&&(a.installationRegistrationID=t),c={success:function(){var t;return t=JSON.parse(decodeURIComponent(p.xhr.responseText)),null!=n&&n.success(t),s(t)},failure:function(){var t;return t=p.getErrorString("install push"),u=l._Error(t,r),null!=n&&n.failure(u),o(u)}},p.sendData(JSON.stringify(a),c)}}(this))},t.prototype.getMqttEndpoint=function(t,e){return new Promise(function(i){return function(n,r){var s,o;return l._isNonEmptyString(t)||(s=l._Error("installationID must not be null or empty.",i),null!=e&&e.failure(s),r(s)),o={success:function(t){return null!=e&&e.success(t),n(t)},failure:function(t){return null!=e&&e.failure(t),r(t)}},i._getMqttEndpoint(t,3,o)}}(this))},t.prototype._getMqttEndpoint=function(t,e,i){var n,r,s;return n=this,s=h.createXHRWrapper("GET",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/installations/"+t+"/mqtt-endpoint"),s.setKiiHeaders(),this._setAuthToken(s),r={success:function(t){return function(){var t;return t=JSON.parse(decodeURIComponent(s.xhr.responseText)),i.success(t)}}(this),failure:function(r){return function(){var r,o;return 503===s.xhr.status?(e--,0>=e?(o=s.getErrorString("get mqtt endpoint"),r=l._Error(o,n),i.failure(r)):setTimeout(function(){return n._getMqttEndpoint(t,e,i)},1e3)):(o=s.getErrorString("get mqtt endpoint"),r=l._Error(o,n),i.failure(r))}}(this)},s.send(r)},t.prototype.uninstall=function(t,e,i){return new Promise(function(n){return function(r,s){var o,u,a;return l._isNonEmptyString(t)||(o=l._Error("installationRegistrationID must not be null or empty.",n),null!=i&&i.failure(o),s(o)),f.KiiPushInstallation._validateDeviceType(e)||(o=l._Error("Unsupported deviceType "+e,n),null!=i&&i.failure(o),s(o)),a=h.createXHRWrapper("DELETE",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/installations/"+e+":"+t),a.setKiiHeaders(),n._setAuthToken(a),u={success:function(){return null!=i&&i.success(),r()},failure:function(){var t;return t=a.getErrorString("uninstall push"),o=l._Error(t,n),null!=i&&i.failure(o),s(o)}},a.send(u)}}(this))},t.prototype.uninstallByInstallationID=function(t,e){return new Promise(function(i){return function(n,r){var s,o,u;return l._isNonEmptyString(t)||(s=l._Error("installationID must not be null or empty.",i),null!=e&&e.failure(s),r(s)),u=h.createXHRWrapper("DELETE",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/installations/"+t),u.setKiiHeaders(),i._setAuthToken(u),o={success:function(){return null!=e&&e.success(),n()},failure:function(){var t;return t=u.getErrorString("uninstall push"),s=l._Error(t,i),null!=e&&e.failure(s),r(s)}},u.send(o)}}(this))},t._validateDeviceType=function(t){return"ANDROID"===t||"MQTT"===t||"IOS"===t},t.prototype._setAuthToken=function(t){return t.setCurrentUserToken()},t}(),f.KiiPushInstallationWithToken=function(t){function e(t){this._authToken=t,this._setAuthToken=y(this._setAuthToken,this)}return k(e,t),e.prototype._setAuthToken=function(t){return t.setAuthToken(this._authToken)},e}(f.KiiPushInstallation),f.KiiErrorParser=function(){function t(){}var e,i,n,r,s,o,u;return u={APP_NOT_FOUND:404,APP_DISABLED:403,UNAUTHORIZED:401,USER_NOT_FOUND:404,THING_NOT_FOUND:404,THING_DISABLED:401,THING_ALREADY_EXISTS:409,THING_TYPE_NOT_FOUND:404,FIRMWARE_VERSION_NOT_FOUND:404,WRONG_TOKEN:403,WRONG_REFRESH_TOKEN:403,INVALID_BUCKET:400,OPERATION_NOT_ALLOWED:409,OPERATION_NOT_SUPPORTED:403,AUTHENTICATION_FAILED:401,USER_DISABLED:401,INVALID_DATA_TYPE:400,INVALID_INPUT_DATA:400,INVALID_JSON:400,INVALID_JSON_SCHEMA:400,MISSING_DATA:400,RESOURCE_TEMPORARILY_UNAVAILABLE:503,WRONG_PASSWORD:401,OAUTH2_ERROR:400,THING_END_NODE_DOES_NOT_BELONG_TO_GATEWAY:404,THING_END_NODE_ALREADY_BELONGS_TO_GATEWAY:409,UNDEFINED_ERROR:500,OPERATION_NOT_IMPLEMENTED:501,LOCK_FAILED:503,QUERY_NOT_SUPPORTED:400,QUERY_TIMEOUT:503,TEMPORARY_UNAVAILABLE_ERROR:503,APP_ALREADY_EXISTS:409,BUCKET_ALREADY_EXISTS:409,BUCKET_NOT_FOUND:404,FILTER_NOT_FOUND:404,INVALID_ACCOUNT_STATUS:400,INVALID_OBJECT_ID:400,INVALID_VERIFICATION_CODE:403,OBJECT_NOT_FOUND:404,OBJECT_VERSION_IS_STALE:409,OBJECT_ALREADY_EXISTS:409,OBJECT_CONFLICT:409,PUBLICATION_NOT_FOUND:404,PUBLICATION_EXPIRED:410,USER_ALREADY_EXISTS:409,USER_ADDRESS_NOT_FOUND:404,VERIFICATION_CODE_NOT_FOUND:404,ACCOUNT_TYPE_NOT_SUPPORTED:400,OBJECT_BODY_NOT_FOUND:404,OBJECT_BODY_RANGE_NOT_SATISFIABLE:416,OBJECT_BODY_INTEGRITY_NOT_ASSURED:412,OBJECT_BODY_UPLOAD_NOT_FOUND:404,OBJECT_BODY_UPLOAD_ALREADY_EXISTS:409,BUCKET_TYPE_NOT_SUPPORTED:400,GROUP_NOT_FOUND:404,GROUP_ALREADY_EXISTS:409,INSTALLATION_NOT_FOUND:404,INSTALLATION_ALREADY_EXISTS:409,ACL_NOT_FOUND:404,ACL_ALREADY_EXISTS:409,VERSIONED_UPDATES_NOT_SUPPORTED:400,NO_ACCOUNT_PROVIDED:400,FACEBOOK_USER_ALREADY_LINKED:409,QQ_USER_ALREADY_LINKED:409,GOOGLE_USER_ALREADY_LINKED:409,USER_ALREADY_LINKED:409,USER_NOT_LINKED:409,UNIQUE_CONSTRAINT_VIOLATED:409,GCMKEY_ALREADY_EXISTS:409,GCMKEY_NOT_FOUND:404,APNSKEY_NOT_FOUND:404,JSON_WEB_KEY_NOT_FOUND:404,JPUSHKEY_NOT_FOUND:404,PUSH_SUBSCRIPTION_ALREADY_EXISTS:409,PUSH_SUBSCRIPTION_NOT_FOUND:404,TOPIC_ALREADY_EXISTS:409,TOPIC_NOT_FOUND:404,USER_LOCALE_NOT_FOUND:404,TEMPLATE_NOT_FOUND:404,USER_COUNTRY_NOT_FOUND:404,USER_DISPLAY_NAME_NOT_FOUND:404,SERVER_CODE_VERSION_NOT_FOUND:404,SERVER_CODE_HOOK_VERSION_NOT_FOUND:404,SCHEDULE_EXECUTION_NOT_FOUND:404,ENDPOINT_INVOCATION_ERROR:400,SERVER_CODE_VERIFICATION_ERROR:400,PAYLOAD_ID_NOT_FOUND:404,REPLACEMENT_SQL_QUERY_NOT_FOUND:404,APP_CONFIG_PARAMETER_NOT_FOUND:404,TRANSACTION_ID_NOT_FOUND:404,TRANSACTION_ID_ALREADY_EXISTS:409,CLIENT_CREDENTIALS_NOT_FOUND:404,ACCESS_CODE_NOT_FOUND:404,THING_OWNERSHIP_NOT_FOUND:404,THING_OWNERSHIP_ALREADY_EXISTS:409,INVALID_THING_OWNERSHIP_CODE:409,MQTT_ENDPOINT_NOT_FOUND:404,TASK_NOT_FOUND:404,TASK_NOT_RECURRENT:400,INVALID_STATUS:409,PHONE_NUMBER_VERIFICATION_CODE_EXPIRED:410,PIN_CODE_EXPIRED:410,ADDRESS_VERIFICATION_CODE_NOT_FOUND:404,MQTT_ENDPOINT_NOT_READY:503,INDEX_FAILED:500},i=new RegExp("(^[A-Z_]+): (.*)"),o=new RegExp(" statusCode: (\\d{3}) error code: ([A-Z_]+) message: (.*)$"),s=new RegExp(" statusCode: (\\d{3}) error code: ([A-Z_]+) error message: (.*)$"),n=new RegExp(" statusCode: (\\d{3}) executedSteps: \\d+ error code: ([A-Z_]+) message: (.*) detailMessage: (.*)$"),r=new RegExp(" statusCode: (\\d{3}) executedSteps: null error code: ([A-Z_]+) message: (.*)$"),e=new RegExp("statusCode: (\\d{1,3})$"),t.parse=function(t){var a,l,c,h,p,f,g,_,d;if(c="string"===(typeof t).toLowerCase()?t:t.message,!c)return null;if(0===c.indexOf("0 : http"))return{status:0,code:null,message:"Network Error"};if(0===c.indexOf("429 : http"))return{status:429,code:"TOO_MANY_REQUESTS",message:"Number of requests exceeds the limit."};if(0===c.indexOf("fail to execute server code. statusCode: 0"))return{status:0,code:null,message:"Network Error"};if(a=e.exec(c))return f=Number(a[1]),429===f?{status:429,code:"TOO_MANY_REQUESTS",message:"Number of requests exceeds the limit."}:{status:0,code:null,message:"Network Error"};if(a=i.exec(c))return l=a[1],h=a[2],f=u[l],f||(f=-2),{status:f,code:l,message:h};for(d=[o,s,n,r],g=0,_=d.length;_>g;g++)if(p=d[g],a=p.exec(c))return f=Number(a[1]),l=a[2],h=a[3],{status:f,code:l,message:h};return{status:-1,code:null,message:c}},t}(),f.KiiThingQuery=function(){function t(t,e){if(this._dictValue=y(this._dictValue,this),this.clone=y(this.clone,this),this.getPaginationKey=y(this.getPaginationKey,this),this.setPaginationKey=y(this.setPaginationKey,this),this.getThingType=y(this.getThingType,this),this.setThingType=y(this.setThingType,this),this.getLimit=y(this.getLimit,this),this.setLimit=y(this.setLimit,this),null==t&&(null==e||0===e.length))throw f.InvalidArgumentException("Both the owner and groups parameter are optional, but at least one of them must be supplied.");this._owner=t,this._groups=e,this._limit=0}return t.thingQuery=function(t,e){return new f.KiiThingQuery(t,e)},t.prototype.setLimit=function(t){return t>0?this._limit=t:this._limit=0},t.prototype.getLimit=function(){return this._limit},t.prototype.setThingType=function(t){return this._thingType=t},t.prototype.getThingType=function(){return this._thingType},t.prototype.setPaginationKey=function(t){return this._paginationKey=t},t.prototype.getPaginationKey=function(){return this._paginationKey},t.prototype.clone=function(){var t;return t=new f.KiiThingQuery(f.KiiThingQuery._clone(this._owner),f.KiiThingQuery._clone(this._groups)),t._limit=this._limit,t._thingType=this._thingType,t._paginationKey=this._paginationKey,t},t._clone=function(e){var i,n;if(null==e||"object"!=typeof e)return e;n=new e.constructor;for(i in e)n[i]=t._clone(e[i]);return n},t.prototype._dictValue=function(){var t,e,i,n,r,s,o,u,a,l;if(r={},null!=this._limit&&this._limit>0&&(r.bestEffortLimit=this._limit),null!=this._paginationKey&&(r.paginationKey=this._paginationKey),n=[],null!=this._owner&&(o={type:"contains",field:"userOwners",value:this._owner.getID()},n.push(o)),null!=this._groups&&this._groups.length>0)for(l=this._groups,u=0,a=l.length;a>u;u++)t=l[u],e={type:"contains",field:"groupOwners",value:t.getID()},n.push(e);if(0===n.length)throw f.InvalidArgumentException("Query clause must include the 'contains' clause.");return i=1===n.length?n[0]:{type:"or",clauses:n},s=null!=this._thingType?{clause:{type:"and",clauses:[{type:"eq",field:"_thingType",value:this._thingType},i]}}:{clause:i},r.thingQuery=s,r},t}(),f.KiiThingQueryResult=function(){function t(t,e,i){this.getNextResult=y(this.getNextResult,this),this.getNextKiiThingQuery=y(this.getNextKiiThingQuery,this),this.hasNext=y(this.hasNext,this),this.getResult=y(this.getResult,this),this._query=t,this._results=e,this._paginationKey=i}return t.prototype.getResult=function(){return this._results},t.prototype.hasNext=function(){return null!=this._paginationKey},t.prototype.getNextKiiThingQuery=function(){var t;return this.hasNext()?(t=this._query.clone(),t.setPaginationKey(this._paginationKey),t):null},t.prototype.getNextResult=function(t){return this.hasNext()?f.KiiThing.executeQuery(this.getNextKiiThingQuery(),t):new Promise(function(e){return function(i,n){var r,s;return s="No more pages to fetch",r=l._Error(s,e),null!=t&&t.failure(r),n(r)}}(this))},t}(),f};!function(){var e="undefined"!=typeof module&&null!==module;e&&module.exports?module.exports={exportedClasses:["ForTest","Kii","KiiACL","KiiACLEntry","KiiACLWithToken","KiiAnalytics","KiiAnonymousUser","KiiAnyAuthenticatedUser","KiiAppAdminContext","KiiBucket","KiiBucketWithToken","KiiClause","KiiEncryptedBucket","KiiEncryptedBucketWithToken","KiiErrorParser","KiiGeoPoint","KiiGroup","KiiGroupWithToken","KiiObject","KiiObjectWithToken","KiiPushInstallation","KiiPushInstallationWithToken","KiiPushSubscription","KiiPushSubscriptionWithToken","KiiQuery","KiiSCNFacebook","KiiSCNGoogle","KiiSCNQQ","KiiSCNRenRen","KiiSCNTwitter","KiiSDKClientInfo","KiiServerCodeEntry","KiiServerCodeExecResult","KiiSocialConnect","KiiSocialConnectNetwork","KiiThing","KiiThingContext","KiiThingQuery","KiiThingQueryResult","KiiThingWithToken","KiiTopic","KiiPushMessageBuilder","KiiTopicWithToken","KiiUser","KiiUserBuilder","KiiUserWithToken","KiiSocialNetworkName","KiiSite","KiiServerCodeEnvironmentVersion","_KiiHttpRequestType","KiiACLAction","KiiAnalyticsSite","InvalidDisplayNameException","InvalidPasswordException","InvalidUsernameException","InvalidUserIdentifierException","InvalidEmailException","InvalidPhoneNumberException","InvalidLocalPhoneNumberException","InvalidCountryException","InvalidURIException","InvalidACLAction","InvalidACLSubject","InvalidACLGrant","InvalidLimitException","InvalidArgumentException","IllegalStateException","ArithmeticException","UnsupportedOperationException"],create:function(){return t.call(this)}}:t()}()}();