!function(){var e=function(){Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=i.length;return function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var s=[];for(var o in r)e.call(r,o)&&s.push(o);if(t)for(var u=0;n>u;u++)e.call(r,i[u])&&s.push(i[u]);return s}}()),"undefined"==typeof Promise&&!function(e,t){function i(e,t){return(typeof t)[0]==e}function n(s,o){return o=function u(a,l,c,h,p,f){function d(e){return function(t){p&&(p=0,u(i,e,t))}}if(h=u.q,a!=i)return n(function(e,t){h.push({p:this,r:e,j:t,1:a,0:l})});if(c&&i(e,c)|i(t,c))try{p=c.then}catch(g){l=0,c=g}if(i(e,p))try{p.call(c,d(1),l=d(0))}catch(g){l(g)}else for(o=function(t,o){return i(e,t=l?t:o)?n(function(e,i){r(this,e,i,c,t)}):s},f=0;f<h.length;)p=h[f++],i(e,a=p[l])?r(p.p,p.r,p.j,c,a):(l?p.r:p.j)(c)},o.q=[],s.call(s={then:function(e,t){return o(e,t)},"catch":function(e){return o(0,e)}},function(e){o(i,1,e)},function(e){o(i,0,e)}),s}function r(n,r,s,o,u){setTimeout(function(){try{o=u(o),u=o&&i(t,o)|i(e,o)&&o.then,i(e,u)?o==n?s(TypeError()):u.call(o,r,s):r(o)}catch(a){s(a)}})}function s(e){return n(function(t){t(e)})}Promise=n,n.resolve=s,n.reject=function(e){return n(function(t,i){i(e)})},n.all=function(e){return n(function(t,i,n,r){r=[],n=e.length||t(r),e.map(function(e,o){s(e).then(function(e){r[o]=e,--n||t(r)},i)})})}}("f","o");var e,t,i,n,r,s,o,u,a,l,c,h,p,f,d,g,_,y=function(e,t){return function(){return e.apply(t,arguments)}},m={}.hasOwnProperty,v=function(e,t){function i(){this.constructor=e}for(var n in t)m.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};return f="undefined"!=typeof exports&&null!==exports?new Object:this,f.KiiSocialNetworkName={FACEBOOK:1,TWITTER:2,QQ:3,GOOGLEPLUS:4,RENREN:5},f.KiiSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api",SG:"https://api-sg.kii.com/api",CN3:"https://api-cn3.kii.com/api"},f.Kii=function(){function e(){}var t,i;return i=null,t=null,e.getBuildNumber=function(){return"1"},e.getSDKVersion=function(){return"2.4.3"},e.getBaseURL=function(){return i._baseURL},e.getAppID=function(){return i._appID},e.getAdditionalHeaders=function(){return t},e.setAdditionalHeaders=function(e){return t=e},e.getAppKey=function(){return i._appKey},e.isLogging=function(){return i._logging},e.setLogging=function(e){return i._logging=e,f.Kii.logger("Setting logging: "+e),f.Kii.logger("Base URL: "+i._baseURL)},e.setAccessTokenExpiration=function(e){if(!i)throw new f.IllegalStateException("Kii is not initialized");if(isNaN(parseInt(e,10)))throw new f.InvalidArgumentException("expiresIn should be a number");if(0>e)throw new f.InvalidArgumentException("expiresIn should not negative number");return i?i._expiresIn=e:void 0},e.getAccessTokenExpiration=function(){if(!i)throw new f.IllegalStateException("Kii is not initialized");return i._expiresIn},e.initializeWithSite=function(e,t,n,r){return i=new d(e,t,n),f.Kii.logger("Initialized "+e+", "+t+", "+n),"object"===l._type(r)?f.KiiAnalytics._initializeWithSite(e,t,n,r.deviceId):void 0},e.initialize=function(e,t,i){return f.Kii.initializeWithSite(e,t,f.KiiSite.US,i)},e.logger=function(e){return i._logging?console.log(e):void 0},e.bucketWithName=function(e){var t;return t=new f.KiiBucket(e,null)},e.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucket(e,null)},e.groupWithName=function(e){return new f.Kii.groupWithNameAndMembers(e,null)},e.groupWithNameAndMembers=function(e,t){return new f.KiiGroup.groupWithNameAndMembers(e,t)},e.logOut=function(){return i._currentUser=null,f.KiiSocialConnect.logOutAll()},e.loggedIn=function(){return null!=i._currentUser},e.getCurrentUser=function(){var e;return null!=i._currentUser?(e=new f.KiiUser,e._uuid=i._currentUser._uuid,e._username=i._currentUser._username,e._displayName=i._currentUser._displayName,e._password=i._currentUser._password,e._emailAddress=i._currentUser._emailAddress,e._phoneNumber=i._currentUser._phoneNumber,e._country=i._currentUser._country,e._created=i._currentUser._created,e._modified=i._currentUser._modified,e._emailVerified=i._currentUser._emailVerified,e._phoneVerified=i._currentUser._phoneVerified,e._accessToken=i._currentUser._accessToken,e._customInfo=i._currentUser._customInfo,e._expiresAt=i._currentUser._expiresAt,e._thirdPartyAccounts=i._currentUser._thirdPartyAccounts,e._disabled=i._currentUser._disabled,f.Kii.logger("my instance:"),f.Kii.logger(e),e):null},e.setCurrentUser=function(e){return i._currentUser=new f.KiiUser,i._currentUser._uuid=e._uuid,i._currentUser._username=e._username,i._currentUser._displayName=e._displayName,i._currentUser._password=e._password,i._currentUser._emailAddress=e._emailAddress,i._currentUser._phoneNumber=e._phoneNumber,i._currentUser._country=e._country,i._currentUser._created=e._created,i._currentUser._modified=e._modified,i._currentUser._emailVerified=e._emailVerified,i._currentUser._phoneVerified=e._phoneVerified,i._currentUser._accessToken=e._accessToken,i._currentUser._customInfo=e._customInfo,i._currentUser._expiresAt=e._expiresAt,i._currentUser._thirdPartyAccounts=e._thirdPartyAccounts,i._currentUser._disabled=e._disabled,f.Kii.logger("my instance:"),f.Kii.logger(i._currentUser)},e.authenticateAsAppAdmin=function(e,t,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(l._Error(arguments[0]))}},n._authenticateAsAppAdminUsingCallbacks(e,t,o)}}(this))},e._authenticateAsAppAdminUsingCallbacks=function(e,t,i){var n,r;return r=new o("/oauth2/token",!1),r.setAnonymous(!0),r.setMethod("POST"),r.setData({client_id:e,client_secret:t}),n={success:function(e){return function(e){var t,n,r;return r=e.access_token,n=e.id,f.Kii.logger("token: "+r),f.Kii.logger("id: "+n),t=new f.KiiAppAdminContext({token:r,id:n}),null!=i?i.success(t):void 0}}(this),failure:function(e){return function(e,t){return f.Kii.logger("error: "+e),f.Kii.logger("statusCode: "+t),null!=i?i.failure(e,t):void 0}}(this)},r.execute(n,!1)},e.authenticateAsAdminWithToken=function(e){return new f.KiiAppAdminContext({token:e})},e.serverCodeEntry=function(e){if(!l._validateServerCodeEntryName(e))throw new f.InvalidArgumentException("entryName is invalid");return new f.KiiServerCodeEntry(e)},e.serverCodeEntryWithVersion=function(e,t){if(!l._validateServerCodeEntryName(e))throw new f.InvalidArgumentException("entryName is invalid");if(!l._validateServerCodeEnryVersion(t))throw new f.InvalidArgumentException("version is invalid");return new f.KiiServerCodeEntry(e,t)},e._setHttpRequestType=function(e){return f.Kii.logger("Set http request as "+e),i._httpRequestType=e},e._getHttpRequestType=function(){return i._httpRequestType},e._getKiiUtilities=function(){return l},e.topicWithName=function(e){var t;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");return t=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID(),new f.KiiTopic(t,e)},e.listTopics=function(t,i){return e._listTopics(t,i)},e._listTopics=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=t&&t.success.apply(t,arguments),r(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),s(arguments[0])}},e._listTopicsUsingCallbacks(o,i,n)})},e._listTopicsUsingCallbacks=function(t,i,n){var r,s,o;return s=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/topics","string"==typeof i&&""!==i&&(s=s+"?paginationKey="+encodeURIComponent(i)),o=h.createXHRWrapper("GET",s),o.setKiiHeaders(),null!=n?o.setAuthToken(n._getToken()):o.setCurrentUserToken(),r={success:function(){var i,n,r,s,u,a;for(i=JSON.parse(o.xhr.responseText),r=[],a=i.topics,s=0,u=a.length;u>s;s++)n=a[s],r.push(e.topicWithName(n.topicID));return null!=t?t.success(r,void 0===i.paginationKey?null:i.paginationKey):void 0},failure:function(){var i,n;return n=o.getErrorString("list topics"),i=l._Error(n,e),null!=t?t.failure(i):void 0}},o.send(r)},e}(),f._KiiHttpRequestType={jQuery:"jQuery",XMLHttpRequest:"XMLHttpRequest",Titanium:"Titanium"},d=function(){function e(e,t,i){this._appKey=t,this._appID=e,this._baseURL=i,this._expiresIn=0}return e.prototype._logging=!1,e.prototype._baseURL=null,e.prototype._currentUser=null,e.prototype._httpRequestType=null,e}(),f.KiiACL=function(){function e(){this._thingWithID=y(this._thingWithID,this),this._userWithID=y(this._userWithID,this),this._groupWithID=y(this._groupWithID,this),this._getRequest=y(this._getRequest,this),this._saveItr=y(this._saveItr,this),this._saveUsingCallbacks=y(this._saveUsingCallbacks,this),this.save=y(this.save,this),this._getKeyOfEntry=y(this._getKeyOfEntry,this),this.removeACLEntry=y(this.removeACLEntry,this),this.putACLEntry=y(this.putACLEntry,this),this._listACLEntriesUsingCallbacks=y(this._listACLEntriesUsingCallbacks,this),this.listACLEntries=y(this.listACLEntries,this),this.aclPath=y(this.aclPath,this),this._setParent=y(this._setParent,this),this._entriesMap={}}return e.prototype._setParent=function(e){this._parent=e},e.prototype.aclPath=function(){var e,t,i,n,r,s,o,u,a,l;return this._parent instanceof f.KiiObject?(n=this._parent,null!=n.getBucket().getUser()?l=n.getBucket().getUser():null!=n.getBucket().getGroup()?i=n.getBucket().getGroup():null!=n.getBucket().getThing()&&(u=n.getBucket().getThing()),t=n.getBucket()._getQualifiedBucketName(),r=n.getUUID()):this._parent instanceof f.KiiBucket?(e=this._parent,null!=e.getUser()?l=e.getUser():null!=e.getGroup()?i=e.getGroup():null!=e.getThing()&&(u=e.getThing()),t=e._getQualifiedBucketName()):this._parent instanceof f.KiiTopic?a=this._parent:f.Kii.logger("Invalid ACL parent. Must belong to a KiiObject"),s="/",null!=i?s+="groups/"+i.getUUID()+"/":null!=l?s+="users/"+l.getUUID()+"/":null!=u&&(s+="things/"+u.getThingID()+"/"),a?(o=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/",0!==a._uri.indexOf(o)?s=null:s+=a._uri.substr(o.length)+"/acl"):s+=null!=r?"buckets/"+t+"/objects/"+r+"/acl":"buckets/"+t+"/acl",s},e.prototype.listACLEntries=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._listACLEntriesUsingCallbacks(r)}}(this))},e.prototype._listACLEntriesUsingCallbacks=function(e){var t,i;return f.Kii.logger("Listing ACL entries"),i=this._getRequest({path:this.aclPath(),withApp:!0}),t={success:function(t){return function(i,n){var r,s,o,u,a,l,c,h;if(300>n&&n>=200){u=[];for(o in i){if(l=i[o],"WRITE_EXISTING_OBJECT"===o)r=f.KiiACLAction.KiiACLObjectActionWrite;else if("READ_EXISTING_OBJECT"===o)r=f.KiiACLAction.KiiACLObjectActionRead;else if("QUERY_OBJECTS_IN_BUCKET"===o)r=f.KiiACLAction.KiiACLBucketActionQueryObjects;else if("CREATE_OBJECTS_IN_BUCKET"===o)r=f.KiiACLAction.KiiACLBucketActionCreateObjects;else if("DROP_BUCKET_WITH_ALL_CONTENT"===o)r=f.KiiACLAction.KiiACLBucketActionDropBucket;else if("READ_OBJECTS_IN_BUCKET"===o)r=f.KiiACLAction.KiiACLBucketActionReadObjects;else if("SUBSCRIBE_TO_TOPIC"===o)r=f.KiiACLAction.KiiACLSubscribeToTopic;else{if("SEND_MESSAGE_TO_TOPIC"!==o)continue;r=f.KiiACLAction.KiiACLSendMessageToTopic}for(c=0,h=l.length;h>c;c++){if(s=l[c],null!=s.groupID)a=t._groupWithID(s.groupID);else if(null!=s.userID)a=t._userWithID(s.userID);else{if(null==s.thingID)continue;a=t._thingWithID(s.thingID)}u.push(f.KiiACLEntry.entryWithSubject(a,r))}}return e.success(t,u)}return e.failure(t,"Unable to retrieve ACL list")}}(this),failure:function(t){return function(i,n){return e.failure(t,i)}}(this)},i.execute(t,!1)},e.prototype.putACLEntry=function(e){var t;if(!(e instanceof f.KiiACLEntry))throw new f.InvalidArgumentException("invalid entry");return t=this._getKeyOfEntry(e),this._entriesMap[t]=e},e.prototype.removeACLEntry=function(e){var t;if(!(e instanceof f.KiiACLEntry))throw new f.InvalidArgumentException("invalid entry");return t=this._getKeyOfEntry(e),delete this._entriesMap[t]},e.prototype._getKeyOfEntry=function(e){var t,i,n;return t=e.getActionString(),i=e.getEntityString(),n=e.getGrant(),""+t+"/"+i+":"+n},e.prototype.save=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._saveUsingCallbacks(r)}}(this))},e.prototype._saveUsingCallbacks=function(e){var t;return f.Kii.logger("SAving acl"),this._entriesMap?(t=Object.keys(this._entriesMap),f.Kii.logger("Saving total entries : "+t.length),t.length<1?void e.failure(this,"There is no entry to save."):this._saveItr(t,0,e)):void e.failure(this,"There is no entry to save.")},e.prototype._saveItr=function(e,t,i){var n,r,s,o;return n=this._entriesMap[e[t]],r=""+this.aclPath()+"/"+n.getActionString()+"/"+n.getEntityString(),f.Kii.logger("Saving single @path: "+r),f.Kii.logger("Saving  entries index : "+t),s=this._getRequest({path:r,withApp:!0}),s.setMethod(n.getGrant()===!0?"PUT":"DELETE"),o=null,s.execute({success:function(r){return function(s,o,u){return r.removeACLEntry(n),t<e.length-1?r._saveItr(e,t+1,i):i.success(r)}}(this),failure:function(e){return function(t,n,r){return i.failure(e,t)}}(this)},!1)},e.aclWithParent=function(e){var t;return t=new f.KiiACL,t._setParent(e),t},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.prototype._groupWithID=function(e){var t;return t=f.KiiGroup.groupWithID(e)},e.prototype._userWithID=function(e){return"ANONYMOUS_USER"===e?new f.KiiAnonymousUser:"ANY_AUTHENTICATED_USER"===e?new f.KiiAnyAuthenticatedUser:f.KiiUser.userWithID(e)},e.prototype._thingWithID=function(e){return f.KiiThing.thingWithID(e)},e}(),f.KiiACLAction={KiiACLActionStart:-1,KiiACLBucketActionCreateObjects:0,KiiACLBucketActionQueryObjects:1,KiiACLBucketActionDropBucket:2,KiiACLBucketActionReadObjects:3,KiiACLObjectActionRead:4,KiiACLObjectActionWrite:5,KiiACLSubscribeToTopic:6,KiiACLSendMessageToTopic:7,KiiACLActionEnd:8},f.KiiACLEntry=function(){function e(){this.getEntityString=y(this.getEntityString,this),this.getActionString=y(this.getActionString,this),this.getGrant=y(this.getGrant,this),this.setGrant=y(this.setGrant,this),this.getSubject=y(this.getSubject,this),this.setSubject=y(this.setSubject,this),this.getAction=y(this.getAction,this),this.setAction=y(this.setAction,this),this._action=-1,this._grant=!0}return e.prototype.setAction=function(e){if(e>f.KiiACLAction.KiiACLActionStart&&e<f.KiiACLAction.KiiACLActionEnd)return this._action=e;throw new f.InvalidACLAction},e.prototype.getAction=function(){return this._action},e.prototype.setSubject=function(e){if(e instanceof f.KiiGroup&&null!=e.getID()||e instanceof f.KiiUser&&null!=e.getID()||e instanceof f.KiiAnyAuthenticatedUser||e instanceof f.KiiAnonymousUser||e instanceof f.KiiThing&&null!=e.getThingID())return this._subject=e;throw new f.InvalidACLSubject},e.prototype.getSubject=function(){return this._subject},e.prototype.setGrant=function(e){if(e===!0||e===!1)return this._grant=e;throw new f.InvalidACLGrant},e.prototype.getGrant=function(){return this._grant},e.entryWithSubject=function(e,t){var i;return f.Kii.logger("EWS: "+e+", "+t),i=new f.KiiACLEntry,i.setSubject(e),i.setAction(t),i},e.prototype.getActionString=function(){var e;switch(f.Kii.logger("Action: "+this.action),this._action){case f.KiiACLAction.KiiACLBucketActionCreateObjects:e="CREATE_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLBucketActionQueryObjects:e="QUERY_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLBucketActionDropBucket:e="DROP_BUCKET_WITH_ALL_CONTENT";break;case f.KiiACLAction.KiiACLBucketActionReadObjects:e="READ_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLObjectActionRead:e="READ_EXISTING_OBJECT";break;case f.KiiACLAction.KiiACLObjectActionWrite:e="WRITE_EXISTING_OBJECT";break;case f.KiiACLAction.KiiACLSubscribeToTopic:e="SUBSCRIBE_TO_TOPIC";break;case f.KiiACLAction.KiiACLSendMessageToTopic:e="SEND_MESSAGE_TO_TOPIC";break;default:return e}return e},e.prototype.getEntityString=function(){var e,t;return this._subject instanceof f.KiiGroup?(e=this._subject.getUUID(),t="GroupID"):this._subject instanceof f.KiiUser?(e=this._subject.getUUID(),t="UserID"):this._subject instanceof f.KiiAnyAuthenticatedUser?(t="UserID",e="ANY_AUTHENTICATED_USER"):this._subject instanceof f.KiiAnonymousUser?(t="UserID",e="ANONYMOUS_USER"):this._subject instanceof f.KiiThing&&(t="ThingID",e=this._subject.getThingID()),""+t+":"+e},e}(),f.KiiBucket=function(){function e(e,t){if(this.objectWithJSON=y(this.objectWithJSON,this),this._getHttpUri=y(this._getHttpUri,this),this._generatePath=y(this._generatePath,this),this._getRequest=y(this._getRequest,this),this._deleteUsingCallbacks=y(this._deleteUsingCallbacks,this),this["delete"]=y(this["delete"],this),this.count=y(this.count,this),this._countWithQueryUsingCallbacks=y(this._countWithQueryUsingCallbacks,this),this.countWithQuery=y(this.countWithQuery,this),this._executeQueryUsingCallbacks=y(this._executeQueryUsingCallbacks,this),this.executeQuery=y(this.executeQuery,this),this.acl=y(this.acl,this),this.createObjectWithID=y(this.createObjectWithID,this),this.createObjectWithType=y(this.createObjectWithType,this),this.createObject=y(this.createObject,this),this._getQualifiedBucketName=y(this._getQualifiedBucketName,this),this._setBucketName=y(this._setBucketName,this),this.getBucketName=y(this.getBucketName,this),this.getThing=y(this.getThing,this),this.getGroup=y(this.getGroup,this),this.getUser=y(this.getUser,this),!l._isNonEmptyString(e))throw f.InvalidArgumentException("Specified bucket name is null or empty.");this._bucketName=e,null!=t&&(t instanceof f.KiiGroup?this._group=t:t instanceof f.KiiUser?this._user=t:t instanceof f.KiiThing&&(this._thing=t))}return e.prototype._className="KiiBucket",e.prototype.getUser=function(){return this._user},e.prototype.getGroup=function(){return this._group},e.prototype.getThing=function(){return this._thing},e.prototype.getBucketName=function(){return this._bucketName},e.prototype._setBucketName=function(e){this._bucketName=e},e.prototype._getQualifiedBucketName=function(){return this._bucketName},e.prototype.createObject=function(){return f.KiiObject.objectWithBucket(this,null)},e.prototype.createObjectWithType=function(e){return f.KiiObject.objectWithBucket(this,e)},e.prototype.createObjectWithID=function(e){if(!f.KiiObject.isValidObjectID(e))throw f.InvalidArgumentException("Specified obejctID is invalid.");return f.KiiObject.objectWithID(this,e)},e.prototype.acl=function(){return f.KiiACL.aclWithParent(this)},e.prototype.executeQuery=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._executeQueryUsingCallbacks(e,s)}}(this))},e.prototype._executeQueryUsingCallbacks=function(e,t){var i,n,r,s;return r=this._generatePath()+"/query",i={},null!=e?i=e._dictValue():i.bucketQuery={clause:f.KiiQuery._emptyDictValue()},s=this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.QueryRequest+json"),s.setData(i),n={success:function(i){return function(n,r){var s,o,u,a,l,c;if(300>r&&r>=200){for(u=[],c=n.results,a=0,l=c.length;l>a;a++)o=c[a],u.push(i.objectWithJSON(o));if(null!=n.nextPaginationKey?(s=new f.KiiQuery(e),s.setPaginationKey(n.nextPaginationKey)):s=null,null!=t)return t.success(e,u,s)}else if(null!=t)return t.failure(i,"Unable to parse response")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},s.execute(n,!1)},e.prototype.countWithQuery=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._countWithQueryUsingCallbacks(e,s)}}(this))},e.prototype._countWithQueryUsingCallbacks=function(e,t){var i,n,r,s;return r=this._generatePath()+"/query",i={},null!=e?i=e._dictValue():(i.bucketQuery={clause:f.KiiQuery._emptyDictValue()},e=f.KiiQuery.queryWithClause()),i.bucketQuery.aggregations=[{type:"COUNT",putAggregationInto:"count_field"}],s=this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.QueryRequest+json"),s.setData(i),n={success:function(i){return function(n,r){var s;if(300>r&&r>=200){if(s=n.aggregations.count_field,null!=t)return t.success(i,e,s)}else if(null!=t)return t.failure(i,"Unable to parse response")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},s.execute(n,!1)},e.prototype.count=function(e){var t;return t=f.KiiQuery.queryWithClause(),this.countWithQuery(t,e)},e.prototype["delete"]=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._deleteUsingCallbacks(r)}}(this))},e.prototype._deleteUsingCallbacks=function(e){var t,i;return i=this._getRequest({path:this._generatePath(),withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(i,n){return null!=e?e.success(t):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e._bucketWithName=function(e,t){var i;return i=new f.KiiBucket(e,t)},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.prototype._generatePath=function(){var e;return e=null!=this._user?"/users/"+this._user.getUUID()+"/buckets/"+this._getQualifiedBucketName():null!=this._group?"/groups/"+this._group.getUUID()+"/buckets/"+this._getQualifiedBucketName():null!=this._thing?"/things/"+this._thing.getThingID()+"/buckets/"+this._getQualifiedBucketName():"/buckets/"+this._getQualifiedBucketName()},e.prototype._getHttpUri=function(){return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/"+this._generatePath()},e.prototype.objectWithJSON=function(e){var t;return t=this.createObject(),t._updateWithJSON(e),t},e}(),f.KiiEncryptedBucket=function(e){function t(e,i){if(this._getQualifiedBucketName=y(this._getQualifiedBucketName,this),!l._isNonEmptyString(e))throw f.InvalidArgumentException("Specified bucket name is null or empty.");f.KiiEncryptedBucket._isEncrypted(e)?t.__super__.constructor.call(this,e.replace("CRYPTO:",""),i):t.__super__.constructor.call(this,e,i)}return v(t,e),t.prototype._getQualifiedBucketName=function(){return"CRYPTO:"+this._bucketName},t._bucketWithName=function(e,t){var i;return i=new f.KiiEncryptedBucket(e,t)},t._isEncrypted=function(e){var t;return t=0===e.indexOf("CRYPTO:")},t}(f.KiiBucket),f.KiiEncryptedBucketAdmin=function(e){function t(e,i,n){this.acl=y(this.acl,this),this.createObjectWithID=y(this.createObjectWithID,this),this.createObjectWithType=y(this.createObjectWithType,this),this.createObject=y(this.createObject,this),this._getRequest=y(this._getRequest,this),t.__super__.constructor.call(this,e,i),this._adminToken=n}return v(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype.createObject=function(){return f.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},t.prototype.createObjectWithType=function(e){return f.KiiObjectAdmin.objectWithBucket(this,e,this._adminToken)},t.prototype.createObjectWithID=function(e){return f.KiiObjectAdmin.objectWithID(this,e,this._adminToken)},t.prototype.acl=function(){var e;return e=new f.KiiACLAdmin(this,this._adminToken)},t}(f.KiiEncryptedBucket),f.KiiBucketAdmin=function(e){function t(e,i,n){this.acl=y(this.acl,this),this.createObjectWithID=y(this.createObjectWithID,this),this.createObjectWithType=y(this.createObjectWithType,this),this.createObject=y(this.createObject,this),this._getRequest=y(this._getRequest,this),t.__super__.constructor.call(this,e,i),this._adminToken=n}return v(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype.createObject=function(){return f.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},t.prototype.createObjectWithType=function(e){return f.KiiObjectAdmin.objectWithBucket(this,e,this._adminToken)},t.prototype.createObjectWithID=function(e){return f.KiiObjectAdmin.objectWithID(this,e,this._adminToken)},t.prototype.acl=function(){var e;return e=new f.KiiACLAdmin(this,this._adminToken)},t}(f.KiiBucket),f.KiiGroup=function(){function e(){this._setAuthToken=y(this._setAuthToken,this),this._getHttpURI=y(this._getHttpURI,this),this._listTopicsUsingCallbacks=y(this._listTopicsUsingCallbacks,this),this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this._setOwnerFromContext=y(this._setOwnerFromContext,this),this._userWithID=y(this._userWithID,this),this._getRequest=y(this._getRequest,this),this._updateWithJSON=y(this._updateWithJSON,this),this._getOwnerUsingCallbacks=y(this._getOwnerUsingCallbacks,this),this.getOwner=y(this.getOwner,this),this._deleteUsingCallbacks=y(this._deleteUsingCallbacks,this),this["delete"]=y(this["delete"],this),this._refreshUsingCallbacks=y(this._refreshUsingCallbacks,this),this.refresh=y(this.refresh,this),this._saveWithOwnerUsingCallbacks=y(this._saveWithOwnerUsingCallbacks,this),this.saveWithOwner=y(this.saveWithOwner,this),this._saveUsingCallbacks=y(this._saveUsingCallbacks,this),this.save=y(this.save,this),this._changeGroupNameUsingCallbacks=y(this._changeGroupNameUsingCallbacks,this),this.changeGroupName=y(this.changeGroupName,this),this._changeOwner=y(this._changeOwner,this),this._saveMembers=y(this._saveMembers,this),this._getMemberListUsingCallbacks=y(this._getMemberListUsingCallbacks,this),this.getMemberList=y(this.getMemberList,this),this._removeMember=y(this._removeMember,this),this._addMember=y(this._addMember,this),this.removeUser=y(this.removeUser,this),this.addUser=y(this.addUser,this),this.encryptedBucketWithName=y(this.encryptedBucketWithName,this),this.bucketWithName=y(this.bucketWithName,this),this.objectURI=y(this.objectURI,this),this._setOwner=y(this._setOwner,this),this.getCachedOwner=y(this.getCachedOwner,this),this._setName=y(this._setName,this),this.getName=y(this.getName,this),this.getID=y(this.getID,this),this._setUUID=y(this._setUUID,this),this.getUUID=y(this.getUUID,this),this._setAddMembers=y(this._setAddMembers,this),this._getRemoveMembers=y(this._getRemoveMembers,this),this._getAddMembers=y(this._getAddMembers,this),this._addMembers={},this._removeMembers={}}return e.prototype._getAddMembers=function(){return this._addMembers},e.prototype._getRemoveMembers=function(){return this._removeMembers},e.prototype._setAddMembers=function(e){var t,i,n,r;if(null!=e){for(r=[],i=0,n=e.length;n>i;i++)t=e[i],r.push(this.addUser(t));return r}},e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getID=function(){return this._uuid},e.prototype.getName=function(){return this._groupName},e.prototype._setName=function(e){this._groupName=e},e.prototype.getCachedOwner=function(){return this._owner},e.prototype._setOwner=function(e){this._owner=e},e.prototype.objectURI=function(){return null!=this._uuid?"kiicloud://groups/"+this._uuid:null},e.registerGroupWithID=function(t,i,n,r){return new Promise(function(s,o){var u,a,c;return u={success:function(){return null!=r&&r.success.apply(r,arguments),s(arguments[0])},failure:function(){var e;return null!=r&&r.failure.apply(r,arguments),e=l._Error(arguments[1],arguments[0]),e.addMembersArray=arguments[2],e.removeMembersArray=arguments[3],o(e)}},e._registerGroupWithIDUsingCallbacks(null!=(a=f.KiiUser.getCurrentUser())?a.getAccessToken():void 0,t,i,null!=(c=f.Kii.getCurrentUser())?c.getID():void 0,n,u)})},e._registerGroupWithIDUsingCallbacks=function(t,i,n,r,s,o){var u,a,c,p,d,g,_,y,m,v;if(!l._isNonEmptyString(i))return void o.failure(null,"groupID is null or empty",s,null);if(!l._validateGroupID(i))return void o.failure(null,"invalid groupID : "+i,s,null);if(!l._isNonEmptyString(n))return void o.failure(null,"groupName is null or empty",s,null);if(null==r)return void o.failure(null,"owner is null",s,null);if(g=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/groups/"+i,_=h.createXHRWrapper("PUT",g),y=_.xhr,_.setKiiHeaders(),_.setAuthToken(t),_.setContentType("application/vnd.kii.GroupCreationRequest+json"),u={},u.name=n,u.owner=r,null!=s&&s.length>0){for(p=[],a=m=0,v=s.length;v>m;a=++m)c=s[a],p.push(c.getID());u.members=p}return d={success:function(){var t;try{return t=e.groupWithNameAndMembers(n,s),t._setUUID(i),o.success(t)}catch(r){return o.failure(null,_.getErrorString("failed to register group."))}},failure:function(){var e;return e=_.getErrorString("failed to register group."),o.failure(null,e,s,null)}},_.sendData(JSON.stringify(u),d)},e.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucket(e,this)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucket(e,this)},e.prototype.addUser=function(e){var t;return null==e?void f.Kii.logger("Passed member is null"):null==e.getUUID()?void f.Kii.logger("Passed member ID is null"):(t=e.getUUID(),t in this._addMembers||(this._addMembers[t]=e),t in this._removeMembers?delete this._removeMembers[t]:void 0)},e.prototype.removeUser=function(e){var t;return null==e?void f.Kii.logger("Passed member is null"):null==e.getUUID()?void f.Kii.logger("Passed member uuid is null"):(t=e.getUUID(),t in this._removeMembers||(this._removeMembers[t]=e),t in this._addMembers?delete this._addMembers[t]:void 0)},e.prototype._addMember=function(e,t){var i,n;return f.Kii.logger("Adding member "+e.getUUID()+" to group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members/"+e.getUUID(),withApp:!0}),n.setMethod("PUT"),i={success:function(i){return function(n,r){return delete i._addMembers[e.getUUID()],i._saveMembers(t)}}(this),failure:function(i){return function(n,r){var s,o,u;return s=function(){var t,i;t=this._addMembers,i=[];for(u in t)e=t[u],i.push(e);return i}.call(i),o=function(){var t,i;t=this._removeMembers,i=[];for(u in t)e=t[u],i.push(e);return i}.call(i),t.failure(i,n,s,o)}}(this)},n.execute(i,!1)},e.prototype._removeMember=function(e,t){var i,n;return f.Kii.logger("Removing member "+e.getUUID()+" to group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members/"+e.getUUID(),withApp:!0}),n.setMethod("DELETE"),i={success:function(i){return function(n,r){return delete i._getRemoveMembers()[e.getUUID()],i._saveMembers(t)}}(this),failure:function(i){return function(n,r){var s,o,u;return s=function(){var t,i;t=this._addMembers,i=[];for(u in t)e=t[u],i.push(e);return i}.call(i),o=function(){var t,i;t=this._removeMembers,i=[];for(u in t)e=t[u],i.push(e);return i}.call(i),t.failure(i,n,s,o)}}(this)},n.execute(i,!1)},e.prototype.getMemberList=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._getMemberListUsingCallbacks(r)}}(this))},e.prototype._getMemberListUsingCallbacks=function(e){var t,i;return f.Kii.logger("Getting member list for group "+this._groupName),i=this._getRequest({path:"/groups/"+this._uuid+"/members",
withApp:!0}),i.setAccept("application/vnd.kii.MembersRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],o=i.members,u=0,a=o.length;a>u;u++)r=o[u],s.push(t._userWithID(r.userID));if(null!=e)return e.success(t,s)}else if(null!=e)return e.failure(t,"Unable to get member list of group")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype._saveMembers=function(e){var t,i;return t=Object.keys(this._addMembers),i=Object.keys(this._removeMembers),0===t.length&&0===i.length&&e.success(this),t.length>0?void this._addMember(this._addMembers[t[0]],e):void(i.length>0&&this._removeMember(this._removeMembers[i[0]],e))},e.prototype._changeOwner=function(e,t){var i,n,r;return n=this._getRequest({path:"/groups/"+this._uuid+"/owner",withApp:!0}),n.setContentType("application/vnd.kii.GroupOwnerChangeRequest+json"),n.setMethod("PUT"),i={},i.owner=e,n.setData(i),r={success:function(e){return function(i,n){return 300>n&&n>=200?t.success(e):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!1)},e.prototype.changeGroupName=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._changeGroupNameUsingCallbacks(e,s)}}(this))},e.prototype._changeGroupNameUsingCallbacks=function(e,t){var i,n;return f.Kii.logger("Saving group: "+this.name),null!=this._uuid?(i=this._getRequest({path:"/groups/"+this._uuid+"/name",withApp:!0}),i.setContentType("text/plain"),i.setMethod("PUT"),i.setData(e),n={success:function(i){return function(n,r){if(300>r&&r>=200){if(i._setName(e),null!=t)return t.success(i)}else if(null!=t)return t.failure(i,"Unable to change group name - invalid response")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(n,!0)):t.failure(this,"Invalid group. Save the group on the server before updating the name.")},e.prototype.save=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){var i;return null!=e&&e.failure.apply(e,arguments),i=l._Error(arguments[1],t),i.addMembersArray=arguments[2],i.removeMembersArray=arguments[3],n(i)}},t._saveUsingCallbacks(r)}}(this))},e.prototype._saveUsingCallbacks=function(e){var t,i,n;return f.Kii.logger("Saving group: "+this.name),null==this._uuid?(i=this._getRequest({path:"/groups",withApp:!0}),i.setContentType("application/vnd.kii.GroupCreationRequest+json"),i.setMethod("POST"),t={},null!=this._groupName&&(t.name=this._groupName),this._setOwnerFromContext(t),i.setData(t),n={success:function(t){return function(i,n){return 300>n&&n>=200?(t._setUUID(i.groupID),t._saveMembers(e)):void 0}}(this),failure:function(t){return function(i,n){var r,s,o,u;return null!=e?(r=function(){var e,t;e=this._addMembers,t=[];for(u in e)s=e[u],t.push(s);return t}.call(t),o=function(){var e,t;e=this._removeMembers,t=[];for(u in e)s=e[u],t.push(s);return t}.call(t),e.failure(t,i,r,o)):void 0}}(this)},i.execute(n,!1)):this._saveMembers(e)},e.prototype.saveWithOwner=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){var e;return null!=t&&t.failure.apply(t,arguments),e=l._Error(arguments[1],i),e.addMembersArray=arguments[2],e.removeMembersArray=arguments[3],r(e)}},i._saveWithOwnerUsingCallbacks(e,s)}}(this))},e.prototype._saveWithOwnerUsingCallbacks=function(e,t){var i,n,r,s;return null==this._uuid?(n=this._getRequest({path:"/groups",withApp:!0}),n.setContentType("application/vnd.kii.GroupCreationRequest+json"),n.setMethod("POST"),i={},null!=this._groupName&&(i.name=this._groupName),i.owner=e,n.setData(i),r={success:function(e){return function(i,n){return 300>n&&n>=200?(e._setUUID(i.groupID),e._saveMembers(t)):void 0}}(this),failure:function(e){return function(i,n){var r,s,o,u;return null!=t?(r=function(){var e,t;e=this._addMembers,t=[];for(u in e)s=e[u],t.push(s);return t}.call(e),o=function(){var e,t;e=this._removeMembers,t=[];for(u in e)s=e[u],t.push(s);return t}.call(e),t.failure(e,i,r,o)):void 0}}(this)},n.execute(r,!1)):(s={success:function(i){return function(n){return i._changeOwner(e,t)}}(this),failure:function(e){return function(i,n){var r,s,o,u;return r=function(){var e,t;e=this._addMembers,t=[];for(u in e)s=e[u],t.push(s);return t}.call(e),o=function(){var e,t;e=this._removeMembers,t=[];for(u in e)s=e[u],t.push(s);return t}.call(e),t.failure(e,n,r,o)}}(this)},this._saveMembers(s))},e.prototype.refresh=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._refreshUsingCallbacks(r)}}(this))},e.prototype._refreshUsingCallbacks=function(e){var t,i;return f.Kii.logger("Refreshing group: "+this._groupName),i=new this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),i.setAccept("application/vnd.kii.GroupRetrievalResponse+json"),t={success:function(t){return function(i,n){return t._updateWithJSON(i),null!=e?e.success(t):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype["delete"]=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._deleteUsingCallbacks(r)}}(this))},e.prototype._deleteUsingCallbacks=function(e){var t,i;return f.Kii.logger("Deleting group: "+this._groupName),i=this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e.prototype.getOwner=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._getOwnerUsingCallbacks(r)}}(this))},e.prototype._getOwnerUsingCallbacks=function(e){return f.Kii.logger("Getting owner of group "+this._groupName),this.refresh({success:function(t){return function(t){return null!=e?e.success(t,t.getCachedOwner()):void 0}}(this),failure:function(t){return function(t,i){return null!=e?e.failure(t,i):void 0}}(this)})},e.groupWithName=function(e){return f.KiiGroup.groupWithNameAndMembers(e,null)},e.groupWithNameAndMembers=function(e,t){var i;return i=new f.KiiGroup,i._setName(e),i._setAddMembers(t),i},e.groupWithID=function(e){var t;if(null==e||""===e)throw new f.InvalidArgumentException("groupID should not null or empty");return t=new f.KiiGroup,t._setUUID(e),t},e.groupWithURI=function(e){var t,i,n,r;if(n=null,r=e.substr("kiicloud://".length),i=r.split("/"),t=i.length,!(t>0))throw new f.InvalidURIException;return n=new f.KiiGroup,n._setUUID(i[t-1]),n},e._groupWithJSON=function(e){var t;return t=new f.KiiGroup,null!=e.groupID&&t._setUUID(e.groupID),null!=e.name&&t._setName(e.name),null!=e.owner&&t._setOwner(f.KiiUser.userWithID(e.owner)),t},e.prototype._updateWithJSON=function(e){return null!=e.groupID&&this._setUUID(e.groupID),null!=e.name?this._setName(e.name):this._setName(null),null!=e.owner?this._setOwner(this._userWithID(e.owner)):this._setOwner(null)},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.prototype._userWithID=function(e){var t;return t=f.KiiUser.userWithID(e)},e.prototype._setOwnerFromContext=function(e){return null!=f.Kii.getCurrentUser()?(this._owner=f.Kii.getCurrentUser(),e.owner=this._owner.getUUID()):void 0},e.prototype.topicWithName=function(e){var t,i;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");if(t=this.getID(),!t)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopic(i,e)},e.prototype.listTopics=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,t)}}(this))},e.prototype._listTopicsUsingCallbacks=function(e,t){var i,n,r;return n=""+this._getHttpURI()+"/topics","string"==typeof t&&""!==t&&(n=n+"?paginationKey="+encodeURIComponent(t)),r=h.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(t){return function(){var i,n,s,o,u,a;for(i=JSON.parse(r.xhr.responseText),s=[],a=i.topics,o=0,u=a.length;u>o;o++)n=a[o],s.push(t.topicWithName(n.topicID));return null!=e?e.success(s,void 0===i.paginationKey?null:i.paginationKey):void 0}}(this),failure:function(t){return function(){var i,n;return n=r.getErrorString("list topics"),i=l._Error(n,t),null!=e?e.failure(i):void 0}}(this)},r.send(i)},e.prototype._getHttpURI=function(){return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/groups/"+this.getID()},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e}(),f.KiiObject=function(){function e(){this._deleteBodyUsingCallbacks=y(this._deleteBodyUsingCallbacks,this),this.deleteBody=y(this.deleteBody,this),this._publishBodyExpiresInUsingCallbacks=y(this._publishBodyExpiresInUsingCallbacks,this),this.publishBodyExpiresIn=y(this.publishBodyExpiresIn,this),this._publishBodyExpiresAtUsingCallbacks=y(this._publishBodyExpiresAtUsingCallbacks,this),this.publishBodyExpiresAt=y(this.publishBodyExpiresAt,this),this._publishBodyUsingCallbacks=y(this._publishBodyUsingCallbacks,this),this.publishBody=y(this.publishBody,this),this._downloadBodyUsingCallbacks=y(this._downloadBodyUsingCallbacks,this),this.downloadBody=y(this.downloadBody,this),this._uploadBodyUsingCallbacks=y(this._uploadBodyUsingCallbacks,this),this.uploadBody=y(this.uploadBody,this),this._moveBodyUsingCallbacks=y(this._moveBodyUsingCallbacks,this),this.moveBody=y(this.moveBody,this),this._parseObjectUri=y(this._parseObjectUri,this),this._userWithID=y(this._userWithID,this),this._setAuthorizationHeader=y(this._setAuthorizationHeader,this),this._getToken=y(this._getToken,this),this._getRequest=y(this._getRequest,this),this._setETag=y(this._setETag,this),this._deleteUsingCallbacks=y(this._deleteUsingCallbacks,this),this["delete"]=y(this["delete"],this),this._refreshUsingCallbacks=y(this._refreshUsingCallbacks,this),this.refresh=y(this.refresh,this),this._saveUsingCallbacks=y(this._saveUsingCallbacks,this),this.save=y(this.save,this),this._saveAllFieldsUsingCallbacks=y(this._saveAllFieldsUsingCallbacks,this),this.saveAllFields=y(this.saveAllFields,this),this._performUpdate=y(this._performUpdate,this),this._performSave=y(this._performSave,this),this._updateWithJSON=y(this._updateWithJSON,this),this._convertToObjectType=y(this._convertToObjectType,this),this.objectURI=y(this.objectURI,this),this.objectACL=y(this.objectACL,this),this.getGeoPoint=y(this.getGeoPoint,this),this.setGeoPoint=y(this.setGeoPoint,this),this.get=y(this.get,this),this.set=y(this.set,this),this._getPath=y(this._getPath,this),this._setBodyContentType=y(this._setBodyContentType,this),this.getBodyContentType=y(this.getBodyContentType,this),this._setBucket=y(this._setBucket,this),this.getBucket=y(this.getBucket,this),this._setObjectType=y(this._setObjectType,this),this.getObjectType=y(this.getObjectType,this),this._setModified=y(this._setModified,this),this.getModified=y(this.getModified,this),this._setCreated=y(this._setCreated,this),this.getCreated=y(this.getCreated,this),this.getID=y(this.getID,this),this._setUUID=y(this._setUUID,this),this.getUUID=y(this.getUUID,this),this._customInfo={},this._alteredFields=[]}return e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getID=function(){return this._uuid},e.prototype.getCreated=function(){return this._created},e.prototype._setCreated=function(e){this._created=e},e.prototype.getModified=function(){return this._modified},e.prototype._setModified=function(e){this._modified=e},e.prototype.getObjectType=function(){return this._objectType},e.prototype._setObjectType=function(e){this._objectType=e},e.prototype.getBucket=function(){return f.Kii.logger("GEtting bucket "+this._bucket),this._bucket},e.prototype._setBucket=function(e){this._bucket=e},e.prototype.getBodyContentType=function(){return this._bodyContentType},e.prototype._setBodyContentType=function(e){this._bodyContentType=e},e.prototype._getPath=function(){var e;return e=null!=this._bucket.getUser()?"/users/"+this._bucket.getUser().getUUID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":null!=this._bucket.getGroup()?"/groups/"+this._bucket.getGroup().getUUID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":null!=this._bucket.getThing()?"/things/"+this._bucket.getThing().getThingID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/",null!=this._uuid&&(e+=this._uuid),e},e.prototype.set=function(e,t){return l._isNonEmptyString(e)&&0!==e.indexOf("_")?(this._customInfo[e]=t,this._alteredFields.push(e)):void f.Kii.logger("[WARN] Reserved key is used for custom field. key="+e)},e.prototype.get=function(e){return this._customInfo[e]},e.prototype.setGeoPoint=function(e,t){if(!(t instanceof f.KiiGeoPoint))throw f.InvalidArgumentException("Specified kiiGeoPoint is not an instance of KiiGeoPoint");return this._customInfo[e]=t._toDict(),this._alteredFields.push(e)},e.prototype.getGeoPoint=function(e){var t,i,n;return n=this._customInfo[e],t=n.lat,i=n.lon,f.KiiGeoPoint.geoPoint(t,i)},e.prototype.objectACL=function(){return f.KiiACL.aclWithParent(this)},e.prototype.objectURI=function(){var e,t;return e="kiicloud://",null!=this._bucket&&null!=this._uuid&&(t=e,null!=this._bucket.getGroup()?t+="groups/"+this._bucket.getGroup().getUUID()+"/":null!=this._bucket.getUser()?t+="users/"+this._bucket.getUser().getUUID()+"/":null!=this._bucket.getThing()&&(t+="things/"+this._bucket.getThing().getThingID()+"/"),t+="buckets/"+this._bucket._getQualifiedBucketName()+"/objects/"+this._uuid),t},e.prototype._convertToObjectType=function(e){var t;return"application/json"===e?{success:!0,type:null}:(t=e.match(RegExp("$application/vnd\\."+f.Kii.getAppID()+"\\.([^\\.])+\\+json")),null!=t?{success:!0,type:t}:{success:!1,type:null})},e.prototype._updateWithJSON=function(e){var t,i,n;n=[];for(t in e)i=e[t],"_id"===t?null==this._uuid?(f.Kii.logger("Setting uuid: "+i),n.push(this._uuid=i)):n.push(void 0):"_created"===t?n.push(this._created=i):"_modified"===t?n.push(this._modified=i):"_owner"===t?n.push(this._owner=this._userWithID(i)):"_dataType"===t?n.push(this._objectType=i):"_calculated"===t?n.push(this._customInfo[t]=i):"_"!==t[0]?n.push(this._customInfo[t]=i):"_version"===t?n.push(this._etag=i):n.push(void 0);return n},e.prototype._performSave=function(e){var t,i,n,r;return i=this._getPath(),i=i.slice(0,+(i.length-2)+1||9e9),n=new this._getRequest({path:i,withApp:!0}),n.setMethod("POST"),t=this._customInfo,n.setData(t),null!=this._objectType&&n.setContentType("application/vnd."+f.Kii.getAppID()+"."+this._objectType+"+json"),r={success:function(t){return function(i,n,r){var s;if(300>n&&n>=200){if(t._etag=r.etag,null==i.objectID)return e.failure(t,"No objectID response");if(t._uuid=i.objectID,null!=i.createdAt&&(t._created=i.createdAt),null!=i.dataType&&(s=t._convertToObjectType(i.dataType),s.success&&(t._objectType=s.type)),t._modified=t._created,t._alteredFields=[],null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!1)},e.prototype._performUpdate=function(e,t,i){var n,r,s,o,u,a,l,c,h;if(o=this._getPath(),u=new this._getRequest({path:o,withApp:!0}),n={},e)for(u.addHeader("X-HTTP-Method-Override","PATCH"),u.setMethod("POST"),h=this._alteredFields,l=0,c=h.length;c>l;l++)s=h[l],n[s]=this._customInfo[s];else u.setMethod("PUT"),n=this._customInfo;if(u.setData(n),r=this._created>0,!i)if(r){if(null==this._etag)return void t.failure(this,"IllegalState! Call KiiObject#refresh() prior call this method.");u.addHeader("If-Match",this._etag)}else{if(e&&null==this._etag)return void t.failure(this,"IllegalState! Call KiiObject#refresh() prior call this method.");u.addHeader("If-None-Match","*")}return null!=this._objectType&&u.setContentType("application/vnd."+f.Kii.getAppID()+"."+this._objectType+"+json"),a={success:function(i){return function(n,r,s){if(300>r&&r>=200){if(i._etag=s.etag,e?i._updateWithJSON(n):(null!=n.createdAt&&(i._created=n.createdAt),null!=n.modifiedAt&&(i._modified=n.modifiedAt)),i._alteredFields=[],null!=t)return t.success(i)}else if(null!=t)return t.failure(i,"Unable to parse response")}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},u.execute(a,!1)},e.prototype.saveAllFields=function(e,t){return null==t&&(t=!0),new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._saveAllFieldsUsingCallbacks(s,t)}}(this))},e.prototype._saveAllFieldsUsingCallbacks=function(e,t){return null==t&&(t=!0),null!=this._uuid?this._performUpdate(!1,e,t):this._performSave(e)},e.prototype.save=function(e,t){return null==t&&(t=!0),new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(l._Error(arguments[1],i))}},i._saveUsingCallbacks(s,t)}}(this))},e.prototype._saveUsingCallbacks=function(e,t){return null==t&&(t=!0),null!=this._uuid?this._performUpdate(!0,e,t):this._performSave(e)},e.prototype.refresh=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._refreshUsingCallbacks(r)}}(this))},e.prototype._refreshUsingCallbacks=function(e){var t,i,n;return t=this._getPath(),n=new this._getRequest({path:t,withApp:!0}),i={success:function(t){return function(i,n,r){if(300>n&&n>=200){if(t._etag=r.etag,t._updateWithJSON(i),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(i,!1)},e.prototype["delete"]=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._deleteUsingCallbacks(r)}}(this))},e.prototype._deleteUsingCallbacks=function(e){var t,i,n;return t=this._getPath(),n=new this._getRequest({path:t,withApp:!0}),n.setMethod("DELETE"),i={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(i,!0)},e.objectWithBucket=function(e,t){var i;return f.Kii.logger("Creating object w type: "+t),i=new f.KiiObject,i._setBucket(e),i._setObjectType(t),f.Kii.logger(i),i},e.objectWithID=function(e,t){var i;return f.Kii.logger("Creating object with id: "+t),i=new f.KiiObject,i._setBucket(e),i._setUUID(t),f.Kii.logger(i),i},e.prototype._setETag=function(e){this._etag=e},e.objectWithURI=function(e){var t,i,n,r,s,o,u,a;if(o=e.substr("kiicloud://".length),s=o.split("/"),r=s.length,f.Kii.logger(s),!(r>=4))throw new f.InvalidURIException;return i=4===r?1:3,n=s[i],a=null,"groups"===s[0]?a=new f.KiiGroup.groupWithID(s[1]):"users"===s[0]?a=f.KiiUser.userWithID(s[1]):"things"===s[0]&&(a=f.KiiThing.thingWithID(s[1])),t=null,t=f.KiiEncryptedBucket._isEncrypted(n)?new f.KiiEncryptedBucket._bucketWithName(n,a):new f.KiiBucket._bucketWithName(n,a),f.Kii.logger(t),u=t.createObject(),u._setUUID(s[r-1]),f.Kii.logger(u),u},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.prototype._getToken=function(){var e,t;return e=f.KiiUser.getCurrentUser(),t=e?e.getAccessToken():null,t?t:null},e.prototype._setAuthorizationHeader=function(e){var t;return t=this._getToken(),t?e.setRequestHeader("Authorization","Bearer "+t):void 0},e.prototype._userWithID=function(e){var t;return t=f.KiiUser.userWithID(e)},e.prototype._parseObjectUri=function(e){var t,i,n,r;if(n=e.replace(/^kiicloud:\/\//g,"").split("/"),r=n[0],"users"===r)i={appID:f.Kii.getAppID(),userID:n[1],type:"APP_AND_USER"},t=f.KiiEncryptedBucket._isEncrypted(n[3])?{targetObjectScope:i,targetBucketType:"crypto",targetBucketID:n[3].replace("CRYPTO:",""),targetObjectID:n[5]}:{targetObjectScope:i,targetBucketID:n[3],targetObjectID:n[5]};else if("groups"===r)i={appID:f.Kii.getAppID(),groupID:n[1],type:"APP_AND_GROUP"},t=f.KiiEncryptedBucket._isEncrypted(n[3])?{targetObjectScope:i,targetBucketType:"crypto",targetBucketID:n[3].replace("CRYPTO:",""),targetObjectID:n[5]}:{targetObjectScope:i,targetBucketID:n[3],targetObjectID:n[5]};else{if("things"===r)throw new f.InvalidURIException;i={appID:f.Kii.getAppID(),type:"APP"},t=f.KiiEncryptedBucket._isEncrypted(n[1])?{targetObjectScope:i,targetBucketType:"crypto",targetBucketID:n[1].replace("CRYPTO:",""),targetObjectID:n[3]}:{targetObjectScope:i,targetBucketID:n[1],targetObjectID:n[3]}}return t},e.prototype.moveBody=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){var e;return null!=t&&t.failure.apply(t,arguments),e=l._Error(arguments[2],i),e.targetObjectUri=arguments[1],r(e)}},i._moveBodyUsingCallbacks(e,s)}}(this))},e.prototype._moveBodyUsingCallbacks=function(e,t){var i,n,r,s;if(null==e)return t.failure(this,null,f.InvalidArgumentException("targetObjectUri is required"));if(null==this.getUUID())return t.failure(this,e,f.InvalidArgumentException("Source object is not saved on the cloud"));r=this._getPath()+"/body/move",s=new this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.ObjectBodyMoveRequest+json");try{s.setData(this._parseObjectUri(e))}catch(o){return i=o,t.failure(this,e,"Not support to move body of thing scope object.")}return n={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?t.success(i,e):null!=t?t.failure(i,e,"Unable to parse response"):void 0}}(this),failure:function(i){return function(n,r){return null!=t?t.failure(i,e,n):void 0}}(this)},s.execute(n,!0)},e.prototype.uploadBody=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){var e;return null!=t&&null!=(e=t.success)&&e.apply(t,arguments),n(arguments[0])},failure:function(){var e;return null!=t&&null!=(e=t.failure)&&e.apply(t,arguments),r(l._Error(arguments[1],i))},progress:function(){var e;return null!=t&&null!=(e=t.progress)?e.apply(t,arguments):void 0}},i._uploadBodyUsingCallbacks(e,s)}}(this))},e.prototype._uploadBodyUsingCallbacks=function(e,t){var i,n,r,s,o;return e&&e instanceof Blob?(r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",i="application/octet-stream",e.type&&(i=e.type),s=h.createXHRWrapper("PUT",r),o=s.xhr,o.setRequestHeader("Content-Type",i),o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(o),n={success:function(e){return function(){var n;return n=JSON.parse(o.responseText),null!=n.modifiedAt&&(e._modified=n.modifiedAt),e._setBodyContentType(i),null!=t?t.success(e):void 0}}(this),failure:function(e){return function(){var i,n;if(i="failed to upload body. statusCode: "+o.status,null!=t)try{if(n=JSON.parse(decodeURIComponent(o.responseText)),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" message: "+n.message}catch(r){}finally{f.Kii.logger("Failure: "+i),f.Kii.logger(o.responseText),t.failure(e,i)}}}(this),progress:function(e){return function(e){return t&&t.progress?t.progress(e):void 0}}(this)},s.sendData(e,n)):void t.failure(this,"Invalid parameter")},e.prototype.downloadBody=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){var t;return null!=e&&null!=(t=e.success)&&t.apply(e,arguments),i(arguments)},failure:function(){var i;return null!=e&&null!=(i=e.failure)&&i.apply(e,arguments),n(l._Error(arguments[1],t))},progress:function(){var t;return null!=e&&null!=(t=e.progress)?t.apply(e,arguments):void 0}},t._downloadBodyUsingCallbacks(r)}}(this))},e.prototype._downloadBodyUsingCallbacks=function(e){var t,i,n,r;return i=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",n=h.createXHRWrapper("GET",i),r=n.xhr,r.setRequestHeader("x-kii-appid",f.Kii.getAppID()),r.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),r.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(r),r.responseType="blob",t={success:function(t){return function(){var i;return i=r.status,t._setBodyContentType(r.getResponseHeader("content-type")),null!=e?e.success(t,r.response):void 0}}(this),failure:function(t){return function(){var i,n,s,o;return null!=e?(i="failed to download body. statusCode: "+r.status,n=new FileReader,o=null,s=t,n.onload=function(){var t;o=this.result;try{if(t=JSON.parse(decodeURIComponent(o)),null!=t.errorCode&&(i+=" error code: "+t.errorCode),null!=t.message)return i+=" message: "+t.message}catch(n){}finally{f.Kii.logger("Failure: "+i),f.Kii.logger(r.response),e.failure(s,i)}},n.readAsText(r.response)):void 0}}(this),progress:function(t){return function(t){return e&&e.progress?e.progress(t):void 0}}(this)},n.send(t)},e.prototype.publishBody=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._publishBodyUsingCallbacks(r)}}(this))},e.prototype._publishBodyUsingCallbacks=function(e){var t,i,n,r,s,o;return r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",s=h.createXHRWrapper("POST",r),o=s.xhr,o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),o.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(o),n={success:function(t){return function(){var i;if(null!=e)try{return i=JSON.parse(o.responseText),i.url?e.success(t,i.url):e.failure(t,"failed to parse response")}catch(n){return e.failure(t,"failed to parse response")}}}(this),failure:function(t){return function(){var i,n;if(null!=e){i="failed to publish body. statusCode: "+o.status;try{if(n=JSON.parse(o.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{e.failure(t,i)}}}}(this)},i={},t=JSON.stringify(i),s.sendData(t,n)},e.prototype.publishBodyExpiresAt=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._publishBodyExpiresAtUsingCallbacks(e,s)}}(this))},e.prototype._publishBodyExpiresAtUsingCallbacks=function(e,t){var i,n,r,s,o,u;return s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",o=h.createXHRWrapper("POST",s),u=o.xhr,u.setRequestHeader("x-kii-appid",f.Kii.getAppID()),u.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),u.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),u.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(u),r={success:function(e){return function(){var i;if(null!=t)try{return i=JSON.parse(u.responseText),i.url?t.success(e,i.url):t.failure(e,"failed to parse response")}catch(n){return t.failure(e,"failed to parse response")}}}(this),failure:function(e){return function(){var i,n;if(null!=t){i="failed to publish body. statusCode: "+u.status,null==u.responseText&&(t.failure(e,i),retunr);try{if(n=JSON.parse(u.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{t.failure(e,i)}}}}(this)},n={},n.expiresAt=e,i=JSON.stringify(n),o.sendData(i,r)},e.prototype.publishBodyExpiresIn=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._publishBodyExpiresInUsingCallbacks(e,s)}}(this))},e.prototype._publishBodyExpiresInUsingCallbacks=function(e,t){var i,n,r,s,o,u;return s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",o=h.createXHRWrapper("POST",s),u=o.xhr,u.setRequestHeader("x-kii-appid",f.Kii.getAppID()),u.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),u.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),u.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(u),r={success:function(e){return function(){var i;try{return i=JSON.parse(u.responseText),i.url?t.success(e,i.url):t.failure(e,"failed to parse response")}catch(n){return t.failure(e,"failed to parse response")}}}(this),failure:function(e){return function(){var i,n;i="failed to publish body. statusCode: "+u.status;try{if(n=JSON.parse(u.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{t.failure(e,i)}}}(this)},n={},n.expiresIn=e,i=JSON.stringify(n),o.sendData(i,r)},e.prototype.deleteBody=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._deleteBodyUsingCallbacks(r)}}(this))},e.prototype._deleteBodyUsingCallbacks=function(e){var t,i,n,r;return i=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",n=h.createXHRWrapper("DELETE",i),r=n.xhr,r.setRequestHeader("x-kii-appid",f.Kii.getAppID()),r.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),r.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(r),t={success:function(t){return function(){return t._setBodyContentType(null),null!=e?e.success(t):void 0}}(this),failure:function(t){return function(){var i,n;if(null!=e){i="failed to delete body. statusCode: "+r.status;try{if(n=JSON.parse(r.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),
null!=n.message)return i+=" error message: "+n.message}catch(s){}finally{e.failure(t,i)}}}}(this)},n.send(t)},e.isValidObjectID=function(e){var t;return t=/^[a-zA-Z0-9-_.]{2,100}$/i,"string"!==(typeof e).toLowerCase()?!1:null!==e.match(t)},e}(),f.KiiQuery=function(){function e(e){return this._dictValue=y(this._dictValue,this),this.sortByAsc=y(this.sortByAsc,this),this.sortByDesc=y(this.sortByDesc,this),this.setLimit=y(this.setLimit,this),this.getLimit=y(this.getLimit,this),this._setClause=y(this._setClause,this),this.setPaginationKey=y(this.setPaginationKey,this),this.getPaginationKey=y(this.getPaginationKey,this),this._clone=y(this._clone,this),this._clone(e)}return e.prototype._clone=function(e){var t,i;if(null==e||"object"!=typeof e)return e;i=new e.constructor;for(t in e)i[t]=this._clone(e[t]);return i},e.prototype.getPaginationKey=function(){return this._paginationKey},e.prototype.setPaginationKey=function(e){this._paginationKey=e},e.prototype._setClause=function(e){this._clause=e},e.prototype.getLimit=function(){return this._limit},e.prototype.setLimit=function(e){if(e>0)return this._limit=e;throw new f.InvalidLimitException},e.queryWithClause=function(e){var t;return t=new f.KiiQuery,t._setClause(e),t},e.prototype.sortByDesc=function(e){return this._sortField=e,this._sortDescending=!0},e.prototype.sortByAsc=function(e){return this._sortField=e,this._sortDescending=!1},e._emptyDictValue=function(){return{type:"all"}},e.prototype._dictValue=function(){var e,t;return t={},t.bestEffortLimit=this._limit,null!=this._paginationKey&&(t.paginationKey=this._paginationKey),e={descending:this._sortDescending},null!=this._clause?e.clause=this._clause._getDictValue():e.clause=f.KiiQuery._emptyDictValue(),null!=this._sortField&&(e.orderBy=this._sortField),t.bucketQuery=e,t},e}(),f.KiiClause=function(){function e(){this._getDictValue=y(this._getDictValue,this),this._setDictValue=y(this._setDictValue,this),this._setWhereClauses=y(this._setWhereClauses,this),this._setWhereType=y(this._setWhereType,this)}return e.constructor=function(){return e._whereClauses=[],e._dictExpression={}},e.prototype._setWhereType=function(e){this._whereType=e},e.prototype._setWhereClauses=function(e){this._whereClauses=e},e.prototype._setDictValue=function(e){this._dictExpression=e},e.prototype._getDictValue=function(){var e,t,i,n,r,s;if(i={},null!=this._whereClauses&&null!=this._whereType)if(t=[],1===this._whereClauses.length)e=this._whereClauses[0],i="not"===this._whereType?{type:this._whereType,clause:e._getDictValue()}:e._getDictValue();else{for(s=this._whereClauses,n=0,r=s.length;r>n;n++)e=s[n],t.push(e._getDictValue());i={type:this._whereType,clauses:t}}else null!=this._whereClauses?this._whereClauses.length>0&&(i=this._whereClauses[0]._getDictValue()):null!=this._dictExpression&&(i=this._dictExpression);return null==i&&(i=f.KiiQuery.emptyDictValue()),i},e.createWithWhere=function(e,t){var i;return i=new f.KiiClause,i._setWhereType(e),i._setWhereClauses(t),i},e.create=function(e,t,i){var n,r;return n=new f.KiiClause,r={},"="===e?(r.type="eq",r.field=t,r.value=i):"<"===e?(r.type="range",r.field=t,r.upperLimit=i,r.upperIncluded=!1):"<="===e?(r.type="range",r.field=t,r.upperLimit=i,r.upperIncluded=!0):">"===e?(r.type="range",r.field=t,r.lowerLimit=i,r.lowerIncluded=!1):">="===e?(r.type="range",r.field=t,r.lowerLimit=i,r.lowerIncluded=!0):"in"===e?(r.type="in",r.field=t,r.values=i):"prefix"===e&&(r.type="prefix",r.field=t,r.prefix=i),n._setDictValue(r),n},e.and=function(){return e.createWithWhere("and",arguments)},e.or=function(){return e.createWithWhere("or",arguments)},e.equals=function(e,t){return null!=t._className&&(t=t.objectURI),f.KiiClause.create("=",e,t)},e.notEquals=function(e,t){return null!=t._className&&(t=t.objectURI),f.KiiClause.createWithWhere("not",[f.KiiClause.equals(e,t)])},e.greaterThan=function(e,t){return f.KiiClause.create(">",e,t)},e.greaterThanOrEqual=function(e,t){return f.KiiClause.create(">=",e,t)},e.lessThan=function(e,t){return f.KiiClause.create("<",e,t)},e.lessThanOrEqual=function(e,t){return f.KiiClause.create("<=",e,t)},e["in"]=function(e,t){return f.KiiClause.create("in",e,t)},e.inClause=function(e,t){return f.KiiClause.create("in",e,t)},e.startsWith=function(e,t){return f.KiiClause.create("prefix",e,t)},e.geoDistance=function(e,t,i,n){var r,s,o,u,a;if(o=function(e){return"string"==typeof e&&e.length>0},s=function(e){return null==e?!1:e instanceof f.KiiGeoPoint},!o(e))throw f.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!s(t))throw f.InvalidArgumentException("center is not a reference of KiiGeoPoint.");if(u="^[a-zA-Z_][a-zA-Z0-9_]*$",null!=n&&!n.match(u))throw f.InvalidArgumentException("putDistanceInto is invalid.");if(0>=i||i>2e7||isNaN(i))throw f.InvalidArgumentException("radius is invalid.");return r=new f.KiiClause,a={},a.type="geodistance",a.field=e,t=t._toDict(),a.center=t,a.radius=i,a.putDistanceInto=n,r._setDictValue(a),r},e.geoBox=function(e,t,i){var n,r,s,o,u,a;if(s=function(e){return"string"==typeof e&&e.length>0},r=function(e){return null==e?!1:e instanceof f.KiiGeoPoint},!s(e))throw f.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!r(t)||!r(i))throw f.InvalidArgumentException("northEast or southWest is not a reference of KiiGeoPoint.");return n=new f.KiiClause,a={},a.type="geobox",a.field=e,o=t._toDict(),u=i._toDict(),a.box={ne:o,sw:u},n._setDictValue(a),n},e}(),o=function(){function e(e,t){this.execute=y(this.execute,this),this.setAdminToken=y(this.setAdminToken,this),this.addHeader=y(this.addHeader,this),this.setAccept=y(this.setAccept,this),this.getAccept=y(this.getAccept,this),this.setAnonymous=y(this.setAnonymous,this),this.isAnonymous=y(this.isAnonymous,this),this.setContentType=y(this.setContentType,this),this.getContentType=y(this.getContentType,this),this.setData=y(this.setData,this),this.getData=y(this.getData,this),this.setHeaders=y(this.setHeaders,this),this.getHeaders=y(this.getHeaders,this),this.setMethod=y(this.setMethod,this),this.getMethod=y(this.getMethod,this),this.setPath=y(this.setPath,this),this.getPath=y(this.getPath,this),this._path=t?"/apps/"+f.Kii.getAppID()+e:e,this._method="GET",this._headers={accept:"*/*"},this._contentType="application/json",this._anonymous=!1,this._success=function(e){return function(){}}(this),this._failure=function(e){return function(){}}(this),this._httpRequest=null}return e.prototype.getPath=function(){return this._path},e.prototype.setPath=function(e){this._path=e},e.prototype.getMethod=function(){return this._method},e.prototype.setMethod=function(e){this._method=e},e.prototype.getHeaders=function(){return this._headers},e.prototype.setHeaders=function(e){this._headers=e},e.prototype.getData=function(){return this._data},e.prototype.setData=function(e){this._data=e},e.prototype.getContentType=function(){return this._contentType},e.prototype.setContentType=function(e){this._contentType=e},e.prototype.isAnonymous=function(){return this._anonymous},e.prototype.setAnonymous=function(e){this._anonymous=e},e.prototype.getAccept=function(){return this._accept},e.prototype.setAccept=function(e){this._accept=e},e.prototype.addHeader=function(e,t){return this._headers[e]=t},e.prototype.setAdminToken=function(e){return this._adminToken=e},e.prototype.execute=function(e,t){var i,n,r,s,o,u,a;if(this._success=null!=e.success?e.success:this._success,this._failure=null!=e.failure?e.failure:this._failure,this._ignoreBody=t,o=f.Kii.getBaseURL()+this._path,f.Kii.logger("POSTING: "),f.Kii.logger(this._data),s=l._isJSONType(this._contentType)?JSON.stringify(this._data):this._data,f.Kii.logger("Making request["+this._method+"] to "+o+" with data: "+s),i=f.Kii.getAdditionalHeaders(),null!=i)for(r in i)u=i[r],this._headers[r]=u;this._headers["x-kii-appid"]=f.Kii.getAppID(),this._headers["x-kii-appkey"]=f.Kii.getAppKey(),this._headers["x-kii-sdk"]=f.KiiSDKClientInfo.getSDKClientInfo(),null!=this._accept&&(this._headers.accept=this._accept),this._anonymous||null==f.KiiUser.getCurrentUser()||(this._headers.Authorization="Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),null!=this._adminToken&&(this._headers.Authorization="Bearer "+this._adminToken),null!=this._contentType&&(this._headers["Content-Type"]=this._contentType),f.Kii.logger("Headers: "),f.Kii.logger(this._headers),e={onComplete:function(e){return function(){var t,i,n,r,s,o,u;if(o=e._httpRequest.xhr,4===o.readyState){if(200<=(u=o.status)&&400>u){if(f.Kii.logger("Completed Request["+o.status+"]"),f.Kii.logger(o.responseText),s=e._parseResponseHeaders(o.getAllResponseHeaders()),e._ignoreBody)return e._success(null,o.status);try{r=JSON.parse(o.responseText)}catch(a){t=a,r=null}return null!=r?null!=r.errorCode?(i=r.errorCode,null!=r.message&&(i+=": "+r.message),e._failure(i,o.status,r.errorCode)):e._success(r,o.status,s):e._success(null,o.status,null)}f.Kii.logger("Error loading data..."),i=o.status+" : "+f.Kii.getBaseURL()+e._path;try{r=JSON.parse(decodeURIComponent(o.responseText))}catch(a){n=a,r=null}return null!=r&&null!=r.errorCode&&(i=r.errorCode,null!=r.message&&(i+=": "+r.message)),f.Kii.logger("Failure: "+i),f.Kii.logger(o.responseText),e._failure(i,o.status)}}}(this),onError:function(e){return function(){var t,i,n,r;r=e._httpRequest.xhr,f.Kii.logger("Error loading data..."),t=r.status+" : "+f.Kii.getBaseURL()+e._path;try{n=JSON.parse(decodeURIComponent(r.responseText))}catch(s){i=s,n=null}return null!=n&&null!=n.errorCode&&(t=n.errorCode,null!=n.message&&(t+=": "+n.message)),f.Kii.logger("Failure: "+t),f.Kii.logger(r.responseText),e._failure(t,r.status)}}(this)},this._httpRequest=this._createHttpRequest(this._method,o,e),null==this._httpRequest.xhr&&this._failure("Cross-Origin Resource Sharing is not supported by the browser.",0),a=this._headers;for(n in a)u=a[n],this._httpRequest.xhr.setRequestHeader(n,u);return"GET"!==this._method&&"DELETE"!==this._method?this._httpRequest.xhr.send(s):this._httpRequest.xhr.send()},e.prototype._createHttpRequest=function(e,t,i){var n;return n=null,null===f.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(f.Kii.logger("Use jQuery"),n=new s(e,t,i)):"undefined"!=typeof XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),n=new p(e,t,i)):"undefined"!=typeof Titanium&&(f.Kii.logger("Use Titanium"),n=new a(e,t,i)):(f.Kii.logger("Use http request backdoor"),f.Kii._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.Kii.logger("Use jQuery"),n=new s(e,t,i)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),n=new p(e,t,i)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),n=new a(e,t,i))),n},e.prototype._parseResponseHeaders=function(e){var t,i,n,r,s,o,u;if(n={},!e)return n;for(i=e.split("\r\n"),r=0;r<i.length;)t=i[r],s=t.indexOf(": "),s>0&&(o=t.substring(0,s).toLowerCase(),u=t.substring(s+2),n[o]=u),r++;return n},e}(),f.KiiUser=function(){function e(){this._setAuthToken=y(this._setAuthToken,this),this._getHttpURI=y(this._getHttpURI,this),this._clone=y(this._clone,this),this._getSubscriberPath=y(this._getSubscriberPath,this),this.pushInstallation=y(this.pushInstallation,this),this.pushSubscription=y(this.pushSubscription,this),this._listTopicsUsingCallbacks=y(this._listTopicsUsingCallbacks,this),this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this._groupWithJSON=y(this._groupWithJSON,this),this._setAuthHeader=y(this._setAuthHeader,this),this._getXhrWrapper=y(this._getXhrWrapper,this),this._getRequest=y(this._getRequest,this),this._updateWithJSON=y(this._updateWithJSON,this),this._validateLocalPhoneNumber=y(this._validateLocalPhoneNumber,this),this._validateIdentityData=y(this._validateIdentityData,this),this._updateWithUserFields=y(this._updateWithUserFields,this),this._updateWithIdentityData=y(this._updateWithIdentityData,this),this._deleteUsingCallbacks=y(this._deleteUsingCallbacks,this),this["delete"]=y(this["delete"],this),this._refreshUsingCallbacks=y(this._refreshUsingCallbacks,this),this.refresh=y(this.refresh,this),this._saveUsingCallbacks=y(this._saveUsingCallbacks,this),this.save=y(this.save,this),this._changeEmailUsingCallbacks=y(this._changeEmailUsingCallbacks,this),this.changeEmail=y(this.changeEmail,this),this._changePhoneUsingCallbacks=y(this._changePhoneUsingCallbacks,this),this.changePhone=y(this.changePhone,this),this._ownerOfGroupsUsingCallbacks=y(this._ownerOfGroupsUsingCallbacks,this),this.ownerOfGroups=y(this.ownerOfGroups,this),this._memberOfGroupsUsingCallbacks=y(this._memberOfGroupsUsingCallbacks,this),this.memberOfGroups=y(this.memberOfGroups,this),this.resendPhoneNumberVerification=y(this.resendPhoneNumberVerification,this),this.resendEmailVerification=y(this.resendEmailVerification,this),this._resendVerificationUsingCallbacks=y(this._resendVerificationUsingCallbacks,this),this.resendVerification=y(this.resendVerification,this),this.verifyPhoneNumber=y(this.verifyPhoneNumber,this),this._verifyCredentialsUsingCallbacks=y(this._verifyCredentialsUsingCallbacks,this),this.verifyCredentials=y(this.verifyCredentials,this),this._updatePasswordUsingCallbacks=y(this._updatePasswordUsingCallbacks,this),this.updatePassword=y(this.updatePassword,this),this._updateUsingCallbacks=y(this._updateUsingCallbacks,this),this.update=y(this.update,this),this._putIdentityUsingCallbacks=y(this._putIdentityUsingCallbacks,this),this.putIdentity=y(this.putIdentity,this),this._registerUsingCallbacks=y(this._registerUsingCallbacks,this),this.register=y(this.register,this),this._authenticateWithToken=y(this._authenticateWithToken,this),this._authenticate=y(this._authenticate,this),this.encryptedBucketWithName=y(this.encryptedBucketWithName,this),this.bucketWithName=y(this.bucketWithName,this),this.get=y(this.get,this),this.set=y(this.set,this),this.objectURI=y(this.objectURI,this),this.getAccessTokenObject=y(this.getAccessTokenObject,this),this._setExpiresAt=y(this._setExpiresAt,this),this._setAccessToken=y(this._setAccessToken,this),this.getAccessToken=y(this.getAccessToken,this),this.getLinkedSocialAccounts=y(this.getLinkedSocialAccounts,this),this._setPhoneVerified=y(this._setPhoneVerified,this),this.getPhoneVerified=y(this.getPhoneVerified,this),this._setEmailVerified=y(this._setEmailVerified,this),this.getEmailVerified=y(this.getEmailVerified,this),this._setModified=y(this._setModified,this),this.getModified=y(this.getModified,this),this._setCreated=y(this._setCreated,this),this.getCreated=y(this.getCreated,this),this.setCountry=y(this.setCountry,this),this.getCountry=y(this.getCountry,this),this._clearPassword=y(this._clearPassword,this),this._setPassword=y(this._setPassword,this),this._setLocalPhone=y(this._setLocalPhone,this),this._setPhoneNumber=y(this._setPhoneNumber,this),this.getPhoneNumber=y(this.getPhoneNumber,this),this._setEmailAddress=y(this._setEmailAddress,this),this.getEmailAddress=y(this.getEmailAddress,this),this.isPseudoUser=y(this.isPseudoUser,this),this.setDisplayName=y(this.setDisplayName,this),this.getDisplayName=y(this.getDisplayName,this),this._setDisabled=y(this._setDisabled,this),this.disabled=y(this.disabled,this),this._setUsername=y(this._setUsername,this),this.getUsername=y(this.getUsername,this),this.getID=y(this.getID,this),this._setUUID=y(this._setUUID,this),this.getUUID=y(this.getUUID,this),this._customInfo={}}return e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getID=function(){return this._uuid},e.prototype.getUsername=function(){return this._username},e.prototype._setUsername=function(e){var t;if(t=l._trim(e),f.Kii.logger("Setting username: "+t),l._validateUsername(t))return this._username=t;throw new f.InvalidUsernameException},e.prototype.disabled=function(){return this._disabled},e.prototype._setDisabled=function(e){this._disabled=e},e.prototype.getDisplayName=function(){return this._displayName},e.prototype.setDisplayName=function(e){if(!l._validateDisplayName(e))throw new f.InvalidDisplayNameException;return this._displayName=e},e.prototype.isPseudoUser=function(){return null!=this._hasPassword?!this._hasPassword:!this._username&&!this._emailAddress&&!this._phoneNumber},e.prototype.getEmailAddress=function(){return this._emailAddress},e.prototype._setEmailAddress=function(e){var t;if(t=l._trim(e),f.Kii.logger("Setting email: "+t),l._validateEmail(t))return this._emailAddress=t;throw new f.InvalidEmailException},e.prototype.getPhoneNumber=function(){return this._phoneNumber},e.prototype._setPhoneNumber=function(e){if(f.Kii.logger("Setting phone number: "+e),l._validatePhoneNumber(e))return this._phoneNumber=e;throw new f.InvalidPhoneNumberException},e.prototype._setLocalPhone=function(e,t){if(f.Kii.logger("Setting local phone number: "+e+", country: "+t),!l._validateLocalPhone(e))throw new f.InvalidPhoneNumberException;if(!l._validateCountryCode(t))throw new f.InvalidCountryException;return this._phoneNumber=e,this._country=t},e.prototype._setPassword=function(e){if(l._validatePassword(e))return this._password=e;throw new f.InvalidPasswordException},e.prototype._clearPassword=function(){return this._password=null},e.prototype.getCountry=function(){return this._country},e.prototype.setCountry=function(e){if(l._validateCountryCode(e))return this._country=e;throw new f.InvalidCountryException},e.prototype.getCreated=function(){return this._created},e.prototype._setCreated=function(e){this._created=e},e.prototype.getModified=function(){return this._modified},e.prototype._setModified=function(e){this._modified=e},e.prototype.getEmailVerified=function(){return this._emailVerified},e.prototype._setEmailVerified=function(e){this._emailVerified=e},e.prototype.getPhoneVerified=function(){return this._phoneVerified},e.prototype._setPhoneVerified=function(e){this._phoneVerified=e},e.prototype.getLinkedSocialAccounts=function(){return f.Kii.logger("third party accounts: "+this._thirdPartyAccounts),null!=this._thirdPartyAccounts?this._thirdPartyAccounts:this._thirdPartyAccounts={}},e.prototype.getAccessToken=function(){return f.Kii.logger("Getting access token: "+this._accessToken),this._accessToken},e.prototype._setAccessToken=function(e){return this._accessToken=e,f.Kii.logger("Setting access token: "+this._accessToken)},e.prototype._setExpiresAt=function(e){return this._expiresAt=e,f.Kii.logger("Setting expires at: "+this._expiresAt)},e.prototype.getAccessTokenObject=function(){var e;return e=null,null!=this._accessToken&&(e={access_token:this._accessToken,expires_at:this._expiresAt}),e},e.prototype.objectURI=function(){var e;return e=null,null!=this._uuid&&(e="kiicloud://users/"+this._uuid),e},e.prototype.set=function(e,t){return l._isNonEmptyString(e)&&0!==e.indexOf("_")?(f.Kii.logger(this),f.Kii.logger(this._customInfo),this._customInfo[e]=t):void f.Kii.logger("[WARN] Reserved key is used for custom field. key="+e)},e.prototype.get=function(e){return this._customInfo[e]},e.getCurrentUser=function(){return f.Kii.getCurrentUser()},e.userWithUsername=function(e,t){var i;return i=new f.KiiUser,i._setUsername(e),i._setPassword(t),i},e._userWithEmailAddress=function(e,t){var i;return i=new f.KiiUser,i._setEmailAddress(e),i._setPassword(t),i},e._userWithPhoneNumber=function(e,t){var i;return i=new f.KiiUser,i._setPhoneNumber(e),i._setPassword(t),i},e.userWithPhoneNumber=function(t,i){return e._userWithPhoneNumber(t,i)},e.userWithPhoneNumberAndUsername=function(e,t,i){var n;return n=new f.KiiUser,n._setPhoneNumber(e),n._setUsername(t),n._setPassword(i),n},e.userWithEmailAddress=function(t,i){return e._userWithEmailAddress(t,i)},e.userWithEmailAddressAndUsername=function(e,t,i){var n;return n=new f.KiiUser,n._setEmailAddress(e),n._setUsername(t),n._setPassword(i),n},e.userWithEmailAddressAndPhoneNumber=function(e,t,i){var n;return n=new f.KiiUser,n._setEmailAddress(e),n._setPhoneNumber(t),n._setPassword(i),n},e.userWithCredentials=function(e,t,i,n){var r;return r=new f.KiiUser,r._setEmailAddress(e),r._setPhoneNumber(t),r._setUsername(i),r._setPassword(n),r},e._validateURI=function(e){var t,i,n;return e=l._trim(e),i=/^kiicloud:\/\/users\/(.*$)/i,"string"===(typeof e).toLowerCase()&&(t=e.match(i),null!=t&&(n=t[1])),n},e.userWithID=function(e){var t;if(null==e||""===e)throw new f.InvalidArgumentException("userID should not null or empty");return t=new f.KiiUser,t._setUUID(e),t},e.userWithURI=function(e){var t,i;if(f.Kii.logger("About to extract from: "+e),i=f.KiiUser._validateURI(e),f.Kii.logger("Extracted uuid from uri: "+i),null==i)throw new f.InvalidURIException;return t=new f.KiiUser,t._setUUID(i),t},e.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucket(e,this)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucket(e,this)},e.prototype._authenticate=function(e){var t,i,n,r,s,o;return f.Kii.logger("Authenticating user:"),f.Kii.logger(this),f.Kii.logger("Email verified: "+this._emailVerified),f.Kii.logger("Phone verified: "+this._phoneVerified),null!=this._username?o=this._username:null!=this._emailAddress&&this._emailVerified===!0?o=this._emailAddress:null!=this._phoneNumber&&this._phoneVerified===!0?o=this._phoneNumber:null!=this._emailAddress?o=this._emailAddress:null!=this._phoneNumber&&(o=this._phoneNumber),n={username:o,password:this._password},r=new Date,i=r.getTime(),f.Kii.getAccessTokenExpiration()>0&&(n.expiresAt=l._safeCalculateExpiresAtAsNumber(f.Kii.getAccessTokenExpiration(),i)),s=this._getRequest({path:"/oauth2/token",withApp:!1}),s.setAnonymous(!0),s.setMethod("POST"),s.setData(n),t={success:function(t){return function(n){return t._setUUID(n.id),t._clearPassword(),t._setAccessToken(n.access_token),null!=n.expires_in&&(r=new Date,i=r.getTime(),t._expiresAt=l._safeCalculateExpiresAtAsDate(n.expires_in,i)),f.Kii.setCurrentUser(t),null!=e?e.success(f.Kii.getCurrentUser()):void 0}}(this),failure:function(t){return function(i,n){return t._clearPassword(),null!=e?e.failure(t,i):void 0}}(this)},s.execute(t,!1)},e.prototype._authenticateWithToken=function(e,t,i){var n,r;return f.Kii.logger("Authenticating user "+this),f.Kii.logger(t),r=this._getRequest({path:"/users/me",withApp:!0}),r.setAnonymous(!0),r.addHeader("Authorization","Bearer "+e),n={success:function(n){return function(r){return n._updateWithJSON(r),n._setAccessToken(e),"undefined"==typeof i?n._setExpiresAt(new Date(l.MAX_DATE_IN_MILLIS)):n._setExpiresAt(i),f.Kii.setCurrentUser(n),null!=t?t.success(f.Kii.getCurrentUser()):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},r.execute(n,!1)},e.authenticate=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success.apply(n,arguments),r(arguments[0])},failure:function(){var e;return null!=n&&n.failure.apply(n,arguments),e=l._Error(arguments[1]),e.target=arguments[0],s(e)}},e._authenticateUsingCallbacks(t,i,o)})},e._authenticateUsingCallbacks=function(e,t,i){var n,r;try{if(f.Kii.logger("UserIdentifier: "+e),!l._validatePassword(t))throw new f.InvalidPasswordException;if(l._validateEmail(e))r=f.KiiUser._userWithEmailAddress(e,t);else if(l._validatePhoneNumber(e))r=f.KiiUser._userWithPhoneNumber(e,t);else{if(!l._validateUsername(e))throw new f.InvalidUserIdentifierException;r=f.KiiUser.userWithUsername(e,t)}return r._authenticate(i)}catch(s){if(n=s,null!=r&&r._clearPassword(),null!=i)return i.failure(null,n.message)}},e.authenticateWithToken=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){var e;return null!=i&&i.failure.apply(i,arguments),e=l._Error(arguments[1]),e.target=arguments[0],s(e)}},e._authenticateWithTokenUsingCallbacks(t,o,n)})},e._authenticateWithTokenUsingCallbacks=function(e,t,i){var n,r;return n=l._type(i),"undefined"!==n&&"date"!==n?t.failure(null,f.InvalidArgumentException("Specified expiresAt must be a Date")):(r=new f.KiiUser,r._authenticateWithToken(e,t,i))},e.prototype.register=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._registerUsingCallbacks(r)}}(this))},e.prototype._registerUsingCallbacks=function(e){var t,i,n,r,s,o;if(f.Kii.logger("Registering user "+this),t={password:this._password},null!=this._username&&(t.loginName=this._username),null!=this._displayName&&(t.displayName=this._displayName),null!=this._emailAddress&&(t.emailAddress=this._emailAddress),null!=this._phoneNumber&&(t.phoneNumber=this._phoneNumber),!this._validateLocalPhoneNumber(this._phoneNumber,this._country))return void e.failure(this,"needs to provide country for the local phone number");null!=this._country&&(t.country=this._country),f.Kii.logger("CINFO"),f.Kii.logger(this._customInfo),o=this._customInfo;for(i in o)s=o[i],f.Kii.logger("Key/val: "+i+"/"+s),t[i]=s;return r=this._getRequest({path:"/users",withApp:!0}),r.setMethod("POST"),r.setData(t),r.setAnonymous(!0),r.setContentType("application/vnd.kii.RegistrationRequest+json"),n={success:function(t){return function(i){return f.Kii.logger("Succreg"),t._updateWithJSON(i),t._authenticate(e)}}(this),failure:function(t){return function(i,n){return f.Kii.logger("Failreg"),t._clearPassword(),null!=e?e.failure(t,i):void 0}}(this)},r.execute(n,!1)},e.registerAsPseudoUser=function(t,i){return new Promise(function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1]))}},e._registerAsPseudoUserUsingCallbacks(s,i)})},e._registerAsPseudoUserUsingCallbacks=function(e,t){var i,n,r,s,o;return r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users",s=h.createXHRWrapper("POST",r),o=s.xhr,o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),o.setRequestHeader("Content-Type","application/vnd.kii.RegistrationAndAuthorizationRequest+json"),n={success:function(){var t,i,n,s;try{return o.status<300&&o.status>=200?(n=JSON.parse(o.responseText),t=n._accessToken,s=new f.KiiUser,s._updateWithJSON(n),s._setAccessToken(t),s._setExpiresAt(new Date(l.MAX_DATE_IN_MILLIS)),f.Kii.setCurrentUser(s),e.success(s)):(i=o.status+" : "+r,e.failure(null,i))}catch(u){return e.failure(null,"failed to parse response")}},failure:function(){var t,i;t="failed to register pseudo user. statusCode: "+o.status;try{if(i=JSON.parse(o.responseText),null!=i.errorCode&&(t+=" error code: "+i.errorCode),null!=i.message)return t+=" error message: "+i.message}catch(n){}finally{e.failure(null,t)}}},null==t&&(t={}),i=JSON.stringify(t),s.sendData(i,n)},e.prototype.putIdentity=function(e,t,i,n,r){return new Promise(function(s){return function(o,u){var a;return a={success:function(){return null!=i&&i.success.apply(i,arguments),o(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),u(l._Error(arguments[1],s))}},s._putIdentityUsingCallbacks(e,t,a,n,r)}}(this))},e.prototype._putIdentityUsingCallbacks=function(e,t,i,n,r){var s,o,u,a;if(f.Kii.logger("Put identity user: "+this._uuid),o={},!this.isPseudoUser())return void(null!=i&&i.failure(this,"This user has the identity already"));if(null==e)return void(null!=i&&i.failure(this,"identityData is null"));try{this._validateIdentityData(e)}catch(c){return u=c,void(null!=i&&i.failure(this,u))}return a=!1,null!=e.emailAddress&&(a=!0),null!=e.phoneNumber&&(a=!0),null!=e.username&&(a=!0),a?null==t?void(null!=i&&i.failure(this,"password is null")):l._validatePassword(t)?(s=null!=n?n.country:null,null==e.phoneNumber||this._validateLocalPhoneNumber(e.phoneNumber,s)?this.refresh({failure:function(e){return function(t,n){return f.Kii.logger("Failreg"),null!=i?i.failure(e,n):void 0}}(this),success:function(s){return function(u){var a,l,c,h,p,d,g,_,y,m;if(!u.isPseudoUser())return void(null!=i&&i.failure(u,"This user has the identity already"));if(o=s._clone(u._customInfo),null!=e.emailAddress&&(o.emailAddress=e.emailAddress),null!=e.phoneNumber&&(o.phoneNumber=e.phoneNumber),null!=e.username&&(o.loginName=e.username),o.password=t,null!=n)for(l in n)d=n[l],o[l]=d;if(null!=r)for(y=0,m=r.length;m>y;y++)c=r[y],delete o[c];return p=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/"+s._uuid),g=s._getXhrWrapper("POST",p),_=g.xhr,s._setAuthHeader(_),_.setRequestHeader("Content-Type","application/vnd.kii.UserUpdateRequest+json"),h={success:function(){var t,o;try{return o=JSON.parse(_.responseText),_.status<300&&_.status>=200?(u._setModified(o.modifiedAt),u._updateWithIdentityData(e),u._updateWithUserFields(n,r),s._hasPassword=!0,i.success(u)):(t=_.status+" : "+p,i.failure(s,t))}catch(a){return i.failure(s,"failed to parse response")}},failure:function(){var e,t;e="failed to put identity data. statusCode: "+_.status;try{if(t=JSON.parse(_.responseText),null!=t.errorCode&&(e+=" error code: "+t.errorCode),null!=t.message)return e+=" error message: "+t.message}catch(n){}finally{i.failure(s,e)}}},a=JSON.stringify(o),g.sendData(a,h)}}(this)}):void i.failure(this,"needs to provide country for the local phone number")):void(null!=i&&i.failure(this,"invalid password")):void(null!=i&&i.failure(this,"needs to provide at least one of login name, email address or phone number"))},e.prototype.update=function(e,t,i,n){return new Promise(function(r){return function(s,o){var u;return u={success:function(){return null!=t&&t.success.apply(t,arguments),s(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),o(l._Error(arguments[1],r))}},r._updateUsingCallbacks(e,u,i,n)}}(this))},e.prototype._updateUsingCallbacks=function(e,t,i,n){var r,s,o,u,a,l,c,h,p,d,g;if(f.Kii.logger("update user: "+this._uuid),s={},u=!1,l=!1,a=!1,null!=e){try{this._validateIdentityData(e)}catch(_){return o=_,void(null!=t&&t.failure(this,o))}null!=e.emailAddress&&(u=!0),null!=e.phoneNumber&&(u=!0),null!=e.username&&(u=!0)}if(null!=i)for(c in i){p=i[c],l=!0;break}if(null!=n)for(d=0,g=n.length;g>d;d++){h=n[d],a=!0;break}return u||l||a?(r=null!=i?i.country:null,null==e||null==e.phoneNumber||this._validateLocalPhoneNumber(e.phoneNumber,r)?this.refresh({failure:function(e){return function(i,n){return f.Kii.logger("Failreg"),null!=t?t.failure(e,n):void 0}}(this),success:function(r){return function(o){var a,l,d,g,_,y,m;if(o.isPseudoUser()&&u)return void(null!=t&&t.failure(o,"Pseudo user must use putIdentity()"));if(s=r._clone(o._customInfo),null!=e&&(null!=e.emailAddress&&(s.emailAddress=e.emailAddress),null!=e.phoneNumber&&(s.phoneNumber=e.phoneNumber),null!=e.username&&(s.loginName=e.username)),null!=i)for(c in i)p=i[c],s[c]=p;if(null!=n)for(y=0,m=n.length;m>y;y++)h=n[y],delete s[h];return d=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/"+r._uuid),g=r._getXhrWrapper("POST",d,!1),_=g.xhr,r._setAuthHeader(_),_.setRequestHeader("Content-Type","application/vnd.kii.UserUpdateRequest+json"),l={success:function(){var u,a;try{return a=JSON.parse(_.responseText),_.status<300&&_.status>=200?(o._setModified(s.modifiedAt),o._updateWithIdentityData(e),o._updateWithUserFields(i,n),t.success(o)):(u=_.status+" : "+d,t.failure(r,u))}catch(l){return t.failure(r,"failed to parse response")}},failure:function(){var e,i;e="failed to update user. statusCode: "+_.status;try{if(i=JSON.parse(_.responseText),null!=i.errorCode&&(e+=" error code: "+i.errorCode),null!=i.message)return e+=" error message: "+i.message}catch(n){}finally{t.failure(r,e)}}},a=JSON.stringify(s),g.sendData(a,l)}}(this)}):void t.failure(this,"needs to provide country for the local phone number")):void t.failure(this,"all arguments are null or empty")},e.prototype.updatePassword=function(e,t,i){return new Promise(function(n){return function(r,s){var o;return o={
success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(l._Error(arguments[1],n))}},n._updatePasswordUsingCallbacks(e,t,o)}}(this))},e.prototype._updatePasswordUsingCallbacks=function(e,t,i){var n,r,s,o;return f.Kii.logger("Updating password from "+e+" to "+t),l._validatePassword(t)?(n={oldPassword:e,newPassword:t},r="/users/"+this._uuid+"/password",s=this._getRequest({path:r,withApp:!0}),s.setMethod("PUT"),s.setData(n),s.setContentType("application/vnd.kii.ChangePasswordRequest+json"),o={success:function(e){return function(t,n){if(e._clearPassword,300>n&&n>=200){if(null!=i)return i.success(e)}else if(null!=i)return i.failure(e,"Unable to change password")}}(this),failure:function(e){return function(t,n){return e._clearPassword,null!=i?i.failure(e,t):void 0}}(this)},s.execute(o,!0)):null!=i?i.failure(this,(new f.InvalidPasswordException).message):void 0},e.resetPassword=function(t,i){return new Promise(function(n,r){var s;return s={success:function(){return null!=i&&i.success(),n()},failure:function(){return null!=i&&i.failure(arguments[0]),r(l._Error(arguments[0]))}},e._resetPasswordUsingCallbacks(t,s)})},e._resetPasswordUsingCallbacks=function(e,t){var i,n,r,s;if(f.Kii.logger("Resetting password with identifier: "+e),l._validateEmail(e))i="EMAIL";else if(null!=t)return void t.failure("Invalid user identifier. Must be a valid email address");return null!=i?(n="/users/"+i+":"+e+"/password/request-reset",r=new o(n,!0),r.setMethod("POST"),r.setAnonymous(!0),s={success:function(e,i){return 300>i&&i>=200&&null!=t?t.success():null!=t?t.failure("Unable to reset password"):void 0},failure:function(e,i){return null!=t?t.failure(e):void 0}},r.execute(s,!0)):void 0},e.resetPasswordWithNotificationMethod=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success(),r()},failure:function(){return null!=n&&n.failure(arguments[0]),s(l._Error(arguments[0]))}},e._resetPasswordWithNotificationMethodUsingCallbacks(t,i,o)})},e._resetPasswordWithNotificationMethodUsingCallbacks=function(e,t,i){var n,r,s,o,u,a;return"string"!=typeof e?void(null!=i&&i.failure("given userIdentifier is not string")):""===e?void(null!=i&&i.failure("given userIdentifier is empty")):"EMAIL"!==t&&"SMS"!==t?void(null!=i&&i.failure("notificationMethod should be 'EMAIL' or 'SMS'")):(r=l._validateEmail(e)?"EMAIL:"+e:l._isGlobalPhoneNumber(e)?"PHONE:"+e:e,r=encodeURIComponent(r),n={notificationMethod:t},o=""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users/"+r+"/password/request-reset",u=h.createXHRWrapper("POST",o),a=u.xhr,a.setRequestHeader("x-kii-appid",f.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/vnd.kii.ResetPasswordRequest+json"),s={success:function(){return null!=i?i.success():void 0},failure:function(){var e,t;e="failed to reset password. statusCode: "+a.status;try{if(t=JSON.parse(a.responseText),null!=t.errorCode&&(e+=" error code: "+t.errorCode),null!=t.message)return e+=" error message: "+t.message}catch(n){}finally{null!=i&&i.failure(e)}}},u.sendData(JSON.stringify(n),s))},e.prototype.verifyCredentials=function(e,t,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(l._Error(arguments[1],n))}},n._verifyCredentialsUsingCallbacks(e,t,o)}}(this))},e.prototype._verifyCredentialsUsingCallbacks=function(e,t,i){var n,r,s;return f.Kii.logger("Verifying "+e+" with code: "+t),n="/users/me/"+e+"/verify",r=this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),r.setData({verificationCode:t}),r.setContentType("application/vnd.kii.AddressVerificationRequest+json"),s={success:function(t){return function(n,r){if(300>r&&r>=200){if("email-address"===e?t._setEmailVerified(!0):"phone-number"===e&&t._setPhoneVerified(!0),null!=i)return i.success(t)}else if(null!=i)return i.failure(t,"Unable to verify "+e)}}(this),failure:function(e){return function(t,n){return null!=i?i.failure(e,t):void 0}}(this)},r.execute(s,!0)},e.prototype.verifyPhoneNumber=function(e,t){return this.verifyCredentials("phone-number",e,t)},e.prototype.resendVerification=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._resendVerificationUsingCallbacks(e,s)}}(this))},e.prototype._resendVerificationUsingCallbacks=function(e,t){var i,n,r,s;return f.Kii.logger("Resending verification "+e),i=this.getID(),n="/users/"+i+"/"+e+"/resend-verification",r=this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),s={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?t.success(i):null!=t?t.failure(i,"Unable to resend "+e+" verification"):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},r.execute(s,!0)},e.prototype.resendEmailVerification=function(e){return this.resendVerification("email-address",e)},e.prototype.resendPhoneNumberVerification=function(e){return this.resendVerification("phone-number",e)},e.prototype.memberOfGroups=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._memberOfGroupsUsingCallbacks(r)}}(this))},e.prototype._memberOfGroupsUsingCallbacks=function(e){var t,i,n;return f.Kii.logger("Getting groups for member "+this._uuid),i="/groups/?is_member="+this._uuid,n=this._getRequest({path:i,withApp:!0}),n.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],a=i.groups,o=0,u=a.length;u>o;o++)r=a[o],s.push(t._groupWithJSON(r));if(null!=e)return e.success(t,s)}else if(null!=e)return e.failure(t,"Unable to retrieve groups")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(t,!1)},e.prototype.ownerOfGroups=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._ownerOfGroupsUsingCallbacks(r)}}(this))},e.prototype._ownerOfGroupsUsingCallbacks=function(e){var t,i,n;return f.Kii.logger("Getting groups owned by the user "+this._uuid),i="/groups/?owner="+this._uuid,n=this._getRequest({path:i,withApp:!0}),n.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],a=i.groups,o=0,u=a.length;u>o;o++)r=a[o],s.push(t._groupWithJSON(r));if(null!=e)return e.success(t,s)}else if(null!=e)return e.failure(t,"Unable to retrieve groups")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(t,!1)},e.prototype.changePhone=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._changePhoneUsingCallbacks(e,s)}}(this))},e.prototype._changePhoneUsingCallbacks=function(e,t){var i,n,r;return f.Kii.logger("Updating phone number to "+e),i="/users/"+this._uuid+"/phone-number",n=this._getRequest({path:i,withApp:!0}),n.setMethod("PUT"),n.setContentType("application/vnd.kii.PhoneNumberModificationRequest+json"),n.setData({phoneNumber:e}),r={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?(i._setPhoneVerified(!1),i._setPhoneNumber(e),t.success(i)):null!=t?t.failure(i,"Unable to update phone number"):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!0)},e.prototype.changeEmail=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(l._Error(arguments[1],i))}},i._changeEmailUsingCallbacks(e,s)}}(this))},e.prototype._changeEmailUsingCallbacks=function(e,t){var i,n,r;return f.Kii.logger("Updating email address to: "+e),l._validateEmail(e)?(i="/users/"+this._uuid+"/email-address",n=this._getRequest({path:i,withApp:!0}),n.setMethod("PUT"),n.setContentType("application/vnd.kii.EmailAddressModificationRequest+json"),n.setData({emailAddress:e}),r={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?(i._setEmailVerified(!1),i._setEmailAddress(e),t.success(i)):null!=t?t.failure(i,"Unable to update email address"):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!0)):t.failure(this,"Invalid email address format")},e.prototype.save=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._saveUsingCallbacks(r)}}(this))},e.prototype._saveUsingCallbacks=function(e){var t,i,n,r;return f.Kii.logger("Saving user: "+this._uuid),i="/users/"+this._uuid,f.Kii.logger("CUSTOMINFO: "),f.Kii.logger(this._customInfo),n=this._getRequest({path:i,withApp:!0}),n.setMethod("POST"),n.setContentType("application/vnd.kii.UserUpdateRequest+json"),t=this._customInfo,null!=this._country&&(t.country=this._country),null!=this._displayName&&(t.displayName=this._displayName),n.setData(t),r={success:function(t){return function(i,n){if(300>n&&n>=200){if(t._setModified(i.modifiedAt),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!1)},e.prototype.refresh=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._refreshUsingCallbacks(r)}}(this))},e.prototype._refreshUsingCallbacks=function(e){var t,i;return f.Kii.logger("Refreshing user: "+this._uuid),i=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),t={success:function(t){return function(i,n){if(300>n&&n>=200){if(t._updateWithJSON(i),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype["delete"]=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(l._Error(arguments[1],t))}},t._deleteUsingCallbacks(r)}}(this))},e.prototype._deleteUsingCallbacks=function(e){var t,i;return f.Kii.logger("Deleting user..."),i=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i,n){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e.logOut=function(){return f.Kii.logOut()},e.loggedIn=function(){return f.Kii.loggedIn()},e.prototype._updateWithIdentityData=function(e){return null!=e&&(null!=e.username&&(this._username=e.username),null!=e.emailAddress&&(this._emailAddress=e.emailAddress),null!=e.phoneNumber)?this._phoneNumber=e.phoneNumber:void 0},e.prototype._updateWithUserFields=function(e,t){var i,n,r,s,o,u;if(null!=e)for(i in e)r=e[i],"displayName"===i?this._displayName=r:"country"===i?this._country=r:""===i?(f.Kii.logger("Setting empty to custom info"),this._customInfo[i]=r):"_"!==i.substring(0,1)&&(f.Kii.logger("Setting to custom info"),this._customInfo[i]=r);if(null!=t){for(u=[],s=0,o=t.length;o>s;s++)n=t[s],u.push(delete this._customInfo[n]);return u}},e.prototype._validateIdentityData=function(e){if(null!=e){if(null!=e.emailAddress&&!l._validateEmail(e.emailAddress))throw"invalid email";if(null!=e.phoneNumber&&!l._validatePhoneNumber(e.phoneNumber))throw"invalid phone number";if(null!=e.username&&!l._validateUsername(e.username))throw"invalid username"}},e.prototype._validateLocalPhoneNumber=function(e,t){return null==e||l._isGlobalPhoneNumber(e)?!0:null!=t?l._validateCountryCode(t):!1},e.prototype._updateWithJSON=function(e){var t,i,n,r;f.Kii.logger("Updating with:"),f.Kii.logger(e),this._thirdPartyAccounts={},r=[];for(t in e)n=e[t],f.Kii.logger("key/val => "+t+"/"+n),f.Kii.logger("Substr "+t.substring(0,1)),"userID"===t||"id"===t?r.push(this._uuid=n):"created"===t||"createdAt"===t||"_created"===t?r.push(this._created=n):"modified"===t||"modifiedAt"===t||"_modified"===t?r.push(this._modified=n):"loginName"===t?r.push(this._username=n):"displayName"===t?r.push(this._displayName=n):"country"===t?(f.Kii.logger("Is setting country"),r.push(this._country=n)):"emailAddress"===t?r.push(this._emailAddress=n):"phoneNumber"===t?r.push(this._phoneNumber=n):"emailAddressVerified"===t?(f.Kii.logger("Email verified: "+n),r.push(this._emailVerified=n)):"phoneNumberVerified"===t?(f.Kii.logger("Phone verified: "+n),r.push(this._phoneVerified=n)):"_hasPassword"===t?(f.Kii.logger("_hasPassword: "+n),r.push(this._hasPassword=n)):"_thirdPartyAccounts"===t?(null!=n.hotmail&&(i=n.hotmail,i.type="live",n.live=i,delete n.hotmail),f.Kii.logger("_thirdPartyAccounts: "+n),r.push(this._thirdPartyAccounts=n)):"_disabled"===t?(f.Kii.logger("disabled: "+n),r.push(this._disabled=n)):""===t?(f.Kii.logger("Setting empty to custom info"),r.push(this._customInfo[t]=n)):t.substring(0,!0)?(f.Kii.logger("Setting to custom info"),r.push(this._customInfo[t]=n)):r.push(f.Kii.logger("Doing nothing"));return r},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.findUserByEmail=function(t,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=l._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):e._findUserByEmail(t,i)},e._findUserByEmail=function(t,i,n){var r,s,o;return null==t||""===t?(s=f.InvalidArgumentException("email should not null or empty"),r=l._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/EMAIL:"+t),e._findUserRequestImpl(o,i,n))},e.findUserByPhone=function(t,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=l._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):e._findUserByPhone(t,i)},e._findUserByPhone=function(t,i,n){var r,s,o;return null==t||""===t?(s=f.InvalidArgumentException("phone should not null or empty"),r=l._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/PHONE:"+t),e._findUserRequestImpl(o,i,n))},e.findUserByUsername=function(t,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=l._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):e._findUserByUsername(t,i)},e._findUserByUsername=function(t,i,n){var r,s,o;return null==t||""===t?(s=f.InvalidArgumentException("username should not null or empty"),r=l._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/LOGIN_NAME:"+t),e._findUserRequestImpl(o,i,n))},e._findUserRequestImpl=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){var e;return null!=i&&null!=(e=i.success)&&e.apply(i,arguments),r(null!=n?arguments:arguments[0])},failure:function(){var e;return null!=i&&null!=(e=i.failure)&&e.apply(i,arguments),s(null!=n?l._Error(arguments[1],arguments[0]):l._Error(arguments[0]))}},e._findUserRequestImplUsingCallbacks(t,o,n)})},e._findUserRequestImplUsingCallbacks=function(e,t,i){var n,r,s;return r=h.createXHRWrapper("GET",e),s=r.xhr,s.setRequestHeader("x-kii-appid",f.Kii.getAppID()),s.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),s.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),null!=i?s.setRequestHeader("Authorization","Bearer "+i._getToken()):s.setRequestHeader("Authorization","Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),n={success:function(){var e,n;if(null!=t)try{return e=JSON.parse(s.responseText),null!=i?(n=new f.KiiUserAdmin(i._getToken()),n._updateWithJSON(e),t.success(i,n)):(n=new f.KiiUser,n._updateWithJSON(e),t.success(n))}catch(r){return null!=i?t.failure(i,"Unable to parse response"):t.failure("Unable to parse response")}},failure:function(){var e,n;if(null!=t){e="Failed to find user. statusCode: "+s.status;try{if(n=JSON.parse(s.responseText),null!=n.errorCode&&(e+=" error code: "+n.errorCode),null!=n.message)return e+=" error message: "+n.message}finally{null!=i?t.failure(i,e):t.failure(e)}}}},r.send(n)},e.prototype._getXhrWrapper=function(e,t){var i,n;return i=h.createXHRWrapper(e,t),n=i.xhr,n.setRequestHeader("x-kii-appid",f.Kii.getAppID()),n.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),n.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),i},e.prototype._setAuthHeader=function(e){var t;return t=f.KiiUser.getCurrentUser(),null!=t?e.setRequestHeader("Authorization","Bearer "+t.getAccessToken()):void 0},e.prototype._groupWithJSON=function(e){return f.KiiGroup._groupWithJSON(e)},e.prototype.topicWithName=function(e){var t,i;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");if(t=this.getID(),!t)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopic(i,e)},e.prototype.listTopics=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,t)}}(this))},e.prototype._listTopicsUsingCallbacks=function(e,t){var i,n,r;return n=""+this._getHttpURI()+"/topics","string"==typeof t&&""!==t&&(n=n+"?paginationKey="+encodeURIComponent(t)),r=h.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(t){return function(){var i,n,s,o,u,a;for(i=JSON.parse(r.xhr.responseText),s=[],a=i.topics,o=0,u=a.length;u>o;o++)n=a[o],s.push(t.topicWithName(n.topicID));return null!=e?e.success(s,void 0===i.paginationKey?null:i.paginationKey):void 0}}(this),failure:function(t){return function(){var i,n;return n=r.getErrorString("list topics"),i=l._Error(n,t),null!=e?e.failure(i):void 0}}(this)},r.send(i)},e.prototype.pushSubscription=function(){return new f.KiiPushSubscription(this)},e.prototype.pushInstallation=function(){return new f.KiiPushInstallation(this)},e.prototype._getSubscriberPath=function(){return"users/"+this.getID()},e.prototype._clone=function(e){var t,i;if(null==e||"object"!=typeof e)return e;i=new e.constructor;for(t in e)i[t]=this._clone(e[t]);return i},e.prototype._getHttpURI=function(){return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users/"+this.getID()},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e}(),l=function(){function e(){}return e.MAX_DATE_IN_MILLIS=864e13,e.MIN_DATE_IN_MILLIS=-864e13,e._validateEmail=function(t){var i;return t=e._trim(t),i=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):!!t.match(i)},e._validatePhoneNumber=function(t){var i;return t=e._trim(t),i=/^[\\+]?[0-9]{10,}$/i,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):!!t.match(i)},e._isGlobalPhoneNumber=function(t){var i;return t=e._trim(t),i=/^[\\+]{1}[0-9]{2}/,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):!!t.match(i)},e._validateLocalPhone=function(t){var i;return t=e._trim(t),i=/^\d+$/,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):t.match(i)?!0:(f.Kii.logger("Invalid format"),!1)},e._assertLocalPhoneIsValid=function(t){if(!e._validateLocalPhone(t))throw new f.InvalidLocalPhoneNumberException},e._validateCountryCode=function(t){var i;return t=e._trim(t),i=/^[a-z]{2}$/i,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):t.match(i)?(f.Kii.logger("Is true"),!0):!1},e._assertCountryCodeIsValid=function(t){if(!e._validateCountryCode(t))throw new f.InvalidCountryException},e._validatePassword=function(e){var t;return f.Kii.logger("Validating password: "+e),t=/^[\x20-\x7E]{4,50}$/,"string"!==(typeof e).toLowerCase()?(f.Kii.logger("not string"),!1):e.match(t)?(f.Kii.logger("matched"),!0):(f.Kii.logger("other exception"),!1)},e._assertPasswordIsValid=function(t){if(!e._validatePassword(t))throw new f.InvalidPasswordException},e._validateUsername=function(e){var t;return t=/^[a-zA-Z0-9-_\\.]{3,64}$/i,"string"!==(typeof e).toLowerCase()?!1:!!e.match(t)},e._validateGroupID=function(e){var t;return t=/^[a-z0-9-_.]{1,30}$/,"string"!==(typeof e).toLowerCase()?!1:!!e.match(t)},e._validateDisplayName=function(t){var i;return"string"===e._type(t)&&1<=(i=t.length)&&50>=i},e._trim=function(e){var t;return t=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,(e||"").replace(t,"")},e._safeAddTicks=function(t,i){if(isNaN(parseInt(t,10))||isNaN(parseInt(i,10)))throw new f.InvalidArgumentException("Parameters should be a number");if(Math.abs(t+i)>e.MAX_DATE_IN_MILLIS)throw new f.ArithmeticException("Addition of "+t+" and "+i+" result in long overflow");return t+i},e._safeMultiplyTicks=function(t,i){if(isNaN(parseInt(t,10))||isNaN(parseInt(i,10)))throw new f.InvalidArgumentException("Parameters should be a number");if(Math.abs(t*i)>e.MAX_DATE_IN_MILLIS)throw new f.ArithmeticException("Multiplication of "+t+" and "+i+" result in long overflow");return t*i},e._safeCalculateExpiresAtAsNumber=function(t,i){var n,r,s;s=0;try{r=e._safeMultiplyTicks(t,1e3),s=e._safeAddTicks(i,r)}catch(o){if(n=o,!(n instanceof f.ArithmeticException))throw n;s=e.MAX_DATE_IN_MILLIS}return s},e._safeCalculateExpiresAtAsDate=function(t,i){var n,r,s;s=0;try{r=e._safeMultiplyTicks(t,1e3),s=e._safeAddTicks(i,r)}catch(o){if(n=o,!(n instanceof f.ArithmeticException))throw n;s=e.MAX_DATE_IN_MILLIS}return new Date(s)},e._isJSONType=function(e){var t;return t=/\+?json(;.*)?$/i,e.match(t)},e._type=function(e){var t;return void 0===e||null===e?String(e):(t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},t[Object.prototype.toString.call(e)])},e._disableCacheURL=function(e){return e+=-1!==e.indexOf("?")?"&disable_cache=":"?disable_cache=",e+=(new Date).getTime()},e._validateServerCodeEntryName=function(t){var i;return i=/^[a-zA-Z][_a-zA-Z0-9]*$/i,"string"===e._type(t)&&t.match(i)},e._validateServerCodeEntryArgument=function(t){return"null"===e._type(t)||"object"===e._type(t)&&Object.keys(t).length>0},e._validateServerCodeEnryVersion=function(t){return"string"===e._type(t)&&""!==t},e._isNonEmptyString=function(e){return"string"!=typeof e?!1:e.length>0},e._Error=function(e,t){var i;return i=Error(e),i.target=t,i},e}(),f.KiiSocialConnect=function(){function e(){}var t;return t=null,e.setupNetwork=function(e,t,i,n){},e.logIn=function(i,n,r){return null==t&&(t=new _),new Promise(function(t,s){var o,u,a;a={success:function(){return null!=r&&r.success.apply(r,arguments),t(arguments)},failure:function(){var e;return null!=r&&r.failure.apply(r,arguments),e=l._Error(arguments[2]),e.network=i,s(e)}};try{return e._logInUsingCallbacks(i,n,a)}catch(c){return u=c,null!=r&&"function"==typeof r.failure&&r.failure(null,i,u),o=l._Error(u),o.network=i,s(o)}})},e._logInUsingCallbacks=function(e,i,n){var r;return r=!1,null!=t&&(f.Kii.logger("And manager: "),f.Kii.logger(t._getManager(e)),t._getManager(e)&&(t._getManager(e)._logIn(i,n),r=!0)),f.Kii.logger("Callbacks"),f.Kii.logger(n),r||null==n?void 0:n.failure(f.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.linkCurrentUserWithNetwork=function(i,n,r){return null==t&&(t=new _),new Promise(function(t,s){var o,u,a,c;c={success:function(){return null!=r&&r.success.apply(r,arguments),t(arguments)},failure:function(){var e;return null!=r&&r.failure.apply(r,arguments),e=l._Error(arguments[2]),e.target=arguments[0],e.network=i,s(e)}};try{return e._linkCurrentUserWithNetworkUsingCallbacks(i,n,c)}catch(h){return a=h,o=f.KiiUser.getCurrentUser(),null!=r&&"function"==typeof r.failure&&r.failure(o,i,a),u=l._Error(a),u.target=o,u.network=i,s(u)}})},e._linkCurrentUserWithNetworkUsingCallbacks=function(e,i,n){var r;return f.Kii.logger("Trying with instance"),f.Kii.logger(t),r=!1,null!=t&&(f.Kii.logger("And manager: "),f.Kii.logger(t._getManager(e)),t._getManager(e)&&(t._getManager(e)._linkWithCurrentUser(i,n),r=!0)),f.Kii.logger("Callbacks"),f.Kii.logger(n),r||null==n?void 0:n.failure(f.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.unLinkCurrentUserFromNetwork=function(i,n){return null==t&&(t=new _),new Promise(function(t,r){var s;return s={success:function(){return null!=n&&n.success.apply(n,arguments),t(arguments)},failure:function(){var e;return null!=n&&n.failure.apply(n,arguments),e=l._Error(arguments[2]),e.target=arguments[0],e.network=i,r(e)}},e._unLinkCurrentUserWithNetworkUsingCallbacks(i,s)})},e._unLinkCurrentUserWithNetworkUsingCallbacks=function(e,i){if(f.Kii.logger("Trying with instance"),f.Kii.logger(t),null!=t){if(f.Kii.logger("And manager: "),f.Kii.logger(t._getManager(e)),t._getManager(e))return t._getManager(e)._unlinkFromCurrentUser(i)}else if(null!=i)return i.failure(f.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.getAccessTokenForNetwork=function(e){return null!=t?t._getManager(e)._getToken():void 0},e.getAccessTokenExpirationForNetwork=function(e){return null!=t?t._getManager(e)._getTokenExpiration():void 0},e.getAccessTokenObjectForNetwork=function(e){return null!=t?t._getManager(e)._getTokenObject():void 0},e.logOutAll=function(){var e,i,n,r,s;return null!=t&&(e=t._getManager(f.KiiSocialNetworkName.FACEBOOK),null!=e&&e._logOut(),s=t._getManager(f.KiiSocialNetworkName.TWITTER),null!=s&&s._logOut(),n=t._getManager(f.KiiSocialNetworkName.QQ),null!=n&&n._logOut(),i=t._getManager(f.KiiSocialNetworkName.GOOGLEPLUS),null!=i&&i._logOut(),r=t._getManager(f.KiiSocialNetworkName.RENREN),null!=r)?r._logOut():void 0},e}(),_=function(){function e(){this._getManager=y(this._getManager,this)}return e.prototype._getManager=function(e){return e===f.KiiSocialNetworkName.FACEBOOK?null!=this._facebookManager?this._facebookManager:this._facebookManager=new f.KiiSCNFacebook:e===f.KiiSocialNetworkName.TWITTER?null!=this._twitterManager?this._twitterManager:this._twitterManager=new f.KiiSCNTwitter:e===f.KiiSocialNetworkName.QQ?null!=this._qqManager?this._qqManager:this._qqManager=new f.KiiSCNQQ:e===f.KiiSocialNetworkName.GOOGLEPLUS?null!=this._googleManager?this._googleManager:this._googleManager=new f.KiiSCNGoogle:e===f.KiiSocialNetworkName.RENREN?null!=this._renrenManager?this._renrenManager:this._renrenManager=new f.KiiSCNRenRen:void 0},e}(),f.KiiSocialConnectNetwork=function(){function e(e){this._network=e,this._unlink=y(this._unlink,this),this._link=y(this._link,this),this._register=y(this._register,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._isAuthenticated=y(this._isAuthenticated,this),this._getTokenObject=y(this._getTokenObject,this),this._setTokenObject=y(this._setTokenObject,this),this._getTokenExpiration=y(this._getTokenExpiration,this),this._setTokenExpiration=y(this._setTokenExpiration,this),this._getToken=y(this._getToken,this),this._setToken=y(this._setToken,this),this._getNetwork=y(this._getNetwork,this),this._setNetwork=y(this._setNetwork,this),this._tokenExpiration=null,this._token=null}return e.prototype._className="KiiSocialConnectNetwork",e.prototype._setNetwork=function(e){this._network=e},e.prototype._getNetwork=function(){return this._network},e.prototype._setToken=function(e){this._token=e},e.prototype._getToken=function(){return this._token},e.prototype._setTokenExpiration=function(e){this._tokenExpiration=e},e.prototype._getTokenExpiration=function(){return this._tokenExpiration},e.prototype._setTokenObject=function(e){this._tokenObject=e},e.prototype._getTokenObject=function(){return this._tokenObject},e.prototype._isAuthenticated=function(){return null!=this._tokenObject},e.prototype._logIn=function(e,t){},e.prototype._logOut=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null},e.prototype._linkWithCurrentUser=function(e,t){},e.prototype._unlinkFromCurrentUser=function(e){},e.prototype._createTokenObject=function(e,t){},e.prototype._getAccessToken=function(e){},e.prototype._register=function(e,t,i,n,r){var s,u,a,c,h;return f.Kii.getAccessTokenExpiration()>0&&(u=new Date,s=u.getTime(),i.expiresAt=l._safeCalculateExpiresAtAsNumber(f.Kii.getAccessTokenExpiration(),s)),c=new o("/integration/"+e,!0),c.setMethod("POST"),c.setData(i),c.setAnonymous(!0),c.setContentType(t),h=this._getAccessToken(n),a={success:function(e){return function(t){var i,o,a,c;return e._setToken(h),o=e._createTokenObject(n,t),e._setTokenObject(o),a=new f.KiiUser,a._updateWithJSON(t),a._setAccessToken(t.access_token),null!=t.expires_in&&(u=new Date,s=u.getTime(),c=l._safeCalculateExpiresAtAsDate(t.expires_in,s),a._setExpiresAt(c)),f.Kii.setCurrentUser(a),i={success:function(t){return null!=r?r.success(t,e._network):void 0},failure:function(t,i){return null!=r?r.failure(t,e._network,i):void 0}},a.refresh(i)}}(this),failure:function(e){return function(t,i){return null!=r?r.failure(null,e._network,t):void 0}}(this)},c.execute(a,!1)},e.prototype._link=function(e,t,i,n,r){var s,u,a;return u=new o("/users/me/"+e+"/link",!0),u.setMethod("POST"),u.setData(i),u.setContentType(t),a=this._getAccessToken(n),s={success:function(e){return function(t){var i,s;return e._setToken(a),s=e._createTokenObject(n,t),e._setTokenObject(s),i={success:function(t){return null!=r?r.success(t,e._network):void 0},failure:function(t,i){return null!=r?r.failure(t,e._network,i):void 0}},f.KiiUser.getCurrentUser().refresh(i)}}(this),failure:function(e){return function(t,i){return null!=r?r.failure(f.KiiUser.getCurrentUser(),e._network,t):void 0}}(this)
},u.execute(s,!0)},e.prototype._unlink=function(e,t){var i,n;return i=new o("/users/me/"+e+"/unlink",!0),i.setMethod("POST"),n={success:function(e){return function(i){return e._setToken(null),e._setTokenExpiration(null),e._setTokenObject(null),null!=t?t.success(f.KiiUser.getCurrentUser(),e._network):void 0}}(this),failure:function(e){return function(i,n){return null!=t?t.failure(f.KiiUser.getCurrentUser(),e._network,i):void 0}}(this)},i.execute(n,!0)},e}(),f.KiiSCNFacebook=function(e){function t(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.FACEBOOK)}return v(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={access_token:e.access_token},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.access_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("should auth fb"),f.Kii.logger("Checking options"),null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.access_token},this._register("facebook","application/vnd.kii.AuthTokenFacebookRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out fb")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:e.access_token},this._link("facebook","application/vnd.kii.LinkFacebookRequest+json",i,e,t)}return null!=t?t.failure(null,this._network,"A KiiUser must be logged in before linking to Facebook"):void 0},t.prototype._unlinkFromCurrentUser=function(e){return null!=f.KiiUser.getCurrentUser()?this._unlink("facebook",e):null!=e?e.failure("A KiiUser must be logged in before unlinking from Facebook"):void 0},t}(f.KiiSocialConnectNetwork),f.InvalidDisplayNameException=function(){return this.message="Unable to set displayName. Must be between 1-50 characters."},f.InvalidPasswordException=function(){return this.message="Unable to set password. Must be between 4-50 characters composed with ascii (exclude control character)"},f.InvalidUsernameException=function(){return this.message="Unable to set username. Must be between 3 and 64 characters, which can include alphanumeric characters as well as underscores '_' and periods '.'"},f.InvalidUserIdentifierException=function(){return this.message="User identifier should be one of user name, phone number or email"},f.InvalidEmailException=function(){return this.message="Unable to set email address. Must be a valid email"},f.InvalidPhoneNumberException=function(){return this.message="Unable to set phone number. Must begin with a '+' and be at least 10 digits"},f.InvalidLocalPhoneNumberException=function(){return this.message="Unable to set phone number. Must be a sequence of numbers"},f.InvalidCountryException=function(){return this.message="Unable to set country code. Must be 2 alphabetic characters. Ex: US, JP, CN"},f.InvalidURIException=function(){return this.message="Unable to set URI. Must be of the form kiicloud://some/path/to/object/or/entity"},f.InvalidACLAction=function(){return this.message="Unable to set ACL action. Must be one of the permitted values in KiiACLAction"},f.InvalidACLSubject=function(){return this.message="Unable to set ACL subject. Must be of type KiiUser or KiiGroup"},f.InvalidACLGrant=function(){return this.message="Unable to set ACL grant. Must be a boolean type"},f.InvalidLimitException=function(){return this.message="Unable to set query limit. Must be an integer > 0"},f.InvalidArgumentException=function(e){return this.message="InvalidArgument: "+e},f.IllegalStateException=function(e){return this.message="IllegalState: "+e},f.ArithmeticException=function(e){return this.message="ArithmeticException: "+e},f.UnsupportedOperationException=function(e){return this.message="UnsupportedOperationException: "+e},f.KiiAppAdminContext=function(){function e(e){this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this.loadThingWithThingID=y(this.loadThingWithThingID,this),this.loadThingWithVendorThingID=y(this.loadThingWithVendorThingID,this),this.registerOwnerWithVendorThingID=y(this.registerOwnerWithVendorThingID,this),this.registerOwnerWithThingID=y(this.registerOwnerWithThingID,this),this.thingWithID=y(this.thingWithID,this),this.registerThing=y(this.registerThing,this),this.registerGroupWithOwnerAndID=y(this.registerGroupWithOwnerAndID,this),this._getToken=y(this._getToken,this),this._getId=y(this._getId,this),this._objectWithURI=y(this._objectWithURI,this),this._token=e.token,this._id=e.id}return e.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucketAdmin(e,null,this._token)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucketAdmin(e,null,this._token)},e.prototype.groupWithName=function(e){var t;return t=f.KiiGroupAdmin._groupWithName(e,this._token)},e.prototype.userWithID=function(e){var t;return t=f.KiiUserAdmin._userWithID(e,this._token)},e.prototype.objectWithURI=function(e){var t;return t=this._objectWithURI(e)},e.prototype._userWithLoginName=function(e,t){var i,n,r;return r=new f.KiiUserAdmin(this._token),n=r._getRequest({path:"/users/LOGIN_NAME:"+e,withApp:!0}),n.setAdminToken(this._token),i={success:function(e){return function(e,i){if(300>i&&i>=200){if(r._updateWithJSON(e),null!=t)return t.success(r)}else if(null!=t)return t.failure("Unable to parse response")}}(this),failure:function(e){return function(e,i){return null!=t?t.failure(e):void 0}}(this)},n.execute(i,!1)},e.prototype._objectWithURI=function(e){var t,i,n,r,s,o,u,a,l;if(!e)throw new f.InvalidURIException;if(l=0===e.indexOf("kiicloud://"),o=e.substr("kiicloud://".length),s=o.split("/"),r=s.length,!(r>=4&&l))throw new f.InvalidURIException;if(i=4===r?1:3,n=s[i],a=null,"groups"===s[0]&&6===r)a=new f.KiiGroupAdmin._groupWithID(s[1],this._token);else if("users"===s[0]&&6===r)a=f.KiiUserAdmin._userWithID(s[1],this._token);else if("things"===s[0]&&6===r)a=f.KiiThingAdmin.thingWithID(s[1],this._token);else if(4!==r)throw new f.InvalidURIException;return t=new f.KiiBucketAdmin(n,a,this._token),u=t.createObject(),u._setUUID(s[r-1]),u},e.prototype._getId=function(){return this._id},e.prototype._getToken=function(){return this._token},e.prototype.groupWithID=function(e){var t;if(null==e||""===e)throw new f.InvalidArgumentException("groupID should not null or empty");return t=f.KiiGroupAdmin._groupWithID(e,this._token)},e.prototype.registerGroupWithOwnerAndID=function(e,t,i,n,r){return new Promise(function(s){return function(o,u){var a;return a={success:function(){return null!=r&&r.success.apply(r,arguments),o(arguments[0])},failure:function(){var e;return null!=r&&r.failure.apply(r,arguments),e=l._Error(arguments[1],arguments[0]),e.addMembersArray=arguments[2],e.removeMembersArray=arguments[3],u(e)}},f.KiiGroup._registerGroupWithIDUsingCallbacks(s._token,e,t,i,n,a)}}(this))},e.prototype.groupWithURI=function(e){var t,i,n;if(null==e)throw new f.InvalidURIException;if(0!==e.indexOf("kiicloud://"))throw new f.InvalidURIException;if(n=e.substr("kiicloud://".length),t=n.split("/"),2!==t.length||"groups"!==t[0])throw new f.InvalidURIException;return i=f.KiiGroupAdmin._groupWithID(t[1],this._token)},e.prototype.findUserByEmail=function(e,t){return f.KiiUser._findUserByEmail(e,t,this)},e.prototype.findUserByPhone=function(e,t){return f.KiiUser._findUserByPhone(e,t,this)},e.prototype.findUserByUsername=function(e,t){return f.KiiUser._findUserByUsername(e,t,this)},e.prototype.registerThing=function(e,t){return f.KiiThingAdmin.register(e,t,this._token)},e.prototype.thingWithID=function(e){return f.KiiThingAdmin.thingWithID(e,this._token)},e.prototype.registerOwnerWithThingID=function(e,t,i){return f.KiiThingAdmin.registerOwnerWithThingID(e,t,i,this._token)},e.prototype.registerOwnerWithVendorThingID=function(e,t,i){return f.KiiThingAdmin.registerOwnerWithVendorThingID(e,t,i,this._token)},e.prototype.thingWithID=function(e){return f.KiiThingAdmin.thingWithID(e,this._token)},e.prototype.loadThingWithVendorThingID=function(e,t){return f.KiiThingAdmin.loadWithVendorThingID(e,t,this._token)},e.prototype.loadThingWithThingID=function(e,t){return f.KiiThingAdmin.loadWithThingID(e,t,this._token)},e.prototype.topicWithName=function(e){if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopicAdmin(""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID(),e,this._token)},e.prototype.listTopics=function(e,t){return f.Kii._listTopics(e,t,this)},e}(),f.KiiACLAdmin=function(e){function t(e,i){this._userWithID=y(this._userWithID,this),this._groupWithID=y(this._groupWithID,this),this._getRequest=y(this._getRequest,this),t.__super__.constructor.call(this),this._setParent(e),this._adminToken=i}return v(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._groupWithID=function(e){var t;return t=f.KiiGroupAdmin._groupWithID(e,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=f.KiiUserAdmin._userWithID(e,this._adminToken)},t}(f.KiiACL),f.KiiGroupAdmin=function(e){function t(e){this.topicWithName=y(this.topicWithName,this),this._setAuthToken=y(this._setAuthToken,this),this._setOwnerFromContext=y(this._setOwnerFromContext,this),this._userWithID=y(this._userWithID,this),this.bucketWithName=y(this.bucketWithName,this),this._getRequest=y(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return v(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t._groupWithName=function(e,t){return f.KiiGroupAdmin._groupWithNameAndMembers(e,null,t)},t._groupWithNameAndMembers=function(e,t,i){var n;return n=new f.KiiGroupAdmin(i),n._setName(e),n._setAddMembers(t),n},t._groupWithID=function(e,t){var i;return i=new f.KiiGroupAdmin(t),i._setUUID(e),i},t.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucketAdmin(e,this,this._adminToken)},t.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucketAdmin(e,this,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=f.KiiUserAdmin._userWithID(e,this._adminToken)},t.prototype._setOwnerFromContext=function(e){},t._groupWithJSON=function(e,t){var i;return i=new f.KiiGroupAdmin(t),null!=e.groupID&&i._setUUID(e.groupID),null!=e.name&&i._setName(e.name),null!=e.owner&&i._setOwner(f.KiiUserAdmin._userWithID(e.owner,t)),i},t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t.prototype.topicWithName=function(e){var t,i;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");if(t=this.getID(),!t)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopicAdmin(i,e,this._adminToken)},t}(f.KiiGroup),f.KiiObjectAdmin=function(e){function t(e){this._userWithID=y(this._userWithID,this),this.objectACL=y(this.objectACL,this),this._getToken=y(this._getToken,this),this._getRequest=y(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return v(t,e),t.prototype._getRequest=function(e){var i;return f.Kii.logger("admin req: "+this._adminToken),i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._getToken=function(){return this._adminToken?this._adminToken:null},t.objectWithBucket=function(e,t,i){var n;return f.Kii.logger("Creating object w type: "+t),n=new f.KiiObjectAdmin(i),n._setBucket(e),n._setObjectType(t),f.Kii.logger(n),n},t.objectWithID=function(e,t,i){var n;return f.Kii.logger("Creating object w id: "+t),n=new f.KiiObjectAdmin(i),n._setBucket(e),n._setUUID(t),f.Kii.logger(n),n},t.prototype.objectACL=function(){var e;return e=new f.KiiACLAdmin(this,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=f.KiiUserAdmin._userWithID(e,this._adminToken)},t}(f.KiiObject),f.KiiUserAdmin=function(e){function t(e){this.topicWithName=y(this.topicWithName,this),this.pushSubscription=y(this.pushSubscription,this),this.pushInstallation=y(this.pushInstallation,this),this._groupWithJSON=y(this._groupWithJSON,this),this.bucketWithName=y(this.bucketWithName,this),this._setAuthHeader=y(this._setAuthHeader,this),this._setAuthToken=y(this._setAuthToken,this),this._getRequest=y(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return v(t,e),t._userWithID=function(e,t){var i;return i=new f.KiiUserAdmin(t),i._setUUID(e),i},t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t.prototype._setAuthHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+this._adminToken)},t.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucketAdmin(e,this,this._adminToken)},t.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucketAdmin(e,this,this._adminToken)},t.prototype._groupWithJSON=function(e){var t;return t=new f.KiiGroupAdmin._groupWithJSON(e,this._adminToken)},t.prototype.pushInstallation=function(){throw new f.UnsupportedOperationException("Push installation is not supported by admin context")},t.prototype.pushSubscription=function(){return new f.KiiPushSubscriptionAdmin(this,this._adminToken)},t.prototype.topicWithName=function(e){var t;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");if(t=this.getID(),!t)throw"can not instantiate topic from instance which doesn't have ID";return new f.KiiTopicAdmin(this._getHttpURI(),e,this._adminToken)},t}(f.KiiUser),f.KiiAnonymousUser=function(){function e(){this.getID=y(this.getID,this)}return e.prototype.getID=function(){return"ANONYMOUS_USER"},e}(),f.KiiAnyAuthenticatedUser=function(){function e(){this.getID=y(this.getID,this)}return e.prototype.getID=function(){return"ANY_AUTHENTICATED_USER"},e}(),f.KiiSDKClientInfo=function(){function e(){}return e.getSDKClientInfo=function(){return null==e._clientInfo&&(e._clientInfo="sn=jss;sv="+f.Kii.getSDKVersion()),e._clientInfo},e}(),f.KiiSCNTwitter=function(e){function t(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.TWITTER)}return v(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={oauth_token:e.oauth_token,oauth_token_secret:e.oauth_token_secret},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.oauth_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("Checking options"),f.Kii.logger(e),null==e||!e.oauth_token&&!e.oauth_token_secret)throw f.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!e.oauth_token)throw f.InvalidArgumentException("options.oauth_token is required");if(!e.oauth_token_secret)throw f.InvalidArgumentException("options.oauth_token_secret is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.oauth_token,accessTokenSecret:e.oauth_token_secret},this._register("twitter","application/vnd.kii.AuthTokenTwitterRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out twitter")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null==f.KiiUser.getCurrentUser())return void t.failure(null,this._network,"No user logged in");if(null==e||!e.oauth_token&&!e.oauth_token_secret)throw f.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!e.oauth_token)throw f.InvalidArgumentException("options.oauth_token is required");if(!e.oauth_token_secret)throw f.InvalidArgumentException("options.oauth_token_secret is required");return i={accessToken:e.oauth_token,accessTokenSecret:e.oauth_token_secret},this._link("twitter","application/vnd.kii.LinkTwitterRequest+json",i,e,t)},t.prototype._unlinkFromCurrentUser=function(e){return null==f.KiiUser.getCurrentUser()?void e.failure(null,this._network,"No user logged in"):this._unlink("twitter",e)},t}(f.KiiSocialConnectNetwork),f.KiiGeoPoint=function(){function e(e,t){var i;if(this._latitude=e,this._longitude=t,this._toDict=y(this._toDict,this),this.getLongitude=y(this.getLongitude,this),this.getLatitude=y(this.getLatitude,this),i=function(e,t,i){return i>e&&t>i&&!isNaN(i)},!i(-90,90,this._latitude)||!i(-180,180,this._longitude))throw f.InvalidArgumentException("Specified latitide or longitude is invalid")}return e.prototype.getLatitude=function(){return this._latitude},e.prototype.getLongitude=function(){return this._longitude},e.geoPoint=function(e,t){return new f.KiiGeoPoint(e,t)},e.prototype._toDict=function(){var e;return e={_type:"point",lat:this._latitude,lon:this._longitude}},e}(),s=function(){function e(e,t,i){this.xhr=$.ajaxSettings.xhr(),t=l._disableCacheURL(t),this.xhr.open(e,t,!0),this.xhr.onreadystatechange=i.onComplete}return e}(),p=function(){function e(e,t,i){t=l._disableCacheURL(t),this.xhr=new XMLHttpRequest,"withCredentials"in this.xhr?(this.xhr.open(e,t,!0),this.xhr.onreadystatechange=i.onComplete):this.xhr=null}return e}(),a=function(){function e(e,t,i){this.xhr=Ti.Network.createHTTPClient(),t=l._disableCacheURL(t),this.xhr.open(e,t,!0),this.xhr.onload=i.onComplete,this.xhr.onerror=i.onError}return e}(),h=function(){function e(){}return e.createXHRWrapper=function(e,t){var i;return i=null,null===f.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(f.Kii.logger("Use jQuery"),i=new r(e,t)):"undefined"!=typeof XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),i=new c(e,t)):"undefined"!=typeof Titanium&&(f.Kii.logger("Use Titanium"),i=new u(e,t)):(f.Kii.logger("Use http request backdoor"),f.Kii._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.Kii.logger("Use jQuery"),i=new r(e,t)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),i=new c(e,t)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),i=new u(e,t))),i},e}(),c=function(){function e(e,t){this.setAuthToken=y(this.setAuthToken,this),this.setAdminOrUserToken=y(this.setAdminOrUserToken,this),this.setCurrentUserToken=y(this.setCurrentUserToken,this),this.setContentType=y(this.setContentType,this),this.setKiiHeaders=y(this.setKiiHeaders,this),this.getErrorCode=y(this.getErrorCode,this),this.getErrorString=y(this.getErrorString,this),this.sendData=y(this.sendData,this),this.send=y(this.send,this),this._setUpCallbacks=y(this._setUpCallbacks,this);var i,n,r;if(t=l._disableCacheURL(t),this.xhr=new XMLHttpRequest,this.method=e,"withCredentials"in this.xhr){if(this.xhr.open(e,t,!0),i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}else this.xhr=null}return e.prototype.getAppID=function(){return f.Kii.getAppID()},e.prototype.getAppKey=function(){return f.Kii.getAppKey()},e.prototype.getLogger=function(){return f.Kii.logger()},e.prototype._setUpCallbacks=function(e){return e&&e.progress?"PUT"===this.method?this.xhr.upload.addEventListener("progress",e.progress,!1):this.xhr.addEventListener("progress",e.progress,!1):void 0},e.prototype.send=function(e){var t;return this._setUpCallbacks(e),t={onComplete:function(t){return function(){var i;if(4===t.xhr.readyState)if(200<=(i=t.xhr.status)&&400>i){if(t.getLogger("Completed Request["+t.xhr.status+"]"),null!=e)return e.success()}else if(t.getLogger("Error loading data..."),t.getLogger("callback : "+e),null!=e)return e.failure()}}(this)},this.xhr.onreadystatechange=t.onComplete,this.xhr.send()},e.prototype.sendData=function(e,t){var i;return this._setUpCallbacks(t),i={onComplete:function(e){return function(){var i;if(4===e.xhr.readyState)if(200<=(i=e.xhr.status)&&400>i){if(e.getLogger("Completed Request["+e.xhr.status+"]"),null!=t)return t.success()}else if(e.getLogger("Error loading data..."),null!=t)return t.failure()}}(this)},this.xhr.onreadystatechange=i.onComplete,this.xhr.send(e)},e.prototype.getErrorString=function(e){var t,i;t=""+e+" failed. statusCode: "+this.xhr.status;try{return i=JSON.parse(decodeURIComponent(this.xhr.responseText)),null!=i.errorCode&&(t+=" error code: "+i.errorCode),null!=i.message&&(t+=" message: "+i.message),t}catch(n){return t}},e.prototype.getErrorCode=function(){var e;try{return e=JSON.parse(decodeURIComponent(this.xhr.responseText)),e.errorCode}catch(t){return null}},e.prototype.setKiiHeaders=function(){return this.xhr.setRequestHeader("x-kii-appid",this.getAppID()),this.xhr.setRequestHeader("x-kii-appkey",this.getAppKey()),this.xhr.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo())},e.prototype.setContentType=function(e){return this.xhr.setRequestHeader("Content-Type",e)},e.prototype.setCurrentUserToken=function(){var e,t;return e=null!=(t=this.getCurrentUser())?t.getAccessToken():void 0,null!=e?(this.xhr.setRequestHeader("authorization","bearer "+e),!0):!1},e.prototype.setAdminOrUserToken=function(e){var t,i;return t=null!=e?e._getToken():null!=(i=this.getCurrentUser())?i.getAccessToken():void 0,null!=t?(this.xhr.setRequestHeader("authorization","bearer "+t),!0):!1},e.prototype.setAuthToken=function(e){return null!=e?this.xhr.setRequestHeader("authorization","bearer "+e):void 0},e.prototype.getCurrentUser=function(){return f.KiiUser.getCurrentUser()},e}(),u=function(e){function t(e,t){this.sendData=y(this.sendData,this),this.send=y(this.send,this);var i,n,r;if(t=l._disableCacheURL(t),this.xhr=Ti.Network.createHTTPClient(),this.method=e,this.xhr.open(e,t,!0),i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}return v(t,e),t.prototype.send=function(e){var t;return this._setUpCallbacks(e),t={onComplete:function(t){return function(){var i;if(4===t.xhr.readyState)if(200<=(i=t.xhr.status)&&400>i){if(f.Kii.logger("Completed Request["+t.xhr.status+"]"),null!=e)return e.success()}else if(f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+e),null!=e)return e.failure()}}(this),onError:function(t){return function(){return f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+e),null!=e?e.failure():void 0}}(this)},this.xhr.onload=t.onComplete,this.xhr.onerror=t.onError,this.xhr.send()},t.prototype.sendData=function(e,t){var i;return this._setUpCallbacks(t),i={onComplete:function(e){return function(){var i;if(4===e.xhr.readyState)if(200<=(i=e.xhr.status)&&400>i){if(f.Kii.logger("Completed Request["+e.xhr.status+"]"),null!=t)return t.success()}else if(f.Kii.logger("Error loading data..."),null!=t)return t.failure()}}(this),onError:function(e){return function(){return f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+t),null!=t?t.failure():void 0}}(this)},this.xhr.onload=i.onComplete,this.xhr.onerror=i.onError,this.xhr.send(e)},t}(c),r=function(e){function t(e,t){var i,n,r;if(t=l._disableCacheURL(t),this.xhr=$.ajaxSettings.xhr(),this.xhr.open(e,t,!0),this.method=e,i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}return v(t,e),t}(c),f.KiiSCNQQ=function(e){function t(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.QQ)}return v(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={access_token:e.access_token,openID:e.openID},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.access_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("Checking options"),f.Kii.logger(e),null==e||!e.access_token&&!e.openID)throw f.InvalidArgumentException("Both options.access_token and options.openID are required");if(!e.access_token)throw f.InvalidArgumentException("options.access_token is required");if(!e.openID)throw f.InvalidArgumentException("options.openID is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.access_token,openID:e.openID},this._register("qq","application/vnd.kii.AuthTokenQQRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out qq")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null==f.KiiUser.getCurrentUser())return void t.failure(null,this._network,"No user logged in");if(null==e||!e.access_token&&!e.openID)throw f.InvalidArgumentException("Both options.access_token and options.openID are required");if(!e.access_token)throw f.InvalidArgumentException("options.access_token is required");if(!e.openID)throw f.InvalidArgumentException("options.openID is required");return i={accessToken:e.access_token,openID:e.openID},this._link("qq","application/vnd.kii.LinkQQRequest+json",i,e,t)},t.prototype._unlinkFromCurrentUser=function(e){return null==f.KiiUser.getCurrentUser()?void e.failure(null,this._network,"No user logged in"):this._unlink("qq",e)},t}(f.KiiSocialConnectNetwork),f.KiiServerCodeEntry=function(){function e(e,t){this.entryName=e,this.version=t}return e.prototype.execute=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){var e;return null!=t&&t.failure.apply(t,arguments),e=l._Error(arguments[3],i),e.argument=arguments[1],r(e)}},i._executeUsingCallbacks(e,s)}}(this))},e.prototype._executeUsingCallbacks=function(e,t){var i,n,r,s,o,u,a,c;return l._validateServerCodeEntryArgument(e)?(n=null!=e?e:{},o=null!=(c=this.version)?c:"current",i=JSON.stringify(n),s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/server-code/versions/"+o+"/"+this.entryName),u=h.createXHRWrapper("POST",s),a=u.xhr,a.setRequestHeader("x-kii-appid",f.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/json"),null!=f.KiiUser.getCurrentUser()&&a.setRequestHeader("Authorization","Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),r={success:function(i){return function(){var n,r,s,o;o=a.getResponseHeader("x-step-count");try{if(s=JSON.parse(a.responseText),r=new f.KiiServerCodeExecResult(s,o),null!=t)return t.success(i,e,r)}catch(u){if(null!=t)return n="fail to parse response. statusCode: "+a.status+" executedSteps: "+o+" error code: failed_to_parse_response response: "+a.responseText,t.failure(i,e,null,n)}}}(this),failure:function(i){return function(){var n,r,s,o;o=a.getResponseHeader("x-step-count"),n={statusCode:a.status,executedSteps:o},r="fail to execute server code. statusCode: "+a.status+" executedSteps: "+o;try{if(s=JSON.parse(a.responseText),null!=s.errorCode&&(r+=" error code: "+s.errorCode),null!=s.message&&(r+=" message: "+s.message),null!=s.details&&null!=s.details.message)return r+=" detailMessage: "+s.details.message}catch(u){return r+=" error code: failed_to_parse_response message: "+a.responseText}finally{null!=t&&t.failure(i,e,null,r)}}}(this)},u.sendData(i,r)):t.failure(this,e,null,f.InvalidArgumentException("arugment is invalid"))},e.prototype.getEntryName=function(){return this.entryName},e}(),f.KiiServerCodeExecResult=function(){function e(e,t){this.returnObject=e,this.exeSteps=t}return e.prototype.getExecutedSteps=function(){return this.exeSteps},e.prototype.getReturnedValue=function(){return this.returnObject},e}(),f.KiiThing=function(){function e(e){this.fields=e,this._getSubscriberPath=y(this._getSubscriberPath,this),this._setAuthToken=y(this._setAuthToken,this),this._getHttpURI=y(this._getHttpURI,this),this.pushSubscription=y(this.pushSubscription,this),this._listTopicsUsingCallbacks=y(this._listTopicsUsingCallbacks,this),this.listTopics=y(this.listTopics,this),this.topicWithName=y(this.topicWithName,this),this.encryptedBucketWithName=y(this.encryptedBucketWithName,this),this.bucketWithName=y(this.bucketWithName,this),this._changeStatus=y(this._changeStatus,this),this.enable=y(this.enable,this),this.disable=y(this.disable,this),this.unregisterOwner=y(this.unregisterOwner,this),this._getOwnerURL=y(this._getOwnerURL,this),this.registerOwner=y(this.registerOwner,this),this.isOwner=y(this.isOwner,this),this.deleteThing=y(this.deleteThing,this),this.update=y(this.update,this),this._refresh=y(this._refresh,this),this.refresh=y(this.refresh,this),this.getDisabled=y(this.getDisabled,this),this.getCreated=y(this.getCreated,this),this.getAccessToken=y(this.getAccessToken,this),this.getVendorThingID=y(this.getVendorThingID,this),this.getThingID=y(this.getThingID,this),this._renewThingFields=y(this._renewThingFields,this),null!=this.fields&&this._renewThingFields(this.fields)}return e.prototype._renewThingFields=function(e){return this.fields=e,this._thingID=e._thingID,this._vendorThingID=e._vendorThingID,this._accessToken=e._accessToken,this._created=new Date(e._created),this._disabled=e._disabled,delete this.fields._thingID,delete this.fields._vendorThingID,delete this.fields._accessToken,delete this.fields._created,delete this.fields._disabled},e.prototype.getThingID=function(){return this._thingID},e.prototype.getVendorThingID=function(){return this._vendorThingID},e.prototype.getAccessToken=function(){return this._accessToken},e.prototype.getCreated=function(){return this._created},e.prototype.getDisabled=function(){return this._disabled},e.register=function(e,t){return new Promise(function(i,n){var r,s;return s=h.createXHRWrapper("POST",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things"),s.setKiiHeaders(),s.setContentType("application/vnd.kii.ThingRegistrationAndAuthorizationRequest+json"),r={success:function(){var e,n;return e=JSON.parse(decodeURIComponent(s.xhr.responseText)),n=new f.KiiThing(e),null!=t&&t.success(n),i(n)},failure:function(){var e,i;return i=s.getErrorString("register thing"),e=l._Error(i),null!=t&&t.failure(e),n(e)}},s.sendData(JSON.stringify(e),r)})},e.prototype.refresh=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(n){return t._renewThingFields(n),null!=e&&e.success(t),i(t)},failure:function(i){var r;return r=l._Error(i,t),null!=e&&e.failure(r),n(r)}},t._refresh(r)}}(this))},e.prototype._refresh=function(e){var t,i,n;return t=null!=this._thingID?this._thingID:"VENDOR_THING_ID:"+this._vendorThingID,n=h.createXHRWrapper("GET",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t),n.setKiiHeaders(),
this._setAuthToken(n),i={success:function(t){return function(){var t;return t=JSON.parse(decodeURIComponent(n.xhr.responseText)),e.success(t)}}(this),failure:function(t){return function(){var t;return t=n.getErrorString("refresh thing"),e.failure(t)}}(this)},n.send(i)},e.prototype.update=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(r){var s,o,u,a,c;c=t.fields;for(s in c)u=c[s],r[s]=u;return t.fields=r,a=h.createXHRWrapper("PATCH",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t._thingID),a.setKiiHeaders(),a.setContentType("application/vnd.kii.ThingUpdateRequest+json"),t._setAuthToken(a),o={success:function(){return null!=e&&e.success(t),i(t)},failure:function(){var i,r;return r=a.getErrorString("update thing"),i=l._Error(r,t),null!=e&&e.failure(i),n(i)}},a.sendData(JSON.stringify(t.fields),o),"function"==typeof t._testOnUpdateRequest?t._testOnUpdateRequest():void 0},failure:function(i){var r;return r=l._Error(i,t),null!=e&&e.failure(r),n(r)}},t._refresh(r)}}(this))},e.prototype.deleteThing=function(e){return new Promise(function(t){return function(i,n){var r,s;return s=h.createXHRWrapper("DELETE",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t._thingID),s.setKiiHeaders(),t._setAuthToken(s),r={success:function(){return null!=e&&e.success(t),i(t)},failure:function(){var i,r;return r=s.getErrorString("delete thing"),i=l._Error(r,t),null!=e&&e.failure(i),n(i)}},s.send(r)}}(this))},e.prototype.isOwner=function(e,t){return new Promise(function(i){return function(n,r){var s,o,u,a,c;try{u=i._getOwnerURL(i._thingID,e)}catch(p){return o=p,s=l._Error(o,i),null!=t&&t.failure(s),void r(s)}return c=h.createXHRWrapper("HEAD",u),c.setKiiHeaders(),i._setAuthToken(c),a={success:function(){return null!=t&&t.success(i,e,!0),n([i,e,!0])},failure:function(){var o;return 404===c.xhr.status?(null!=t&&t.success(i,e,!1),void n([i,e,!1])):(o=c.getErrorString("register owner"),s=l._Error(o,i),null!=t&&t.failure(s),r(s))}},c.send(a)}}(this))},e.prototype.registerOwner=function(e,t){return new Promise(function(i){return function(n,r){var s,o,u,a,c;try{u=i._getOwnerURL(i._thingID,e)}catch(p){return o=p,s=l._Error(o,i),null!=t&&t.failure(s),void r(s)}return c=h.createXHRWrapper("PUT",u),c.setKiiHeaders(),i._setAuthToken(c),a={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e;return e=c.getErrorString("register owner"),s=l._Error(e,i),null!=t&&t.failure(s),r(s)}},c.send(a)}}(this))},e.registerOwnerWithThingID=function(e,t,i){return f.KiiThing._registerOwnerWithIdentifier(e,t,i)},e.registerOwnerWithVendorThingID=function(e,t,i){return l._isNonEmptyString(e)?f.KiiThing._registerOwnerWithIdentifier("VENDOR_THING_ID:"+e,t,i):f.KiiThing._registerOwnerWithIdentifier(null,t,i)},e._registerOwnerWithIdentifier=function(e,t,i){return new Promise(function(n,r){var s,o,u,a,c;if(!l._isNonEmptyString(e))return s=l._Error("identifier is null or empty"),null!=i&&i.failure(s),void r(s);if(null==t)return s=l._Error("owner is null"),null!=i&&i.failure(s),void r(s);try{u=f.KiiThing.prototype._getOwnerURL(e,t)}catch(p){return o=p,s=l._Error(o),null!=i&&i.failure(s),void r(s)}return c=h.createXHRWrapper("PUT",u),c.setKiiHeaders(),f.KiiThing.prototype._setAuthToken(c),a={success:function(){return null!=i&&i.success(t),n([t])},failure:function(){var e;return e=c.getErrorString("register owner"),s=l._Error(e),null!=i&&i.failure(s),r(s)}},c.send(a)})},e.prototype._getOwnerURL=function(e,t){var i,n;if(t instanceof f.KiiUser)i=t.getID(),n="user";else{if(!(t instanceof f.KiiGroup))throw"owner should be instance of user or group";i=t.getID(),n="group"}if(null==i)throw"owner instance does not have id";return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e+"/ownership/"+n+":"+i},e.prototype.unregisterOwner=function(e,t){return new Promise(function(i){return function(n,r){var s,o,u,a,c;try{u=i._getOwnerURL(i._thingID,e)}catch(p){return o=p,s=l._Error(o,i),null!=t&&t.failure(s),void r(s)}return c=h.createXHRWrapper("DELETE",u),c.setKiiHeaders(),i._setAuthToken(c),a={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e;return e=c.getErrorString("unregister owner"),s=l._Error(e,i),null!=t&&t.failure(s),r(s)}},c.send(a)}}(this))},e.prototype.disable=function(e){return this._changeStatus(!0,e)},e.prototype.enable=function(e){return this._changeStatus(!1,e)},e.prototype._changeStatus=function(e,t){return new Promise(function(i){return function(n,r){var s,o,u;return u=h.createXHRWrapper("PUT",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+i._thingID+"/status"),u.setKiiHeaders(),i._setAuthToken(u),u.setContentType("application/vnd.kii.ThingStatusUpdateRequest+json"),o={success:function(){return i._disabled=e,null!=t&&t.success(i),n(i)},failure:function(){var n,s;return s=u.getErrorString("disable thing "+e),n=l._Error(s,i),null!=t&&t.failure(n),r(n)}},s={disabled:e},u.sendData(JSON.stringify(s),o)}}(this))},e.loadWithVendorThingID=function(e,t){var i;return i="VENDOR_THING_ID:"+e,f.KiiThing._load(i,t)},e.loadWithThingID=function(e,t){return f.KiiThing._load(e,t)},e._load=function(e,t){return new Promise(function(i,n){var r,s;return s=h.createXHRWrapper("GET",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e),s.setKiiHeaders(),f.KiiThing.prototype._setAuthToken(s),r={success:function(){var e,n;return e=JSON.parse(decodeURIComponent(s.xhr.responseText)),n=new f.KiiThing(e),null!=t&&t.success(n),i(n)},failure:function(){var e,i;return i=s.getErrorString("load thing"),e=l._Error(i),null!=t&&t.failure(e),n(e)}},s.send(r)})},e.prototype.bucketWithName=function(e){return new f.KiiBucket._bucketWithName(e,this)},e.prototype.encryptedBucketWithName=function(e){return new f.KiiEncryptedBucket(e,this)},e.prototype.topicWithName=function(e){if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopic(this._getHttpURI(),e)},e.prototype.listTopics=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,t)}}(this))},e.prototype._listTopicsUsingCallbacks=function(e,t){var i,n,r;return n=""+this._getHttpURI()+"/topics","string"==typeof t&&""!==t&&(n=n+"?paginationKey="+encodeURIComponent(t)),r=h.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(t){return function(){var i,n,s,o,u,a;for(i=JSON.parse(r.xhr.responseText),s=[],a=i.topics,o=0,u=a.length;u>o;o++)n=a[o],s.push(t.topicWithName(n.topicID));return null!=e?e.success(s,void 0===i.paginationKey?null:i.paginationKey):void 0}}(this),failure:function(t){return function(){var i,n;return n=r.getErrorString("list topics"),i=l._Error(n,t),null!=e?e.failure(i):void 0}}(this)},r.send(i)},e.prototype.pushSubscription=function(){return new f.KiiPushSubscription(this)},e.prototype._getHttpURI=function(){return""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+this.getThingID()},e.thingWithID=function(e){var t;if(null==e||""===e)throw new f.InvalidArgumentException("thingID should not null or empty");return t=new f.KiiThing,t._thingID=e,t},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e.prototype._getSubscriberPath=function(){return"things/"+this.getThingID()},e}(),f.KiiTopic=function(){function e(e,t){this._getHttpUri=y(this._getHttpUri,this),this._setAuthToken=y(this._setAuthToken,this),this.acl=y(this.acl,this),this.deleteTopic=y(this.deleteTopic,this),this.sendMessage=y(this.sendMessage,this),this.save=y(this.save,this),this.exists=y(this.exists,this),this.getName=y(this.getName,this),this._uri=""+e+"/topics/"+t,this._name=t}return e.prototype.getName=function(){return this._name},e.prototype.exists=function(e){return new Promise(function(t){return function(i,n){var r,s;return s=h.createXHRWrapper("HEAD",t._uri),s.setKiiHeaders(),t._setAuthToken(s),r={success:function(){return null!=e&&e.success(!0),i(!0)},failure:function(){var r,o;return 404===s.xhr.status?(null!=e&&e.success(!1),void i(!1)):(o=s.getErrorString("check topic"),r=l._Error(o,t),null!=e&&e.failure(r),n(r))}},s.send(r)}}(this))},e.prototype.save=function(e){return new Promise(function(t){return function(i,n){var r,s;return s=h.createXHRWrapper("PUT",t._uri),s.setKiiHeaders(),t._setAuthToken(s),r={success:function(){return null!=e&&e.success(t),i(t)},failure:function(){var i,r;return r=s.getErrorString("save topic"),i=l._Error(r,t),null!=e&&e.failure(i),n(i)}},s.send(r)}}(this))},e.prototype.sendMessage=function(e,t){return new Promise(function(i){return function(n,r){var s,o;return o=h.createXHRWrapper("POST",""+i._uri+"/push/messages"),o.setKiiHeaders(),i._setAuthToken(o),o.setContentType("application/vnd.kii.SendPushMessageRequest+json"),s={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e,n;return n=o.getErrorString("send messages"),e=l._Error(n,i),null!=t&&t.failure(e),r(e)}},o.sendData(JSON.stringify(e),s)}}(this))},e.prototype.deleteTopic=function(e){return new Promise(function(t){return function(i,n){var r,s;return s=h.createXHRWrapper("DELETE",t._uri),s.setKiiHeaders(),t._setAuthToken(s),r={success:function(){return null!=e&&e.success(t),i(t)},failure:function(){var i,r;return r=s.getErrorString("delete topic"),i=l._Error(r,t),null!=e&&e.failure(i),n(i)}},s.send(r)}}(this))},e.prototype.acl=function(){return f.KiiACL.aclWithParent(this)},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e.prototype._getHttpUri=function(){return this._uri},e}(),f.KiiPushMessageBuilder=function(){function e(e){this.data=e,this.mqttData=y(this.mqttData,this),this.jpushData=y(this.jpushData,this),this.apnsCategory=y(this.apnsCategory,this),this.apnsContentAvailable=y(this.apnsContentAvailable,this),this.apnsBadge=y(this.apnsBadge,this),this.apnsSound=y(this.apnsSound,this),this.apnsAlert=y(this.apnsAlert,this),this.apnsData=y(this.apnsData,this),this.gcmRestrictedPackageName=y(this.gcmRestrictedPackageName,this),this.gcmTimeToLive=y(this.gcmTimeToLive,this),this.gcmDelayWhileIdle=y(this.gcmDelayWhileIdle,this),this.gcmCollapseKey=y(this.gcmCollapseKey,this),this.gcmData=y(this.gcmData,this),this.enableMqtt=y(this.enableMqtt,this),this.enableJpush=y(this.enableJpush,this),this.enableApns=y(this.enableApns,this),this.enableGcm=y(this.enableGcm,this),this.setSendToProduction=y(this.setSendToProduction,this),this.setSendToDevelopment=y(this.setSendToDevelopment,this),this.build=y(this.build,this),this.gcm={},this.apns={},this.jpush={},this.mqtt={},this.gcm.enabled=!0,this.apns.enabled=!0,this.jpush.enabled=!0,this.mqtt.enabled=!0}return e.prototype.build=function(){var e;return e={},e.data=this.data,e.gcm=this.gcm,e.apns=this.apns,e.jpush=this.jpush,e.mqtt=this.mqtt,null!=this.sendToDevelopment&&(e.sendToDevelopment=this.sendToDevelopment),null!=this.sendToProduction&&(e.sendToProduction=this.sendToProduction),e},e.prototype.setSendToDevelopment=function(e){return this.sendToDevelopment=e,this},e.prototype.setSendToProduction=function(e){return this.sendToProduction=e,this},e.prototype.enableGcm=function(e){return this.gcm.enabled=e,this},e.prototype.enableApns=function(e){return this.apns.enabled=e,this},e.prototype.enableJpush=function(e){return this.jpush.enabled=e,this},e.prototype.enableMqtt=function(e){return this.mqtt.enabled=e,this},e.prototype.gcmData=function(e){return this.gcm.data=e,this},e.prototype.gcmCollapseKey=function(e){return this.gcm.collapseKey=e,this},e.prototype.gcmDelayWhileIdle=function(e){return this.gcm.delayWhileIdle=e,this},e.prototype.gcmTimeToLive=function(e){return this.gcm.timeToLive=e,this},e.prototype.gcmRestrictedPackageName=function(e){return this.gcm.restrictedPackageName=e,this},e.prototype.apnsData=function(e){return this.apns.data=e,this},e.prototype.apnsAlert=function(e){return this.apns.alert=e,this},e.prototype.apnsSound=function(e){return this.apns.sound=e,this},e.prototype.apnsBadge=function(e){return this.apns.badge=e,this},e.prototype.apnsContentAvailable=function(e){return 0!==e&&(this.apns.contentAvailable=!0),this},e.prototype.apnsCategory=function(e){return this.apns.category=e,this},e.prototype.jpushData=function(e){return this.jpush.data=e,this},e.prototype.mqttData=function(e){return this.mqtt.data=e,this},e}(),f.KiiPushSubscription=function(){function e(e){this._subscriber=e,this._setAuthToken=y(this._setAuthToken,this),this._getRequestHTTPURI=y(this._getRequestHTTPURI,this),this._validateTarget=y(this._validateTarget,this),this.isSubscribed=y(this.isSubscribed,this),this.unsubscribe=y(this.unsubscribe,this),this.subscribe=y(this.subscribe,this)}return e.prototype.getSubscriber=function(){return this._subscriber},e.prototype.subscribe=function(e,t){return new Promise(function(i){return function(n,r){var s,o,u;return i._validateTarget(e)?(s=i._getRequestHTTPURI(e),u=h.createXHRWrapper("PUT",s),u.setKiiHeaders(),i._setAuthToken(u),o={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e,n;return n=u.getErrorString("subscribe"),e=l._Error(n,i),null!=t&&t.failure(e),r(e)}},u.send(o)):(null!=t&&t.failure(f.InvalidArgumentException("target is invalid")),void r(l._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},e.prototype.unsubscribe=function(e,t){return new Promise(function(i){return function(n,r){var s,o,u;return i._validateTarget(e)?(s=i._getRequestHTTPURI(e),u=h.createXHRWrapper("DELETE",s),u.setKiiHeaders(),i._setAuthToken(u),o={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e,n;return n=u.getErrorString("unsubscribe"),e=l._Error(n,i),null!=t&&t.failure(e),r(e)}},u.send(o)):(null!=t&&t.failure(f.InvalidArgumentException("target is invalid")),void r(l._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},e.prototype.isSubscribed=function(e,t){return new Promise(function(i){return function(n,r){var s,o,u;return i._validateTarget(e)?(s=i._getRequestHTTPURI(e),u=h.createXHRWrapper("GET",s),u.setKiiHeaders(),i._setAuthToken(u),o={success:function(){return null!=t&&t.success(i,e,!0),n([i,e,!0])},failure:function(){var s,o,a;return a=u.getErrorCode(),"FILTER_NOT_FOUND"===a||"PUSH_SUBSCRIPTION_NOT_FOUND"===a?(null!=t&&t.success(i,e,!1),n([i,e,!1])):(o=u.getErrorString("Check is subscribed"),s=l._Error(o,i),null!=t&&t.failure(s),r(s))}},u.send(o)):(null!=t&&t.failure(f.InvalidArgumentException("target is invalid")),void r(l._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},e.prototype._validateTarget=function(e){return null!=e&&(e instanceof f.KiiBucket||e instanceof f.KiiTopic)},e.prototype._getRequestHTTPURI=function(e){var t;return e instanceof f.KiiBucket?t=""+e._getHttpUri()+"/filters/all/push/subscriptions/"+this._subscriber._getSubscriberPath():e instanceof f.KiiTopic?t=""+e._getHttpUri()+"/push/subscriptions/"+this._subscriber._getSubscriberPath():void 0},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e}(),f.KiiThingAdmin=function(e){function t(e,i,n,r){this._adminToken=r,this.topicWithName=y(this.topicWithName,this),this.bucketWithName=y(this.bucketWithName,this),this.pushSubscription=y(this.pushSubscription,this),this._setAuthToken=y(this._setAuthToken,this),t.__super__.constructor.call(this,e),null!=i&&(this._thingID=i),null!=n&&(this._vendorThingID=n)}return v(t,e),t.register=function(e,t,i){return new Promise(function(n,r){var s,o;return o=h.createXHRWrapper("POST",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things"),o.setKiiHeaders(),o.setContentType("application/vnd.kii.ThingRegistrationAndAuthorizationRequest+json"),o.setAuthToken(i),s={success:function(){var e,r;return e=JSON.parse(decodeURIComponent(o.xhr.responseText)),r=new f.KiiThingAdmin(e,null,null,i),null!=t&&t.success(r),n(r)},failure:function(){var e,i;return i=o.getErrorString("register thing"),e=l._Error(i),null!=t&&t.failure(e),r(e)}},o.sendData(JSON.stringify(e),s)})},t.registerOwnerWithThingID=function(e,t,i,n){return f.KiiThingAdmin._registerOwnerWithIdentifier(e,t,i,n)},t.registerOwnerWithVendorThingID=function(e,t,i,n){return f.KiiThingAdmin._registerOwnerWithIdentifier("VENDOR_THING_ID:"+e,t,i,n)},t._registerOwnerWithIdentifier=function(e,t,i,n){return new Promise(function(r,s){var o,u,a,c;if(t instanceof f.KiiUser)o=t.getID(),a="user";else{if(!(t instanceof f.KiiGroup))throw"owner should be instance of user or group";o=t.getID(),a="group"}if(null==o)throw"owner instance does not have id";return c=h.createXHRWrapper("PUT",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e+"/ownership/"+a+":"+o),c.setKiiHeaders(),c.setAuthToken(n),u={success:function(){return null!=i&&i.success(t),r([t])},failure:function(){var e,t;return t=c.getErrorString("register owner"),e=l._Error(t),null!=i&&i.failure(e),s(e)}},c.send(u)})},t.loadWithVendorThingID=function(e,t,i){var n;return n=new f.KiiThingAdmin(null,null,e,i),n.refresh(t)},t.loadWithThingID=function(e,t,i){var n;return n=new f.KiiThingAdmin(null,e,null,i),n.refresh(t)},t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t.prototype.pushSubscription=function(){return new f.KiiPushSubscriptionAdmin(this,this._adminToken)},t.prototype.bucketWithName=function(e){return new f.KiiBucketAdmin(e,this,this._adminToken)},t.prototype.encryptedBucketWithName=function(e){return new f.KiiEncryptedBucketAdmin(e,this,this._adminToken)},t.prototype.topicWithName=function(e){if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopicAdmin(this._getHttpURI(),e,this._adminToken)},t.thingWithID=function(e,t){var i;return i=new f.KiiThingAdmin(null,e,null,t)},t}(f.KiiThing),f.KiiTopicAdmin=function(e){function t(e,i,n){this._adminToken=n,this.acl=y(this.acl,this),this._setAuthToken=y(this._setAuthToken,this),t.__super__.constructor.call(this,e,i)}return v(t,e),t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t.prototype.acl=function(){return new f.KiiACLAdmin(this,this._adminToken)},t}(f.KiiTopic),f.KiiPushSubscriptionAdmin=function(e){function t(e,i){this._adminToken=i,this._setAuthToken=y(this._setAuthToken,this),t.__super__.constructor.call(this,e)}return v(t,e),t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t}(f.KiiPushSubscription),f.KiiAnalyticsSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api",SG:"https://api-sg.kii.com/api",CN3:"https://api-cn3.kii.com/api"},f.KiiAnalytics=function(){function e(){}var t;return t=null,e.getBaseURL=function(){return t._baseURL},e.getAppID=function(){return t._appID},e.getAppKey=function(){return t._appKey},e.getAppKey=function(){return t._appKey},e.getDeviceId=function(){return t._deviceId},e.isLogging=function(){return t._logging},e.setLogging=function(e){return f.KiiAnalytics.logger("Setting logging: "+e),t._logging=e},e.initializeWithSite=function(e,t,i,n){return f.KiiAnalytics._initializeWithSite(e,t,i,n)},e.initialize=function(e,t,i){return f.KiiAnalytics._initializeWithSite(e,t,f.KiiAnalyticsSite.US,i)},e._initializeWithSite=function(e,i,n,r){return t=new g(e,i,n,r),(null!=r?r.length:void 0)>0&&t._deviceId!==r&&(t._deviceId=r),f.KiiAnalytics.logger("Initialized "+e+", "+i+", "+n)},e.error=function(e){return console.log("KiiAnalytics SDK Error => "+e)},e.logger=function(e){return t._logging?console.log("KiiAnalytics => "+e):void 0},e.trackEvent=function(e){return f.KiiAnalytics.trackEventWithExtras(e,null)},e.trackEventWithExtras=function(e,t){return f.KiiAnalytics.trackEventWithExtrasAndCallbacks(e,t,null)},e.trackEventWithExtrasAndCallbacks=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success(),r()},failure:function(){return null!=n&&n.failure.apply(n,arguments),s(l._Error(arguments[0]))}},e._trackEventWithExtrasAndCallbacks(t,i,o)})},e._trackEventWithExtrasAndCallbacks=function(i,r,s){var o,u,a,l,c,h,p,d,g,_,y;h=Math.round((new Date).getTime()),c="^[a-zA-Z][a-zA-Z0-9_]{0,63}$",f.KiiAnalytics.logger("deviceId = "+t._deviceId),p={_triggeredAt:h,_uploadedAt:h,_deviceID:t._deviceId,_type:i},u=function(e){return null!=e&&null!=e.match(c)},o=function(e){var t,i,n,r;for(n=0,r=e.length;r>n;n++){if(i=e[n],t=typeof i,"string"!==t&&"boolean"!==t&&"number"!==t)return!1;if("string"===t){if(i.length<=0)return!1}else if("number"===t&&(!isFinite(i)||isNaN(i)))return!1}return!0},a=function(e){var t;return t=typeof e,"string"===t?e.length>0:"number"===t?isFinite(e)&&!isNaN(e):"object"===t?e instanceof Array&&e.length>0&&o(e):"boolean"===t};for(l in r)_=r[l],u(l)&&a(_)?p[l]=_:f.KiiAnalytics.logger("ignoring invalid key/value pair, key:"+l+" value:"+_);return g=""+e.getBaseURL()+"/apps/"+e.getAppID()+"/event",y=n.createXHRWrapper("POST",g),y.setKiiHeaders(),y.setContentType("application/vnd.kii.Event+json"),d={success:function(){return null!=s?s.success():void 0},failure:function(){var e;return e=y.getErrorString("track event"),null!=s?s.failure(e,y.xhr.status):void 0}},y.sendData(JSON.stringify(p),d)},e.setBaseURL=function(e){return f.KiiAnalytics.logger("Setting base URL: "+e),t._baseURL=e},e.getSDKVersion=function(){return f.Kii.getSDKVersion()},e._setHttpRequestType=function(e){return f.KiiAnalytics.logger("Set http request as "+e),t._httpRequestType=e},e._getHttpRequestType=function(){return t._httpRequestType},e}(),g=function(){function e(t,i,n,r){null==n&&(n=f.KiiAnalyticsSite.US),r||(r=e.generateDeviceId()),this._appKey=i,this._appID=t,this._baseURL=n,this._deviceId=r}return e.prototype._httpRequestType=null,e.generateDeviceId=function(){var e;return e=function(e){var t;return t=(Math.random().toString(16)+"000000000").substr(2,8),e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t},e()+e(!0)+e(!0)+e()},e}(),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},t.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},t.prototype.getLogger=function(){return f.KiiAnalytics.logger()},t.prototype.getCurrentUser=function(){return null},t}(c),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},t.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},t.prototype.getLogger=function(){return f.KiiAnalytics.logger()},t.prototype.getCurrentUser=function(){return null},t}(r),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},t.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},t.prototype.getLogger=function(){return f.KiiAnalytics.logger()},t.prototype.getCurrentUser=function(){return null},t}(u),n=function(){function n(){}return n.createXHRWrapper=function(n,r){var s;return s=null,null===f.KiiAnalytics._getHttpRequestType()?"undefined"!=typeof jQuery?(f.KiiAnalytics.logger("Use jQuery"),s=new e(n,r)):"undefined"!=typeof XMLHttpRequest?(f.KiiAnalytics.logger("Use XMLHttpRequest"),s=new i(n,r)):"undefined"!=typeof Titanium&&(f.KiiAnalytics.logger("Use Titanium"),s=new t(n,r)):(f.KiiAnalytics.logger("Use http request backdoor"),f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.KiiAnalytics.logger("Use jQuery"),s=new e(n,r)):f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),s=new i(n,r)):f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),s=new t(n,r))),s},n}(),f.KiiSCNGoogle=function(e){function t(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.GOOGLEPLUS)}return v(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={access_token:e.access_token},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.access_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("should auth google"),f.Kii.logger("Checking options"),null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.access_token},this._register("google","application/vnd.kii.AuthTokenGoogleRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out google")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:e.access_token},this._link("google","application/vnd.kii.LinkGoogleRequest+json",i,e,t)}return null!=t?t.failure(null,this._network,"A KiiUser must be logged in before linking to Google"):void 0},t.prototype._unlinkFromCurrentUser=function(e){return null!=f.KiiUser.getCurrentUser()?this._unlink("google",e):null!=e?e.failure("A KiiUser must be logged in before unlinking from Google"):void 0},t}(f.KiiSocialConnectNetwork),f.KiiSCNRenRen=function(e){function t(){this._unlinkFromCurrentUser=y(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=y(this._linkWithCurrentUser,this),this._logOut=y(this._logOut,this),this._logIn=y(this._logIn,this),this._getAccessToken=y(this._getAccessToken,this),this._createTokenObject=y(this._createTokenObject,this),this._setup=y(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.RENREN)}return v(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={access_token:e.access_token},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.access_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("should auth renren"),f.Kii.logger("Checking options"),null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.access_token},this._register("renren","application/vnd.kii.AuthTokenRenRenRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out renren")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:e.access_token},this._link("renren","application/vnd.kii.LinkRenRenRequest+json",i,e,t)}return null!=t?t.failure(null,this._network,"A KiiUser must be logged in before linking to RenRen"):void 0},t.prototype._unlinkFromCurrentUser=function(e){return null!=f.KiiUser.getCurrentUser()?this._unlink("renren",e):null!=e?e.failure("A KiiUser must be logged in before unlinking from RenRen"):void 0},t}(f.KiiSocialConnectNetwork),f.KiiUserBuilder=function(){function e(){this._password=null,this._username=null,this._emailAddress=null,this._phoneNumber=null,this._country=null}return e.builderWithIdentifier=function(e,t){var i,n;if(null==e)throw new f.InvalidArgumentException("Identifier must not be null or undefined");if(!l._validatePassword(t))throw new f.InvalidPasswordException;if(i=new f.KiiUserBuilder,i._password=t,l._validatePhoneNumber(e))i._phoneNumber=e;else if(n=l._trim(e),l._validateEmail(n))i._emailAddress=n;else{if(!l._validateUsername(n))throw new f.InvalidArgumentException;i._username=n}return i},e.builderWithEmailAddress=function(e,t){var i;if(!l._validateEmail(e))throw new f.InvalidEmailException;if(!l._validatePassword(t))throw new f.InvalidPasswordException;return i=new f.KiiUserBuilder,i._emailAddress=l._trim(e),i._password=t,i},e.builderWithGlobalPhoneNumber=function(e,t){var i;if(!l._validatePhoneNumber(e))throw new f.InvalidPhoneNumberException;if(!l._isGlobalPhoneNumber(e))throw new f.InvalidPhoneNumberException;if(!l._validatePassword(t))throw new f.InvalidPasswordException;return i=new f.KiiUserBuilder,i._phoneNumber=e,i._password=t,i},e.builderWithLocalPhoneNumber=function(e,t,i){var n;if(!l._validateLocalPhone(e))throw new f.InvalidPhoneNumberException;if(!l._validateCountryCode(t))throw new f.InvalidCountryException;if(!l._validatePassword(i))throw new f.InvalidPasswordException;return n=new f.KiiUserBuilder,n._phoneNumber=e,n._country=t,n._password=i,n},e.builderWithUsername=function(e,t){var i,n;if(n=l._trim(e),!l._validateUsername(n))throw new f.InvalidUsernameException;if(!l._validatePassword(t))throw new f.InvalidPasswordException;return i=new f.KiiUserBuilder,i._username=n,i._password=t,i},e.prototype.setUsername=function(e){var t;if(null!=e){if(t=l._trim(e),!l._validateUsername(t))throw new f.InvalidUsernameException;this._username=t}return this},e.prototype.setEmailAddress=function(e){var t;if(null!=e){if(t=l._trim(e),!l._validateEmail(t))throw new f.InvalidEmailException;this._emailAddress=t}return this},e.prototype.setGlobalPhoneNumber=function(e){if(null!=e){if(!l._validatePhoneNumber(e))throw new f.InvalidPhoneNumberException;this._phoneNumber=e,this._country=null}return this},e.prototype.setLocalPhoneNumber=function(e,t){if(null!=e&&!l._validateLocalPhone(e))throw new f.InvalidPhoneNumberException;if(null!=t&&!l._validateCountryCode(t))throw new f.InvalidCountryException;return null!=e&&(this._phoneNumber=e),null!=t&&(this._country=t),this},e.prototype.build=function(){var e;return e=new f.KiiUser,null!=this._username&&e._setUsername(this._username),null!=this._emailAddress&&e._setEmailAddress(this._emailAddress),null!=this._country?e._setLocalPhone(this._phoneNumber,this._country):null!=this._phoneNumber&&e._setPhoneNumber(this._phoneNumber),e._setPassword(this._password),e},e}(),f.KiiPushInstallation=function(){function e(e){this.uninstallByInstallationID=y(this.uninstallByInstallationID,this),this.uninstall=y(this.uninstall,this),this._getMqttEndpoint=y(this._getMqttEndpoint,this),this.getMqttEndpoint=y(this.getMqttEndpoint,this),this._install=y(this._install,this),this.installMqtt=y(this.installMqtt,this),this.installGcm=y(this.installGcm,this),this._user=e}return e.prototype.installGcm=function(e,t,i){return l._isNonEmptyString(e)?this._install(e,"ANDROID",t,i):new Promise(function(e){return function(t,n){var r;return r=l._Error("installationRegistrationID must not be null or empty.",e),null!=i&&i.failure(r),n(r)}}(this))},e.prototype.installMqtt=function(e,t){return this._install(null,"MQTT",e,t)},e.prototype._install=function(e,t,i,n){return new Promise(function(r){return function(s,o){var u,a,c,p;return"boolean"!=typeof i&&(u=l._Error("type of development must be boolean.",r),null!=n&&n.failure(u),o(u)),p=h.createXHRWrapper("POST",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/installations"),p.setKiiHeaders(),p.setCurrentUserToken(),p.setContentType("application/vnd.kii.InstallationCreationRequest+json"),a={deviceType:t,development:i},null!=e&&(a.installationRegistrationID=e),c={success:function(){var e;return e=JSON.parse(decodeURIComponent(p.xhr.responseText)),null!=n&&n.success(e),s(e)},failure:function(){var e;return e=p.getErrorString("install push"),
u=l._Error(e,r),null!=n&&n.failure(u),o(u)}},p.sendData(JSON.stringify(a),c)}}(this))},e.prototype.getMqttEndpoint=function(e,t){return new Promise(function(i){return function(n,r){var s,o;return l._isNonEmptyString(e)||(s=l._Error("installationID must not be null or empty.",i),null!=t&&t.failure(s),r(s)),o={success:function(e){return null!=t&&t.success(e),n(e)},failure:function(e){return null!=t&&t.failure(e),r(e)}},i._getMqttEndpoint(e,3,o)}}(this))},e.prototype._getMqttEndpoint=function(e,t,i){var n,r,s;return n=this,s=h.createXHRWrapper("GET",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/installations/"+e+"/mqtt-endpoint"),s.setKiiHeaders(),s.setCurrentUserToken(),r={success:function(e){return function(){var e;return e=JSON.parse(decodeURIComponent(s.xhr.responseText)),i.success(e)}}(this),failure:function(r){return function(){var r,o;return 503===s.xhr.status?(t--,0>=t?(o=s.getErrorString("get mqtt endpoint"),r=l._Error(o,n),i.failure(r)):setTimeout(function(){return n._getMqttEndpoint(e,t,i)},1e3)):(o=s.getErrorString("get mqtt endpoint"),r=l._Error(o,n),i.failure(r))}}(this)},s.send(r)},e.prototype.uninstall=function(e,t,i){return new Promise(function(n){return function(r,s){var o,u,a;return l._isNonEmptyString(e)||(o=l._Error("installationRegistrationID must not be null or empty.",n),null!=i&&i.failure(o),s(o)),f.KiiPushInstallation._validateDeviceType(t)||(o=l._Error("Unsupported deviceType "+t,n),null!=i&&i.failure(o),s(o)),a=h.createXHRWrapper("DELETE",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/installations/"+t+":"+e),a.setKiiHeaders(),a.setCurrentUserToken(),u={success:function(){return null!=i&&i.success(),r()},failure:function(){var e;return e=a.getErrorString("uninstall push"),o=l._Error(e,n),null!=i&&i.failure(o),s(o)}},a.send(u)}}(this))},e.prototype.uninstallByInstallationID=function(e,t){return new Promise(function(i){return function(n,r){var s,o,u;return l._isNonEmptyString(e)||(s=l._Error("installationID must not be null or empty.",i),null!=t&&t.failure(s),r(s)),u=h.createXHRWrapper("DELETE",""+f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/installations/"+e),u.setKiiHeaders(),u.setCurrentUserToken(),o={success:function(){return null!=t&&t.success(),n()},failure:function(){var e;return e=u.getErrorString("uninstall push"),s=l._Error(e,i),null!=t&&t.failure(s),r(s)}},u.send(o)}}(this))},e._validateDeviceType=function(e){return"ANDROID"===e||"MQTT"===e},e}(),f};!function(){var t="undefined"!=typeof module&&null!==module;t&&module.exports?module.exports={exportedClasses:["ForTest","Kii","KiiACL","KiiACLAdmin","KiiACLEntry","KiiAnalytics","KiiAnonymousUser","KiiAnyAuthenticatedUser","KiiAppAdminContext","KiiBucket","KiiBucketAdmin","KiiClause","KiiEncryptedBucket","KiiEncryptedBucketAdmin","KiiGeoPoint","KiiGroup","KiiGroupAdmin","KiiObject","KiiObjectAdmin","KiiPushInstallation","KiiPushSubscription","KiiPushSubscriptionAdmin","KiiQuery","KiiSCNFacebook","KiiSCNGoogle","KiiSCNQQ","KiiSCNRenRen","KiiSCNTwitter","KiiSDKClientInfo","KiiServerCodeEntry","KiiServerCodeExecResult","KiiSocialConnect","KiiSocialConnectNetwork","KiiThing","KiiThingAdmin","KiiTopic","KiiPushMessageBuilder","KiiTopicAdmin","KiiUser","KiiUserAdmin","KiiUserBuilder","KiiSocialNetworkName","KiiSite","_KiiHttpRequestType","KiiACLAction","KiiAnalyticsSite","InvalidDisplayNameException","InvalidPasswordException","InvalidUsernameException","InvalidUserIdentifierException","InvalidEmailException","InvalidPhoneNumberException","InvalidLocalPhoneNumberException","InvalidCountryException","InvalidURIException","InvalidACLAction","InvalidACLSubject","InvalidACLGrant","InvalidLimitException","InvalidArgumentException","IllegalStateException","ArithmeticException","UnsupportedOperationException"],create:function(){return e.call(this)}}:e()}()}();